import{b as e,a as t,u as s,S as l,j as a,g as n}from"./index-Dmop2YmA.js";import{t as r,a3 as i,aW as c,az as o,bb as d,aC as x,b3 as h,aU as m,bc as u,b as p,aD as b,c as g,l as f,x as N,a5 as v,as as j,aE as w,ao as y,U as C,a1 as k,X as I,bd as E,$ as T}from"./react-vendor-BZHK3qaO.js";import"./BaseGame-CcmywW8C.js";import{a as P,E as A,P as S}from"./types-Xv-uAYVd.js";import{u as O}from"./useGameState-VbZvHg5d.js";import{u as D}from"./usePrevious-DsjY7COx.js";import{F as G,i as R}from"./FlyingCard-B9Ps8znx.js";import"./socket-DRbsQkF5.js";import"./zustand-CJEMJLaT.js";const L={[P.EXPLODING_KITTEN]:{name:{en:"EXPLODING KITTEN",vi:"MÈO NỔ"},description:{en:"You explode! Unless you have a Defuse.",vi:"Bạn nổ tung! Trừ khi bạn có lá Gỡ Bom."},icon:u,bgColor:"bg-red-600",borderColor:"border-red-400",iconColor:"text-white",textColor:"text-white"},[P.DEFUSE]:{name:{en:"DEFUSE",vi:"GỠ BOM"},description:{en:"Save yourself from a kitten.",vi:"Cứu bản thân khỏi mèo nổ."},icon:m,bgColor:"bg-green-600",borderColor:"border-green-400",iconColor:"text-white",textColor:"text-white"},[P.ATTACK]:{name:{en:"ATTACK",vi:"TẤN CÔNG"},description:{en:"End your turn and force next player to take 2 turns.",vi:"Kết thúc lượt và bắt người chơi sau đi 2 lượt."},icon:h,bgColor:"bg-orange-600",borderColor:"border-orange-400",iconColor:"text-white",textColor:"text-white"},[P.SKIP]:{name:{en:"SKIP",vi:"BỎ LƯỢT"},description:{en:"End your turn without drawing a card.",vi:"Kết thúc lượt mà không cần rút bài."},icon:x,bgColor:"bg-blue-600",borderColor:"border-blue-400",iconColor:"text-white",textColor:"text-white"},[P.FAVOR]:{name:{en:"FAVOR",vi:"BAN ƠN"},description:{en:"Choose a player to give you a card.",vi:"Chọn một người chơi để lấy 1 lá bài từ họ."},icon:d,bgColor:"bg-pink-600",borderColor:"border-pink-400",iconColor:"text-white",textColor:"text-white"},[P.SHUFFLE]:{name:{en:"SHUFFLE",vi:"XÁO BÀI"},description:{en:"Randomly mix the deck.",vi:"Xáo trộn ngẫu nhiên xấp bài."},icon:o,bgColor:"bg-purple-600",borderColor:"border-purple-400",iconColor:"text-white",textColor:"text-white"},[P.SEE_THE_FUTURE]:{name:{en:"SEE FUTURE",vi:"XEM TRƯỚC"},description:{en:"Peek at the top 3 cards of the deck.",vi:"Xem 3 lá bài trên cùng của xấp bài."},icon:c,bgColor:"bg-cyan-600",borderColor:"border-cyan-400",iconColor:"text-white",textColor:"text-white"},[P.NOPE]:{name:{en:"NOPE",vi:"CHẶN!"},description:{en:"Stop other player's action.",vi:"Chặn hành động của người chơi khác."},icon:i,bgColor:"bg-slate-700",borderColor:"border-slate-500",iconColor:"text-white",textColor:"text-white"},[P.CAT_1]:{name:{en:"BLUE CAT",vi:"MÈO XANH"},description:{en:"Collect pairs for special actions.",vi:"Thu thập để dùng combo."},icon:r,bgColor:"bg-slate-800",borderColor:"border-slate-600",iconColor:"text-blue-400",textColor:"text-slate-300",isCombo:!0},[P.CAT_2]:{name:{en:"RED CAT",vi:"MÈO ĐỎ"},description:{en:"Collect pairs for special actions.",vi:"Thu thập để dùng combo."},icon:r,bgColor:"bg-slate-800",borderColor:"border-slate-600",iconColor:"text-red-400",textColor:"text-slate-300",isCombo:!0},[P.CAT_3]:{name:{en:"PURPLE CAT",vi:"MÈO TÍM"},description:{en:"Collect pairs for special actions.",vi:"Thu thập để dùng combo."},icon:r,bgColor:"bg-slate-800",borderColor:"border-slate-600",iconColor:"text-purple-400",textColor:"text-slate-300",isCombo:!0},[P.CAT_4]:{name:{en:"YELLOW CAT",vi:"MÈO VÀNG"},description:{en:"Collect pairs for special actions.",vi:"Thu thập để dùng combo."},icon:r,bgColor:"bg-slate-800",borderColor:"border-slate-600",iconColor:"text-yellow-400",textColor:"text-slate-300",isCombo:!0},[P.CAT_5]:{name:{en:"GREEN CAT",vi:"MÈO LÁ"},description:{en:"Collect pairs for special actions.",vi:"Thu thập để dùng combo."},icon:r,bgColor:"bg-slate-800",borderColor:"border-slate-600",iconColor:"text-green-400",textColor:"text-slate-300",isCombo:!0}},B={2:{name:{en:"PAIR",vi:"CẶP"},description:{en:"Steal a random card from another player.",vi:"Cướp 1 lá bài ngẫu nhiên của người khác."}},3:{name:{en:"THREE OF A KIND",vi:"BỘ 3"},description:{en:"Name a card and steal it from another player.",vi:"Chọn 1 loại bài và cướp 1 lá từ người chơi khác."}},5:{name:{en:"FIVE DIFFERENT CARDS",vi:"BỘ 5 KHÁC LOẠI"},description:{en:"Take any card from the discard pile.",vi:"Lấy bất kỳ lá bài nào từ đống bài đã đánh."}}},F=({state:e,game:t,mySlot:l})=>{const{ti:n}=s(),[r,c]=p.useState(Date.now());if(p.useEffect(()=>{const e=setInterval(()=>{c(Date.now())},100);return()=>clearInterval(e)},[]),e.gamePhase!==A.NOPE_WINDOW||!e.pendingAction)return null;const{action:o,timerStart:d,nopeCount:x,nopeChain:h,entryTimestamp:m}=e.pendingAction,u=o.targetPlayerId,g=u?e.players.find(e=>e.id===u):null,f=m?e.discardHistory.find(e=>e.timestamp===m):null,N=Math.max(0,S-(r-d)),v=l?.hand.filter(e=>e&&e[0]===P.NOPE).length||0,j="ALLOW"===e.pendingAction.responses[t.userId],w=x%2==1,y=h[h.length-1].playerId,C=t.userId===y||0===v;return a.jsx("div",{className:"fixed inset-0 z-70 flex items-center justify-center bg-black/70 backdrop-blur-xl",children:a.jsxs("div",{className:"bg-slate-950 border-4 border-slate-800 rounded-[2.5rem] p-4 shadow-[0_0_50px_rgba(0,0,0,0.5)] max-w-md w-full flex flex-col items-center gap-4 animate-in zoom-in duration-300 relative overflow-hidden",children:[a.jsx("div",{className:"absolute -top-24 -left-24 w-48 h-48 blur-[100px] opacity-20 rounded-full "+(w?"bg-red-500":"bg-green-500")}),a.jsxs("div",{className:"relative",children:[a.jsxs("svg",{className:"w-28 h-28 transform -rotate-90",children:[a.jsx("circle",{cx:"56",cy:"56",r:"52",fill:"transparent",stroke:"currentColor",strokeWidth:"4",className:"text-slate-800"}),a.jsx("circle",{cx:"56",cy:"56",r:"52",fill:"transparent",stroke:"currentColor",strokeWidth:"4",strokeDasharray:326.7,strokeDashoffset:326.7*(1-N/S),strokeLinecap:"round",className:"transition-all duration-100 "+(N<3e3?"text-red-500":"text-yellow-400")})]}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx("span",{className:"text-4xl font-black tabular-nums "+(N<3e3?"text-red-500 animate-pulse":"text-white"),children:(N/1e3).toFixed(1)})})]}),a.jsx("div",{className:"text-center w-full",children:a.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full border mb-4 shadow-lg "+(w?"bg-red-600/20 text-red-400 border-red-500/30":"bg-green-600/20 text-green-400 border-green-500/30"),children:[w?a.jsx(I,{className:"w-5 h-5 font-black"}):a.jsx(b,{className:"w-5 h-5"}),a.jsx("span",{className:"text-sm font-black uppercase tracking-[0.2em]",children:n(w?{en:"BLOCKED!",vi:"ĐÃ CHẶN!"}:{en:"PROGRESSING...",vi:"SẮP THỰC THI..."})})]})}),a.jsx("div",{className:"w-full flex flex-col gap-2 max-h-60 overflow-y-auto overflow-x-hidden custom-scrollbar pr-1 p-2",children:h.map((t,s)=>{const l=e.players.find(e=>e.id===t.playerId),r=t.cardType,i=0===s,c=L[r],o=c.isCombo&&f?.cards.length?B[f.cards.length]?.description:c.description;return a.jsxs("div",{className:"flex flex-wrap gap-2 p-3 rounded-2xl transition-all border "+(s===h.length-1?"bg-slate-800/80 border-slate-600 shadow-lg z-10 scale-[1.02]":"bg-slate-900/30 border-slate-800/50 opacity-60"),children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[a.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-wrap",children:[a.jsx("span",{className:"text-sm font-bold text-white truncate max-w-[100px] @md:max-w-none",children:l?.username||"Unknown"}),i&&g&&a.jsxs(a.Fragment,{children:[a.jsx(E,{className:"w-4 h-4 text-slate-500 shrink-0"}),a.jsx("span",{className:"text-sm font-bold text-blue-400 truncate max-w-[100px] @md:max-w-none",children:g.username})]})]}),a.jsx("span",{className:"text-xs text-slate-500 font-black tracking-tighter my-1",children:n(o)})]}),s===h.length-1&&a.jsx("div",{className:"absolute top-2 right-2 shrink-0 w-2 h-2 rounded-full bg-yellow-400 animate-ping"})]}),a.jsx("div",{className:"flex flex-wrap gap-1.5",children:i&&f&&f.cards.length>0?f.cards.map((e,t)=>a.jsx("div",{className:"shrink-0",children:$(e[0])},t)):a.jsx("div",{className:"shrink-0",children:$(r)})})]},s)})}),C?a.jsx("div",{className:"w-full h-24 flex items-center justify-center",children:a.jsxs("div",{className:"flex flex-col items-center gap-4",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full animate-bounce [animation-delay:-0.3s]"}),a.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full animate-bounce [animation-delay:-0.15s]"}),a.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full animate-bounce"})]}),a.jsx("span",{className:"text-md text-slate-400 animate-pulse",children:n({en:"Waiting for other players to react...",vi:"Chờ người chơi khác phản ứng..."})})]})}):a.jsxs("div",{className:"flex flex-col w-full gap-4 pt-2",children:[a.jsxs("button",{onClick:()=>t.requestRespondNope("NOPE"),disabled:e.players.find(e=>e.id===t.userId)?.isExploded,className:"\n                group relative w-full py-5 rounded-2xl font-black text-2xl flex items-center justify-center gap-3 transition-all\n                bg-red-600 hover:bg-red-500 text-white shadow-[0_10px_30px_rgba(220,38,38,0.4)] hover:-translate-y-1 active:scale-95\n              ",children:[a.jsx(i,{className:"w-8 h-8 animate-wiggle"}),a.jsxs("div",{className:"flex flex-col items-start leading-none",children:[a.jsx("span",{className:"uppercase tracking-widest leading-none",children:n({en:"NOPE!",vi:"CHẶN!"})}),a.jsxs("span",{className:"text-xs opacity-70 mt-1",children:[n({en:"USE 1 CARD",vi:"DÙNG 1 LÁ"})," (",n({en:v+" left",vi:"còn "+v}),")"]})]})]}),a.jsx("button",{onClick:()=>t.requestRespondNope("ALLOW"),disabled:j||e.players.find(e=>e.id===t.userId)?.isExploded,className:`\n                w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all\n                ${j?"bg-slate-900 text-green-500/50 cursor-default border border-green-500/20":"bg-white/5 hover:bg-white/10 text-slate-300 border border-white/10"}\n              `,children:j?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex gap-1 mr-2",children:[a.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-bounce [animation-delay:-0.3s]"}),a.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-bounce [animation-delay:-0.15s]"}),a.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-bounce"})]}),n({en:"READY",vi:"XONG"})]}):a.jsxs(a.Fragment,{children:[a.jsx(T,{className:"w-5 h-5"}),n({en:"SKIP / ALLOW",vi:"BỎ QUA / ĐỒNG Ý"})]})})]})]})})},$=e=>{const t=L[e],s=t.icon;return a.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-md mx-1 align-baseline bg-slate-700",children:[a.jsx("span",{className:`${t.bgColor} ${t.borderColor} p-1.5 rounded-full`,children:a.jsx(s,{className:`w-4 h-4 ${t.iconColor}`})}),a.jsx("span",{className:`text-xs font-black uppercase tracking-tighter ${t.textColor}`,children:n(t.name)})]})};function M({game:n}){const r=n,{confirm:i}=e(),[o]=O(r),[x,m]=p.useState(!1),{username:T}=t(),{ti:S,ts:M}=s(),[U,H]=p.useState([]),[K,_]=p.useState(null),[Y,W]=p.useState(null),[z,q]=p.useState(null),[X,V]=p.useState(null),[Q,J]=p.useState(null),[Z,ee]=p.useState(!1),[te,se]=p.useState([]),le=p.useRef(0),ae=o.players.filter(e=>e.id),[ne,re]=p.useState(null),[ie,ce]=p.useState(!1),[oe,de]=p.useState([]),xe=p.useRef(Array(5).fill(null)),he=p.useRef(Array(5).fill(null)),me=p.useRef(null),ue=p.useRef(null),pe=p.useRef(null),be=p.useRef(null),ge=p.useRef(o.discardPile.length),fe=p.useRef(o.players.map(e=>e.hand.length)),Ne=p.useRef(o.currentTurnIndex),ve=o.players.findIndex(e=>e.id===r.userId),je=ve>=0?o.players[ve]:null,we=o.currentTurnIndex===ve,ye=r.isHost,Ce=p.useMemo(()=>je?je.hand.map((e,t)=>({card:e,originalIndex:t})).sort((e,t)=>e.card?t.card?e.card[0]!==t.card[0]?e.card[0]-t.card[0]:e.card[1]-t.card[1]:-1:1):[],[je?.hand]);D(o.currentTurnIndex,(e,t)=>{o.gamePhase===A.PLAYING&&(null!==e&&l.playTurnSwitch(we),console.log(e,t))}),p.useEffect(()=>{if(o.lastAction&&!o.lastAction.isNoped&&o.lastAction.cardType===P.SEE_THE_FUTURE&&o.lastAction.playerId===r.userId&&_(o.drawPile.slice(-3).reverse()),o.lastAction){const{action:e,playerId:t,isNoped:s,cardType:l}=o.lastAction,a=o.players.find(e=>e.id===t),n=a?.username||"Unknown";let r="",i=b;if("PLAY_CARD"===e.type){const e=L[l||P.EXPLODING_KITTEN];r=M(e.name),i=e.icon}else"PLAY_COMBO"===e.type?(r=2===e.cardIndices.length?M({en:"Pair Combo",vi:"Combo Đôi"}):M({en:"Triplet Combo",vi:"Combo Ba"}),i=f):"DRAW_CARD"===e.type?(r=M({en:"Draw a card",vi:"Rút một lá bài"}),i=w):"DEFUSE"===e.type&&(r=M({en:"Defuse the bomb",vi:"Gỡ bom"}),i=b);const c=++le.current,d=s?M({en:`${n}'s ${r} was BLOCKED!`,vi:`${r} của ${n} đã bị CHẶN!`}):"DRAW_CARD"===e.type?M({en:`${n} drew a card`,vi:`${n} đã rút một lá bài`}):M({en:`${n} executed ${r}`,vi:`${n} đã thực hiện ${r}`});se(e=>[...e,{id:c,message:d,type:s?"error":"success",icon:i}]),setTimeout(()=>{se(e=>e.map(e=>e.id===c?{...e,isExiting:!0}:e)),setTimeout(()=>{se(e=>e.filter(e=>e.id!==c))},500)},5e3)}},[o.lastAction,r.userId]);const ke=p.useMemo(()=>{if(!ne||!pe.current)return null;const{fromPlayerIndex:e,direction:t,sourcePlayerIndex:s}=ne;let l=null,a=null;const n=e=>0===e&&R(be.current)?be.current:R(xe.current?.[e])?xe.current?.[e]:R(he.current?.[e])?he.current?.[e]:(0===e?be.current:xe.current?.[e]||he.current?.[e])||null;return"toDiscard"===t?(l=n(e),a=ue.current):"toHand"===t?(l=me.current,a=n(e)):"playerToPlayer"===t&&void 0!==s&&(l=n(s),a=n(e)),l&&a?{sourceRect:l.getBoundingClientRect(),targetRect:a.getBoundingClientRect()}:null},[ne]),Ie=p.useMemo(()=>{const e=[],t=ve>=0?ve:0;for(let s=0;s<5;s++){const l=(t+s)%5;e.push({slot:o.players[l],actualIndex:l})}return e},[o.players,ve]);p.useEffect(()=>r.onUpdate(e=>{if(e.discardPile.length>ge.current&&e.gamePhase===A.PLAYING){const t=e.discardPile[e.discardPile.length-1],s=Ne.current,l=Ie.findIndex(e=>e.actualIndex===s);ce(!0),re({card:t,fromPlayerIndex:l,direction:"toDiscard"}),setTimeout(()=>{ce(!1),re(null)},400)}e.players.forEach((t,s)=>{const l=fe.current[s]||0,a=t.hand.length;if(a>l&&e.gamePhase===A.PLAYING){const n=s===ve,r=Ie.findIndex(e=>e.actualIndex===s);let i;if(e.gamePhase===A.PLAYING||e.gamePhase===A.FAVOR_GIVING){const t=e.players.findIndex((e,t)=>{const s=fe.current[t]||0;return e.hand.length<s});-1!==t&&t!==s&&(i=Ie.findIndex(e=>e.actualIndex===t))}if(n){const e=a-l;if(e>0){const s=t.hand.slice(-e).map(e=>e[1]);de(s)}}re({card:n?t.hand[a-1]:void 0,fromPlayerIndex:r,sourcePlayerIndex:i,direction:void 0!==i?"playerToPlayer":"toHand",hidden:!n}),setTimeout(()=>{n&&de([]),re(null)},400)}}),ge.current=e.discardPile.length,fe.current=e.players.map(e=>e.hand.length),Ne.current=e.currentTurnIndex}),[r,ve,Ie]);const Ee=(e,t=!1,s,l="medium",n=!1)=>{if(!e){const e={small:"w-12 h-16",medium:"w-20 h-28",large:"w-28 h-40"};return a.jsx("div",{className:`${e[l]} rounded-lg border-2 border-slate-700 bg-slate-800 flex items-center justify-center p-2 shadow-lg`,children:a.jsx("div",{className:"w-full h-full rounded bg-slate-700/50 flex items-center justify-center",children:a.jsx(u,{className:"w-1/2 h-1/2 text-slate-600 opacity-20"})})})}const[r]=e,i=L[r];if(!i)return null;const c=i.icon;return a.jsxs("div",{onClick:s,className:`${{small:"w-12 h-16 text-[10px]",medium:"w-20 h-28 text-xs",large:"w-28 h-40 text-sm"}[l]} relative rounded-lg border-2 ${i.borderColor} ${i.bgColor} flex flex-col items-center justify-center p-2 shadow-lg transition-all select-none ${t?"cursor-pointer hover:-translate-y-2 hover:shadow-xl":""}`,children:[n&&a.jsx("div",{className:"absolute top-1 left-1 opacity-80",children:a.jsx(c,{className:`${"small"===l?"w-3 h-3":"w-5 h-5"} ${i.iconColor}`})}),a.jsx(c,{className:`${"small"===l?"w-4 h-4":"w-8 h-8"} ${i.iconColor} mb-1`}),a.jsx("span",{className:`text-center font-bold ${i.textColor} ${"small"===l?"text-[8px]":"text-[10px] @md:text-xs"} leading-tight`,children:S(i.name)}),"large"===l&&a.jsx("span",{className:`text-xs text-center mt-1 opacity-80 ${i.textColor}`,children:S(i.description||{en:"",vi:""})})]})},Te=()=>{if(!je)return null;const e=U.length,t=U.map(e=>je.hand[e]).filter(e=>!!e);if(0===t.length)return null;const s=t.every(e=>e[0]===t[0][0]),l=t[0][0];let n=!1,i="";return 1===e?l===P.NOPE?i=S({en:"CANNOT PLAY ALONE",vi:"CHỈ DÙNG ĐỂ CHẶN"}):l===P.DEFUSE?i=S({en:"DEFUSE ONLY ON BOMB",vi:"CHỈ DÙNG KHI CÓ BOM"}):l>=P.CAT_1?i=S({en:"COMBO ONLY",vi:"CẦN COMBO"}):n=!0:2===e||3===e?s?n=!0:i=S({en:"MUST BE SAME TYPE",vi:"PHẢI CÙNG LOẠI"}):i=S({en:"INVALID SELECTION",vi:"CHỌN KHÔNG HỢP LỆ"}),n&&!we&&(n=!1,i=S({en:"WAIT YOUR TURN",vi:"ĐỢI TỚI LƯỢT"})),a.jsxs("button",{onClick:()=>n&&(()=>{if(0!==U.length){if(1===U.length){const e=U[0];je.hand[e][0]===P.FAVOR?W(e):r.requestPlayCard(e)}else if(2===U.length||3===U.length){const e=U.map(e=>je.hand[e]);e.every(t=>t[0]===e[0][0])&&(q(U),V("target"))}H([])}})(),disabled:!n,className:`\n                    font-black py-2 px-6 rounded-full shadow-2xl border-2 flex items-center gap-2 transition-all w-max max-w-[90vw]\n                    ${n?"bg-green-600 hover:bg-green-500 text-white border-white animate-in zoom-in-50 duration-200":"bg-slate-700/80 text-slate-400 cursor-not-allowed border-slate-600 backdrop-blur-md"}\n                  `,children:[n?a.jsx(N,{className:"w-5 h-5 fill-current"}):a.jsx(I,{className:"w-5 h-5"}),a.jsx("span",{className:"uppercase",children:n?S(e>1?{en:`PLAY COMBO (${e})`,vi:`DÙNG COMBO (${e})`}:{en:"PLAY CARD",vi:"ĐÁNH BÀI"}):i})]})},Pe=(e,t)=>{const s=Ie[e],l=s.slot,n=o.currentTurnIndex===s.actualIndex,i=null===l.id;return a.jsx("div",{ref:s=>{t&&(t.current[e]=s)},className:`\n          p-2 @md:p-3 min-w-[100px] @md:min-w-[120px] rounded-xl transition-all border-2\n          ${n&&o.gamePhase===A.PLAYING?"border-primary-600 bg-primary-500/10 animate-bounce":"border-slate-700 bg-slate-800/50"}\n          ${i?"border-dashed":""}\n        `,children:i?a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsxs("span",{className:"text-slate-500 text-[10px] text-center uppercase font-medium",children:["Slot ",s.actualIndex+1]}),a.jsxs("div",{className:"flex gap-1 mt-1",children:[ye&&o.gamePhase===A.WAITING&&a.jsx("button",{onClick:()=>r.requestAddBot(s.actualIndex),className:"flex-1 p-1 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center",title:"Add Bot",children:a.jsx(y,{className:"w-5 h-5"})}),!ye&&o.gamePhase===A.WAITING&&!je&&a.jsxs("button",{onClick:()=>r.requestJoinSlot(s.actualIndex,T),className:"flex-1 p-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px] flex items-center justify-center gap-1",children:[a.jsx(C,{className:"w-4 h-4"}),"Join"]})]})]}):a.jsxs("div",{className:"flex flex-col items-center justify-center gap-0.5",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[l.isBot&&a.jsx(y,{className:"w-5 h-5 text-blue-400"}),l.isHost&&a.jsx(k,{className:"w-5 h-5 text-yellow-400"}),a.jsx("span",{className:"text-xs font-medium "+(l.isExploded?"text-red-400":"text-slate-200"),children:l.username}),ye&&o.gamePhase===A.WAITING&&l.isBot&&a.jsx("button",{onClick:()=>r.requestRemovePlayer(s.actualIndex),className:"p-0.5 hover:bg-slate-700 rounded ml-1",children:a.jsx(I,{className:"w-5 h-5 text-red-400"})})]}),o.gamePhase!==A.WAITING&&a.jsx("div",{className:"flex items-center gap-2",children:l.isExploded?a.jsx(u,{className:"w-4 h-4 text-red-500 animate-pulse"}):a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(f,{className:"w-3 h-3 text-slate-400"}),a.jsx("span",{className:"text-xs text-slate-400 font-bold",children:l.hand.length})]})})]})},s.actualIndex)};return a.jsxs("div",{ref:pe,className:"relative flex flex-col h-full p-2 @md:p-4 gap-2 @md:gap-4 overflow-hidden bg-slate-950 rounded-xl pb-16!",children:[a.jsxs("div",{className:"flex justify-center gap-2 @md:gap-8",children:[a.jsxs("div",{className:"flex @md:hidden flex-wrap justify-center gap-2 max-w-full px-2",children:[Pe(1,he),Pe(2,he),Pe(3,he),Pe(4,he)]}),a.jsxs("div",{className:"hidden @md:flex gap-8",children:[Pe(2,xe),Pe(3,xe)]})]}),a.jsxs("div",{className:"flex-1 flex items-center justify-between gap-4",children:[a.jsx("div",{className:"hidden @md:block",children:Pe(1,xe)}),a.jsxs("div",{className:"flex-1 flex flex-col items-center gap-6 justify-center",children:[a.jsxs("div",{className:"flex gap-4 @md:gap-8 items-center justify-center",children:[a.jsxs("button",{ref:me,onClick:()=>{we&&o.gamePhase===A.PLAYING&&r.requestDrawCard()},disabled:!we||o.gamePhase!==A.PLAYING,className:"relative w-20 h-28 @md:w-32 @md:h-44 rounded-xl bg-linear-to-br from-slate-800 to-slate-900 border-2 border-slate-700 shadow-2xl flex flex-col items-center justify-center transition-all hover:scale-105 active:scale-95 disabled:opacity-50 disabled:hover:scale-100",children:[a.jsx("div",{className:"bg-red-600 p-1.5 @md:p-2 rounded-lg mb-2",children:a.jsx(f,{className:"w-6 h-6 @md:w-8 @md:h-8 text-white"})}),a.jsx("span",{className:"text-[10px] @md:text-xs font-bold text-slate-400 uppercase tracking-widest",children:S({en:"DRAW",vi:"RÚT BÀI"})}),a.jsx("span",{className:"absolute -top-2 -right-2 text-white text-[10px] @md:text-xs w-6 h-6 rounded-full flex items-center justify-center font-bold bg-slate-600",children:o.drawPile.length})]}),a.jsxs("div",{ref:ue,onClick:()=>ee(!0),className:"relative w-20 h-28 @md:w-32 @md:h-44 rounded-xl bg-slate-900/50 border-2 border-dashed border-slate-700 flex items-center justify-center cursor-pointer hover:border-slate-500 transition-colors group",children:[a.jsx("div",{className:"absolute inset-x-0 -bottom-4 flex justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx("span",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-widest whitespace-nowrap",children:S({en:"CLICK TO VIEW",vi:"BẤM ĐỂ XEM"})})}),o.discardPile.length>0?a.jsx("div",{className:"relative w-full h-full flex items-center justify-center",children:o.discardPile.slice(-3).map((e,t)=>t===o.discardPile.slice(-3).length-1&&ie?null:a.jsx("div",{className:"absolute transition-all",style:{transform:`rotate(${8*(t-1)}deg)`},children:Ee(e,!1,void 0,"medium")},`${e[1]}-${t}`))}):a.jsx("span",{className:"text-[10px] text-center text-slate-600 font-bold uppercase tracking-widest",children:S({en:"DISCARD",vi:"BÀI ĐÃ ĐÁNH"})})]})]}),o.attackStack>1&&a.jsxs("div",{className:"flex items-center gap-2 bg-orange-500/20 text-yellow-400 px-3 py-1 rounded-full border border-orange-500/30 animate-pulse",children:[a.jsx(h,{className:"w-4 h-4"}),a.jsxs("span",{className:"text-xs font-bold uppercase",children:[o.attackStack," ",S({en:"TURNS REMAINING",vi:"LƯỢT CÒN LẠI"})]})]})]}),a.jsx("div",{className:"hidden @md:block",children:Pe(4,xe)})]}),0===te.length?null:a.jsx("div",{className:"flex flex-col gap-2 pointer-events-none w-full justify-center items-center px-4",children:te.map(e=>{const t=e.icon;return a.jsxs("div",{className:`\n                flex items-center gap-3 px-4 py-3 rounded-2xl border-2 shadow-2xl transition-all duration-500\n                ${e.isExiting?"opacity-0 -translate-y-10 scale-95":"animate-in slide-in-from-top-10 fade-in duration-500"}\n                ${"success"===e.type?"bg-slate-900/90 border-green-500/50 text-green-400 backdrop-blur-md":"bg-slate-900/90 border-red-500/50 text-red-400 backdrop-blur-md"}\n              `,children:[a.jsx("div",{className:"p-2 rounded-xl "+("success"===e.type?"bg-green-500/20":"bg-red-500/20"),children:a.jsx(t,{className:"w-5 h-5"})}),a.jsx("span",{className:"text-xs font-black uppercase tracking-tight leading-tight",children:e.message})]},e.id)})}),a.jsxs("div",{className:"flex flex-col items-center gap-2 @md:gap-4 bg-slate-900/80 backdrop-blur-md rounded-3xl p-3 @md:p-4 border-t border-slate-800 shadow-2xl z-10",children:[a.jsx("div",{className:"text-xs text-center font-bold text-slate-400 bg-slate-800/50 px-4 py-1.5 rounded-full border border-slate-700/50 animate-pulse tracking-wider",children:je?.isExploded?S({en:"You exploded! You are out of the game.",vi:"Bạn đã Nổ tung! Bạn đã bị loại khỏi trò chơi."}):we?o.gamePhase===A.PLAYING?U.length>0?S({en:"Click 'PLAY' to use selected cards, or click to SELECT MORE.",vi:"Bấm 'ĐÁNH' để dùng các lá đã chọn, hoặc CHỌN THÊM."}):S({en:"Your turn! PLAY cards, or DRAW to end your turn.",vi:"Tới lượt bạn! ĐÁNH BÀI, hoặc RÚT BÀI để kết thúc lượt."}):o.gamePhase===A.DEFUSING?S({en:"QUICK! Use a DEFUSE card or you'll explode!",vi:"NHANH LÊN! Dùng lá GỠ BOM nếu không bạn sẽ nổ tung!"}):o.gamePhase===A.INSERTING_KITTEN?S({en:"Choose where to put the kitten back in the deck.",vi:"Chọn vị trí để đặt lại mèo nổ vào xấp bài."}):o.gamePhase===A.NOPE_WINDOW?S({en:"Someone played a card! Can anyone NOPE it?",vi:"Có người vừa đánh bài! Có ai muốn KHÔNG! (NOPE) không?"}):"":S({en:`Waiting for ${o.players[o.currentTurnIndex]?.username}...`,vi:`Đang đợi ${o.players[o.currentTurnIndex]?.username}...`})}),a.jsx("div",{className:"flex items-center gap-4",children:ve>=0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden @md:block",children:Pe(0,xe)}),a.jsx("div",{className:"flex @md:hidden",children:Pe(0,he)})]})}),o.gamePhase!==A.WAITING&&o.gamePhase!==A.ENDED&&(je?a.jsxs("div",{className:"w-full relative mt-4",children:[a.jsx("div",{ref:be,className:"flex justify-center h-32 @md:h-44 relative",children:Ce.map(({card:e,originalIndex:t},s)=>{if(!e)return null;if(oe.includes(e[1]))return null;const l=U.includes(t),n=o.gamePhase===A.PLAYING||o.gamePhase===A.DEFUSING&&e[0]===P.DEFUSE,i=je.hand.length,c=s-(i-1)/2,d=2*c,x=i>12?.75:i>8?.85:1,h=c*(i>12?15:i>8?25:35);return a.jsx("div",{className:"absolute transition-all duration-300 ease-out ",style:{transform:`translateX(${h}px) rotate(${d}deg) translateY(${l?-30:0}px) scale(${x})`,zIndex:l?30:s+10},children:Ee(e,n,()=>{n&&(e=>{if(!je)return;const t=je.hand[e];if(t)if(o.gamePhase===A.PLAYING)if(U.includes(e))H(U.filter(t=>t!==e));else if(t&&t[0]>=P.CAT_1&&t[0]<=P.CAT_5){const e=je.hand.map((e,s)=>e&&e[0]===t[0]?s:-1).filter(e=>-1!==e),s=Array.from(new Set([...U,...e]));H(s)}else H([...U,e]);else o.gamePhase===A.DEFUSING&&t[0]===P.DEFUSE&&(r.requestDefuse(),H([]))})(t)},l?"large":"medium",i>1&&!l)},`${e[1]}-${s}`)})}),U.length>0&&a.jsx("div",{className:"absolute -top-16 left-1/2 -translate-x-1/2 z-50",children:Te()})]}):null),o.gamePhase===A.WAITING&&ye&&a.jsxs("button",{onClick:()=>r.requestStartGame(),disabled:ae.length<2,className:"px-12 py-3 bg-green-600 hover:bg-green-500 text-white rounded-full font-bold flex items-center gap-2 shadow-xl transition-all hover:scale-105 disabled:bg-slate-700 disabled:cursor-not-allowed",children:[a.jsx(N,{className:"w-5 h-5"}),ae.length<2?S({en:"NEED 2+ PLAYERS/BOTS",vi:"CẦN 2+ NGƯỜI CHƠI/BOT"}):S({en:"START GAME",vi:"BẮT ĐẦU"})]}),ye&&o.gamePhase!==A.WAITING&&a.jsxs("button",{onClick:async()=>{await i(M({en:"Current game will be lost. Continue?",vi:"Tiến trình hiện tại sẽ bị mất. Tiếp tục?"}),M({vi:"Chơi lại?",en:"New game?"}))&&r.requestNewGame()},className:"px-4 py-1 text-sm bg-slate-700 hover:bg-slate-600 text-slate-400 rounded-full flex items-center gap-2 transition-all hover:scale-105 cursor-pointer",children:[a.jsx(v,{className:"w-4 h-4"}),S({en:"New Game",vi:"Chơi lại"})]})]}),o.gamePhase===A.DEFUSING&&we?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:a.jsxs("div",{className:"bg-slate-900 border-4 border-red-500 rounded-2xl p-8 shadow-2xl max-w-md w-full animate-pulse",children:[a.jsx("h3",{className:"text-3xl font-black text-red-500 mb-6 text-center tracking-widest",children:S({en:"EXPLODING!",vi:"MÈO NỔ!"})}),a.jsx("div",{className:"flex justify-center mb-8",children:a.jsx(u,{className:"w-24 h-24 text-red-500 animate-bounce"})}),a.jsx("p",{className:"text-white text-center mb-8 font-bold",children:S({en:"You drew an Exploding Kitten! Use a Defuse now!",vi:"Bạn đã bốc phải Mèo Nổ! Hãy dùng Gỡ Bom ngay!"})}),a.jsx("div",{className:"flex justify-center",children:a.jsx("button",{onClick:()=>r.requestDefuse(),className:"px-12 py-4 bg-green-600 hover:bg-green-500 text-white rounded-full font-black text-xl shadow-lg transform hover:scale-105 transition-all",children:S({en:"DEFUSE!",vi:"GỠ BOM!"})})})]})}):null,o.gamePhase===A.INSERTING_KITTEN&&we?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:a.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl p-6 shadow-2xl max-w-md w-full",children:[a.jsxs("h3",{className:"text-xl font-bold text-red-400 mb-4 flex items-center gap-2",children:[a.jsx(u,{className:"w-6 h-6"}),S({en:"Re-insert Kitten",vi:"Đặt lại Bomb mèo"})]}),a.jsx("p",{className:"text-slate-400 mb-6 text-sm",children:S({en:"Choose where to hide the kitten back in the deck:",vi:"Chọn vị trí để đặt lại mèo nổ vào xấp bài:"})}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[a.jsx("button",{onClick:()=>r.requestInsertKitten(0),className:"py-3 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 text-sm font-medium transition-colors",children:S({en:"Top of deck",vi:"Trên cùng"})}),a.jsx("button",{onClick:()=>r.requestInsertKitten(Math.floor(o.drawPile.length/2)),className:"py-3 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 text-sm font-medium transition-colors",children:S({en:"Middle",vi:"Ở giữa"})}),a.jsx("button",{onClick:()=>r.requestInsertKitten(o.drawPile.length),className:"py-3 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 text-sm font-medium transition-colors",children:S({en:"Bottom",vi:"Dưới cùng"})}),a.jsx("button",{onClick:()=>r.requestInsertKitten(Math.floor(Math.random()*(o.drawPile.length+1))),className:"py-3 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 text-sm font-medium transition-colors",children:S({en:"Random",vi:"Ngẫu nhiên"})})]})]})}):null,(()=>{if(o.gamePhase!==A.FAVOR_GIVING||o.favorFrom!==r.userId&&o.favorTo!==r.userId)return null;const e=o.favorFrom===r.userId,t=o.players.find(t=>t.id===(e?o.favorTo:o.favorFrom))?.username||"Unknown";return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:a.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl p-6 shadow-2xl max-w-lg w-full",children:e?a.jsxs(a.Fragment,{children:[a.jsxs("h3",{className:"text-xl font-bold text-blue-400 mb-4 flex items-center gap-2",children:[a.jsx(d,{className:"w-6 h-6"}),S({en:"Give a Favor",vi:"Ban ơn"})]}),a.jsx("p",{className:"text-slate-400 mb-6 text-sm",children:S({en:`${t} requested a card. Pick one to give:`,vi:`${t} yêu cầu 1 lá bài. Chọn 1 lá để đưa:`})}),a.jsx("div",{className:"flex flex-wrap justify-center gap-2 max-h-60 overflow-y-auto p-2",children:je?.hand.map((e,t)=>a.jsx("div",{className:"shrink-0",children:Ee(e,!0,()=>r.requestGiveFavor(t),"medium")},t))})]}):a.jsxs("div",{className:"flex flex-col items-center gap-6 py-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-16 h-16 rounded-full border-4 border-slate-700 border-t-blue-500 animate-spin"}),a.jsx(d,{className:"absolute inset-0 m-auto w-6 h-6 text-blue-400 animate-pulse"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("h3",{className:"text-xl font-bold text-white mb-2 uppercase tracking-widest",children:S({en:"FAVOR PENDING",vi:"ĐANG CHỜ BAN ƠN"})}),a.jsx("p",{className:"text-slate-400 text-sm",children:S({en:`Waiting for ${t} to pick a card for you...`,vi:`Đang chờ ${t} chọn bài cho bạn...`})})]})]})})})})(),(()=>{if(null===Y)return null;const e=o.players.filter(e=>null!==e.id&&e.id!==r.userId&&!e.isExploded);return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:a.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl p-6 shadow-2xl max-w-md w-full",children:[a.jsxs("h3",{className:"text-xl font-bold text-pink-400 mb-4 flex items-center gap-2",children:[a.jsx(d,{className:"w-6 h-6"}),S({en:"Choose Player",vi:"Chọn người chơi"})]}),a.jsx("p",{className:"text-slate-400 mb-6 text-sm",children:S({en:"Pick a player to give you a card:",vi:"Chọn một người chơi để lấy 1 lá bài từ họ:"})}),a.jsx("div",{className:"grid grid-cols-1 gap-3 mb-6",children:e.map(e=>a.jsxs("button",{onClick:()=>{r.requestPlayCard(Y,e.id),W(null)},className:"flex items-center justify-between p-4 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-600 transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(C,{className:"w-5 h-5 text-slate-400"}),a.jsx("span",{className:"text-white font-bold",children:e.username})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(w,{className:"w-4 h-4 text-slate-500"}),a.jsx("span",{className:"text-slate-400 text-xs font-bold",children:e.hand.length})]})]},e.id))}),a.jsx("button",{onClick:()=>W(null),className:"w-full py-2 text-slate-400 hover:text-white transition-colors text-sm",children:S({en:"Cancel",vi:"Hủy"})})]})})})(),K?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:a.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl p-6 shadow-2xl max-w-md w-full relative",children:[a.jsx("button",{onClick:()=>_(null),className:"absolute top-4 right-4 p-2 hover:bg-white/10 rounded-full text-slate-400 z-10",children:a.jsx(I,{className:"w-5 h-5"})}),a.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[a.jsx(c,{className:"w-6 h-6 text-blue-400"}),S({en:"See The Future",vi:"Nhìn thấu tương lai"})]}),a.jsx("p",{className:"text-slate-400 mb-6 text-sm",children:S({en:"Top 3 cards in the draw pile:",vi:"3 lá bài trên cùng của xấp bài:"})}),a.jsx("div",{className:"flex justify-center gap-2",children:K.map((e,t)=>a.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-300",style:{animationDelay:100*t+"ms"},children:Ee(e)},t))}),a.jsx("div",{className:"mt-8 flex justify-center",children:a.jsx("button",{onClick:()=>_(null),className:"px-8 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-full text-sm font-bold transition-all",children:S({en:"GOT IT",vi:"ĐÃ HIỂU"})})})]})}):null,a.jsx(F,{state:o,game:r,mySlot:je}),Z?g.createPortal(a.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 backdrop-blur-md p-4",children:a.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl max-w-2xl w-full max-h-[80vh] flex flex-col shadow-2xl overflow-hidden animate-in zoom-in duration-300",children:[a.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-700 bg-slate-900/50",children:[a.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[a.jsx(f,{className:"w-6 h-6 text-slate-400"}),S({en:"Discard History",vi:"Lịch sử đánh bài"}),a.jsxs("span",{className:"text-sm font-normal text-slate-500 ml-2",children:["(",o.discardPile.length," ",S({en:"cards",vi:"lá"}),")"]})]}),a.jsx("button",{onClick:()=>ee(!1),className:"p-2 hover:bg-white/10 rounded-full text-slate-400 transition-colors",children:a.jsx(I,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"p-4 @md:p-6 overflow-y-auto custom-scrollbar bg-slate-950/30",children:[a.jsx("div",{className:"flex flex-col gap-2",children:[...o.discardHistory].reverse().map((e,t)=>{const s=o.players.find(t=>t.id===e.playerId),l=e.targetPlayerId?o.players.find(t=>t.id===e.targetPlayerId):null,n=s?.id===r.userId;return a.jsxs("div",{className:`flex flex-col gap-3 p-4 bg-slate-800/40 rounded-2xl border ${e.isNoped?"border-red-500/30 bg-red-500/5":"border-slate-700/50"} animate-in fade-in slide-in-from-bottom-2`,style:{animationDelay:50*t+"ms"},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-700 border border-slate-600 flex items-center justify-center text-xs font-black text-white uppercase",children:s?.username?.[0]||"?"}),a.jsxs("span",{className:"text-sm font-black text-white leading-tight flex items-center gap-2 flex-wrap",children:[a.jsxs("span",{children:[s?.username||"Unknown",n&&M({en:" (You)",vi:" (Bạn)"})]}),l&&a.jsxs(a.Fragment,{children:[a.jsx(E,{className:"w-4 h-4 text-slate-500"}),a.jsxs("span",{className:"text-blue-400",children:[l.username,l.id===r.userId&&M({en:" (You)",vi:" (Bạn)"})]})]}),0===e.cards.length&&a.jsxs("span",{className:"text-slate-500 text-xs font-medium lowercase",children:["— ",S({en:"drew a card",vi:"vừa rút bài"})]}),a.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-tight",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})]}),void 0!==e.isNoped&&a.jsx("div",{className:"px-2 py-1 rounded-md text-[10px] font-black uppercase tracking-widest flex items-center gap-1 shadow-sm border "+(e.isNoped?"bg-red-600/20 text-red-500 border-red-500/30":"bg-green-600/40 text-green-400 border-green-500/50 shadow-[0_0_10px_rgba(34,197,94,0.3)]"),children:e.isNoped?a.jsxs(a.Fragment,{children:[a.jsx(I,{className:"w-3 h-3"}),S({en:"Blocked",vi:"Bị chặn"})]}):a.jsxs(a.Fragment,{children:[a.jsx(N,{className:"w-3 h-3"}),S({en:"Executed",vi:"Thực thi"})]})})]}),e.cards.length>0&&a.jsxs("div",{className:"flex flex-col gap-3",children:[e.cards.length>1?a.jsxs("div",{className:"flex items-start gap-4 p-3 bg-slate-900/50 rounded-xl border border-slate-700/50 shadow-inner",children:[a.jsxs("div",{className:"relative shrink-0",children:[a.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center border-2 ${L[e.cards[0][0]].borderColor} ${L[e.cards[0][0]].bgColor} shadow-lg`,children:a.jsx(f,{className:"w-4 h-4 text-white"})}),a.jsxs("div",{className:"absolute -bottom-1 -right-1 bg-yellow-400 text-slate-900 text-[10px] font-black px-1.5 py-0.5 rounded-md border-2 border-slate-900 shadow-sm",children:["x",e.cards.length]})]}),a.jsxs("div",{className:"flex flex-col justify-center",children:[a.jsxs("h4",{className:"text-xs font-black text-white uppercase tracking-wider mb-1",children:[M(B[e.cards.length]?.name)," ",M(L[e.cards?.[0]?.[0]]?.name)]}),a.jsx("span",{className:"text-xs text-slate-400 font-medium leading-relaxed",children:M(B[e.cards.length]?.description)})]})]}):null,a.jsx("div",{className:"flex flex-wrap gap-2 items-center",children:a.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.cards.map((t,s)=>a.jsx("div",{children:Ee(t,!1,void 0,e.cards.length>2?"small":"medium")},s))})})]}),e.nopeChain&&e.nopeChain.length>1&&a.jsx("div",{className:"mt-1 pt-2 border-t border-slate-700/30 flex flex-col gap-1.5",children:e.nopeChain.map((e,t)=>{if(0===t)return null;const s=o.players.find(t=>t.id===e.playerId);return a.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full "+(t%2==1?"bg-red-500":"bg-green-500")}),a.jsx("span",{className:"font-bold text-slate-300",children:s?.username||"Unknown"}),a.jsx("span",{className:"text-slate-500 uppercase font-black",children:M(t%2==1?{en:"Noped",vi:"Chặn"}:{en:"Re-Noped",vi:"Bỏ chặn"})})]},t)})})]},`${e.timestamp}-${t}`)})}),0===o.discardHistory.length&&a.jsx("div",{className:"text-center py-20 text-slate-600 italic",children:S({en:"No cards played yet",vi:"Chưa có lá bài nào được đánh"})})]})]})}),document.body):null,"target"===X&&z?a.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:a.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl max-w-sm w-full p-6 shadow-2xl animate-in zoom-in duration-300",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[a.jsx(h,{className:"w-6 h-6 text-red-500"}),M({en:"Choose Target",vi:"Chọn Đối Thủ"})]}),a.jsx("button",{onClick:()=>{V(null),q(null)},className:"p-1 hover:bg-white/10 rounded-full text-slate-400",children:a.jsx(I,{className:"w-5 h-5"})})]}),a.jsx("p",{className:"text-md text-slate-400 mb-6 italic",children:S({en:a.jsxs(a.Fragment,{children:["Select a player to"," ",a.jsx("span",{className:"text-green-500 font-black",children:"STEAL A CARD"})," ","from using your ",z.length,"-card COMBO"]}),vi:a.jsxs(a.Fragment,{children:["Chọn một người chơi để"," ",a.jsx("span",{className:"text-green-500 font-black",children:"CƯỚP 1 LÁ BÀI"})," ","bằng COMBO ",z.length," LÁ của bạn."]})})}),a.jsx("div",{className:"space-y-3",children:ae.filter(e=>e.id&&e.id!==r.userId&&!e.isExploded).map(e=>a.jsxs("button",{onClick:()=>{J(e.id),2===z.length?(r.requestPlayCombo(z,e.id),V(null),q(null)):V("card_type")},className:"w-full p-4 bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-xl flex items-center justify-between transition-all hover:scale-[1.02]",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(C,{className:"w-5 h-5 text-slate-400"}),a.jsx("span",{className:"font-bold text-white",children:e.username})]}),a.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 uppercase font-black",children:[a.jsx(f,{className:"w-3 h-3"}),e.hand.length]})]},e.id))})]})}):null,(()=>{if("card_type"!==X||!z||!Q)return null;const e=[P.DEFUSE,P.ATTACK,P.SKIP,P.FAVOR,P.SHUFFLE,P.SEE_THE_FUTURE,P.NOPE];return a.jsx("div",{className:"fixed inset-0 z-70 flex items-center justify-center bg-black/90 backdrop-blur-md p-4",children:a.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl max-w-lg w-full p-6 shadow-2xl animate-in zoom-in duration-300",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[a.jsx(d,{className:"w-6 h-6 text-yellow-500"}),M({en:"Name a Card",vi:"Đọc Tên Lá Bài"})]}),a.jsx("button",{onClick:()=>V("target"),className:"px-3 py-1 bg-slate-800 hover:bg-slate-700 rounded-full text-xs text-slate-400",children:M({en:"Back",vi:"Quay lại"})})]}),a.jsx("p",{className:"text-md text-slate-400 mb-6 italic",children:S({en:a.jsxs(a.Fragment,{children:["If the target player has this card, you"," ",a.jsx("span",{className:"text-green-500 font-black",children:"STEAL IT!"})," ",z.length,"-card COMBO"]}),vi:a.jsxs(a.Fragment,{children:["Nếu đối thủ có lá bài này, bạn sẽ"," ",a.jsx("span",{className:"text-green-500 font-black",children:"LẤY ĐƯỢC"})," ","nó! COMBO ",z.length," LÁ của bạn."]})})}),a.jsx("div",{className:"grid grid-cols-2 @md:grid-cols-3 gap-3",children:e.map(e=>{const t=L[e],s=t.icon;return a.jsxs("button",{onClick:()=>{r.requestPlayCombo(z,Q,e),V(null),q(null),J(null)},className:`p-3 rounded-xl border-2 ${t.borderColor} ${t.bgColor} flex flex-col items-center gap-2 transition-all hover:scale-105 shadow-lg group`,children:[a.jsx(s,{className:`w-8 h-8 ${t.iconColor} group-hover:scale-110 transition-transform`}),a.jsx("span",{className:`text-[10px] font-black uppercase text-center ${t.textColor}`,children:M(t.name)})]},e)})})]})})})(),je?.isExploded&&o.gamePhase!==A.ENDED&&a.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur-[2px] pointer-events-none",children:a.jsxs("div",{className:"bg-red-900/80 border-2 border-red-500 rounded-2xl p-6 shadow-2xl flex flex-col items-center gap-4 animate-in zoom-in duration-300 pointer-events-auto",children:[a.jsx(u,{className:"w-16 h-16 text-white animate-pulse"}),a.jsxs("div",{className:"text-center",children:[a.jsx("h3",{className:"text-2xl font-black text-white uppercase italic",children:S({en:"YOU EXPLODED!",vi:"BẠN ĐÃ NỔ TUNG!"})}),a.jsx("p",{className:"text-red-200 font-bold",children:S({en:"Better luck next time!",vi:"Chúc bạn may mắn lần sau!"})})]})]})}),o.gamePhase===A.ENDED&&a.jsx("div",{className:"fixed inset-0 z-100 flex items-center justify-center bg-black/80 backdrop-blur-md",children:a.jsxs("div",{className:"flex flex-col items-center gap-8 animate-in zoom-in duration-500",children:[a.jsx("div",{className:"relative",children:a.jsx(b,{className:"w-32 h-32 text-yellow-400 animate-spin-slow"})}),a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-5xl font-black text-white mb-2 italic",children:o.players.find(e=>e.id===o.winner)?.username}),a.jsx("p",{className:"text-2xl text-yellow-400 font-bold tracking-widest uppercase",children:S({en:"VICTORIOUS!",vi:"CHIẾN THẮNG!"})})]}),r.isHost?a.jsx("button",{onClick:()=>r.requestNewGame(),className:"px-8 py-3 bg-white text-slate-900 rounded-full font-black hover:bg-yellow-400 transition-colors cursor-pointer",children:S({en:"PLAY AGAIN",vi:"CHƠI LẠI"})}):a.jsx("p",{className:"text-md text-slate-400",children:S({en:"Waiting for host..",vi:"Đang chờ chủ phòng.."})})]})}),a.jsx(G,{containerRef:pe,sourceRect:ke?.sourceRect,targetRect:ke?.targetRect,isOpen:!!ne,children:a.jsxs("div",{className:"w-20 h-28 relative",children:[ne?.card&&Ee(ne.card,!1,void 0,"medium"),ne?.hidden&&a.jsx("div",{className:"absolute inset-0 bg-slate-800 rounded-lg border-2 border-slate-600 flex items-center justify-center",children:a.jsx(f,{className:"w-8 h-8 text-slate-500"})})]})}),a.jsx("button",{onClick:()=>m(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-400 transition-colors z-40 shadow-lg border border-slate-500",title:"Rules",children:a.jsx(j,{size:24})}),x&&g.createPortal(a.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-4",children:a.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full shadow-2xl relative",children:[a.jsxs("div",{className:"flex justify-between p-4 pr-2",children:[a.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[a.jsx(j,{className:"w-6 h-6 text-yellow-500"}),S({en:"Game Rules: Exploding Kittens",vi:"Luật Chơi: Mèo Nổ"})]}),a.jsx("button",{onClick:()=>m(!1),className:"p-2 hover:bg-white/10 rounded-full text-slate-400",children:a.jsx(I,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-4 pt-0 space-y-4 text-slate-300 leading-relaxed max-h-[80vh] overflow-y-auto",children:[a.jsx("p",{children:S({en:"Exploding Kittens is a highly-strategic, kitty-powered version of Russian Roulette.",vi:"Mèo Nổ (Exploding Kittens) là một board game thẻ bài chiến thuật pha lẫn may rủi cực kỳ hài hước."})}),a.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:S({en:"1. Goal",vi:"1. Mục tiêu"})}),a.jsx("p",{children:S({en:"Be the last player alive by avoiding the Exploding Kittens. If you draw one without a Defuse, you are out!",vi:"Sống sót đến cuối cùng bằng cách tránh hoặc vô hiệu hóa các lá bài Mèo Nổ. Nếu bạn rút phải lá Mèo Nổ mà không có lá Gỡ bom (Defuse), bạn sẽ bị loại ngay lập tức."})}),a.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:S({en:"2. Setup",vi:"2. Thiết lập"})}),a.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[a.jsx("li",{children:S({en:"Each player starts with 1 Defuse and 6 random cards.",vi:"Mỗi người nhận 1 lá Gỡ bom và 6 lá bài ngẫu nhiên khác."})}),a.jsx("li",{children:S({en:"The deck contains (Players - 1) Exploding Kittens.",vi:"Bỏ số lá Mèo Nổ ít hơn số người chơi 1 lá vào chồng bài rút."})})]}),a.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:S({en:"3. How to Play",vi:"3. Cách chơi"})}),a.jsx("p",{children:S({en:"Your turn has two phases:",vi:"Mỗi lượt chơi của bạn gồm 2 giai đoạn chính:"})}),a.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[a.jsxs("li",{children:[a.jsx("strong",{children:S({en:"Action (Optional):",vi:"Hành động (Tùy chọn):"})})," ",S({en:"Play as many cards as you want from your hand.",vi:"Bạn có thể đánh xuống bao nhiêu lá bài tùy thích để sử dụng chức năng của chúng, hoặc không đánh lá nào."})]}),a.jsxs("li",{children:[a.jsx("strong",{children:S({en:"End Turn (Mandatory):",vi:"Kết thúc lượt (Bắt buộc):"})})," ",S({en:"Draw one card from the deck. If it's not a kitten, you're safe!",vi:"Rút một lá từ chồng bài chung. Nếu đó không phải Mèo Nổ, lượt của bạn kết thúc an toàn."})]})]}),a.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:S({en:"4. Combos",vi:"4. Combo"})}),a.jsx("p",{children:S({en:"Select multiple cards in your hand and click 'PLAY COMBO'.",vi:"Chọn nhiều lá trong tay và nhấn 'DÙNG COMBO'."})}),a.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[a.jsxs("li",{children:[a.jsx("strong",{children:S({en:"Pairs:",vi:"Cặp Đôi:"})})," ",S({en:"Play 2 cards of the same type to steal a random card from another player.",vi:"Đánh 2 lá cùng loại để cướp 1 lá ngẫu nhiên từ người chơi khác."})]}),a.jsxs("li",{children:[a.jsx("strong",{children:S({en:"Triplets:",vi:"Bộ Ba:"})})," ",S({en:"Play 3 cards of the same type to name a card. If the target has it, you steal it.",vi:"Đánh 3 lá cùng loại và đọc tên 1 lá. Nếu đối thủ có lá đó, bạn sẽ lấy được nó."})]})]}),a.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:S({en:"5. Cards",vi:"5. Lá bài"})}),a.jsx("div",{className:"space-y-2",children:Object.entries(L).map(([e,t])=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`${t.bgColor} ${t.borderColor} p-2 rounded-full`,children:a.jsx(t.icon,{className:`w-6 h-6 ${t.iconColor} ${t.icon}`})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold text-yellow-400",children:S(t.name)}),a.jsx("p",{className:"text-sm text-slate-300",children:S(t.description)})]})]},e))}),a.jsx("h3",{className:"text-lg font-bold text-yellow-400 mb-4",children:S({en:"6. Tips",vi:"6. Mẹo"})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("section",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-3",children:a.jsx("h4",{className:"font-bold text-white text-lg",children:S({en:"1. Strategic Card Management",vi:"1. Quản lý lá bài chiến lược"})})}),a.jsxs("div",{className:"space-y-4 pl-2 border-l-2 border-slate-700",children:[a.jsxs("p",{className:"text-sm leading-relaxed",children:[a.jsx("strong",{className:"text-yellow-400",children:S({en:"Keep Defuse until the end:",vi:"Giữ lá Gỡ bom đến cuối:"})})," ",S({en:"Don't rush to use your",vi:"Đừng vội dùng lá"}),$(P.DEFUSE),S({en:"in early turns. It's the most valuable insurance when the deck gets thin.",vi:"ở những lượt đầu nếu không cần thiết, đây là bảo hiểm quý giá nhất về sau khi xấp bài đã mỏng."})]}),a.jsxs("p",{className:"text-sm leading-relaxed",children:[a.jsx("strong",{className:"text-yellow-400",children:S({en:"Use Combos effectively:",vi:"Sử dụng Combo:"})})," ",S({en:"Collect matching cat cards to steal a",vi:"Gom các lá mèo thường (cùng màu) để cướp lá bài"}),$(P.DEFUSE),S({en:"or other important function cards from other players.",vi:"hoặc các lá bài chức năng quan trọng khác từ tay người khác."})]}),a.jsxs("p",{className:"text-sm leading-relaxed",children:[a.jsx("strong",{className:"text-yellow-400",children:S({en:"Master the Nope card:",vi:"Tận dụng lá Không (Nope):"})})," ",S({en:"Keep your",vi:"Hãy giữ lá"}),$(P.NOPE),S({en:"to block incoming attacks or when someone tries to steal from you.",vi:"để chặn các hành động tấn công hoặc khi người khác định cướp bài của bạn."})]})]})]}),a.jsxs("section",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-3",children:a.jsx("h4",{className:"font-bold text-white text-lg",children:S({en:"2. Deck Management",vi:"2. Kiểm soát xấp bài"})})}),a.jsxs("div",{className:"space-y-4 pl-2 border-l-2 border-slate-700",children:[a.jsxs("p",{className:"text-sm leading-relaxed",children:[a.jsx("strong",{className:"text-yellow-400",children:S({en:"Combine See the Future + Shuffle/Skip:",vi:"Kết hợp Xem trước + Xáo bài/Bỏ lượt:"})})," ",S({en:"If you use",vi:"Nếu bạn sử dụng"}),$(P.SEE_THE_FUTURE),S({en:"and see a Kitten on top, use",vi:"và thấy Mèo nổ ở trên cùng, hãy dùng"}),$(P.SHUFFLE),S({en:"to change its position, or",vi:"để đổi vị trí, hoặc"}),$(P.SKIP),S({en:"to end your turn safely without drawing.",vi:"để kết thúc lượt an toàn mà không cần rút bài."})]}),a.jsxs("p",{className:"text-sm leading-relaxed",children:[a.jsx("strong",{className:"text-yellow-400",children:S({en:"Mind Games with Defuse:",vi:"Chơi khăm bằng Gỡ bom:"})})," ",S({en:"When you use a",vi:"Khi bạn sử dụng"}),$(P.DEFUSE),S({en:"to put back an Exploding Kitten, do it secretly. Place it on top or in a position where you want your opponent to draw it.",vi:"để đặt lại lá Mèo nổ, hãy thực hiện bí mật, đặt ngay lên đầu hoặc vị trí mà bạn muốn đối thủ rút phải."})]}),a.jsxs("p",{className:"text-sm leading-relaxed",children:[a.jsx("strong",{className:"text-yellow-400",children:S({en:"Track Defuses:",vi:"Theo dõi Gỡ bom:"})})," ",S({en:"Keep track of how many",vi:"Hãy theo dõi số lượng lá"}),$(P.DEFUSE),S({en:"cards have been used to predict when the bomb will reappear in the deck.",vi:"đã được sử dụng để dự đoán khi nào bom sẽ xuất hiện trở lại trong xấp bài."})]})]})]}),a.jsxs("section",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-3",children:a.jsx("h4",{className:"font-bold text-white text-lg",children:S({en:"3. Offense and Defense",vi:"3. Tấn công và phòng thủ"})})}),a.jsxs("div",{className:"space-y-4 pl-2 border-l-2 border-slate-700",children:[a.jsxs("p",{className:"text-sm leading-relaxed",children:[a.jsx("strong",{className:"text-yellow-400",children:S({en:"Use Attack wisely:",vi:"Sử dụng Tấn công hợp lý:"})})," ",S({en:"Use an",vi:"Sử dụng lá"}),$(P.ATTACK),S({en:"to put pressure on the next player, especially when you suspect or know the top card is an Exploding Kitten.",vi:"để đẩy áp lực cho người tiếp theo, đặc biệt khi bạn biết chắc hoặc nghi ngờ lá trên cùng là Mèo nổ."})]}),a.jsxs("p",{className:"text-sm leading-relaxed",children:[a.jsx("strong",{className:"text-yellow-400",children:S({en:"Shuffle when in doubt:",vi:"Tận dụng Xáo bài khi hoang mang:"})})," ",S({en:"If you feel endangered and don't have a way to see the deck, use",vi:"Nếu bạn cảm thấy nguy hiểm mà không có cách nào xem trước bài, hãy dùng"}),$(P.SHUFFLE),S({en:"to try your luck and escape from a potential Kitten.",vi:"để thử vận may và thoát khỏi nguy cơ bốc phải Mèo nổ."})]})]})]})]})]})]})}),document.body)]})}export{M as default};
