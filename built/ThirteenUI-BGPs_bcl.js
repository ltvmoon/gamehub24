import{b as e,j as s,c as t,S as a,R as l,d as n}from"./index-CxfM0soq.js";import{f as r,E as i,J as d,t as m,X as c,K as x,M as o,B as h,D as u,d as p}from"./react-vendor-CiU7X6n4.js";import"./socket-DRbsQkF5.js";import"./zustand-DTRPoq7m.js";import"./chess-DTd62Tay.js";function g({game:a}){const[l,n]=r.useState(a.getState()),[h,u]=r.useState([]),[p,g]=r.useState(!1),{username:b}=e(),y=a.isHostUser,w=a.getMyPlayerIndex(),v=w>=0?l.players[w]:null,k=l.currentTurnIndex===w,P=a.canStartGame(),$=r.useMemo(()=>{if(0===h.length||!v)return null;const e=h.map(e=>v.hand[e]);return a.validateSelectedCards(e)},[h,v,a]);r.useEffect(()=>{a.onUpdate(e=>{n(e),u([])})},[a]);const C=r.useMemo(()=>{const e=[],s=w>=0?w:0;for(let t=0;t<4;t++){const a=(s+t)%4;e.push({slot:l.players[a],actualIndex:a})}return e},[l.players,w]),S=e=>{const t="desktop"===e,a=t?"min-h-[80px]":"min-h-[60px]",n=t?"text-sm":"text-xs",r=t?"mt-6":"mt-4";return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`relative ${a} flex items-center justify-center`,children:0===l.currentTrick.length?s.jsx("span",{className:"text-slate-500 "+(t?"":"text-sm"),children:"New Round"}):s.jsx("div",{className:"flex cursor-pointer items-center justify-center max-w-[200px]",onClick:()=>g(!p),children:l.currentTrick.map((e,a)=>{const n=e.cards.length>1,r=l.currentTrick.length,i=(p?-30:-90)*a+-(p?-30*(r-1):-90*(r-1))/2,d=a*(t?4:3);return s.jsx("div",{style:{transform:`translateX(${i}%) translateY(${d}px)`},className:`\n                      flex rounded-lg transition-all duration-300 ease-out\n                      ${n?"bg-slate-700/30 ring-1 ring-slate-600":""}\n                    `,children:e.cards.map((e,t)=>s.jsx(j,{index:t,card:e,delay:50*t},t))},a)})})}),"playing"===l.gamePhase&&s.jsx("div",{className:`${n} border-t ${r} pt-2`,children:k?s.jsx("span",{className:"text-primary-400 font-medium",children:"Your Turn"}):s.jsxs("span",{className:"text-slate-400",children:[l.players[l.currentTurnIndex]?.username,"'s Turn"]})})]})},G=e=>{const t="desktop"===e,a=t?"w-12 h-12":"w-8 h-8",n=t?"text-xl":"text-base",r=t?"gap-4":"gap-2";return s.jsxs("div",{className:`flex flex-col items-center ${r}`,children:[s.jsx(o,{className:`${a} text-yellow-400`}),s.jsxs("span",{className:`${n} font-bold text-yellow-400`,children:[l.players.find(e=>e.id===l.winner)?.username," Won!"]})]})},I=(e,t=!1)=>{const n=C[e],r=w>=0;return s.jsx(N,{slot:n.slot,index:n.actualIndex,isCurrentTurn:l.currentTurnIndex===n.actualIndex,isHost:y,gamePhase:l.gamePhase,onAddBot:()=>a.requestAddBot(n.actualIndex),onJoinSlot:()=>a.requestJoinSlot(n.actualIndex,b),onRemove:()=>a.requestRemovePlayer(n.actualIndex),compact:t,isInGame:r},n.actualIndex)};return s.jsxs("div",{className:"flex flex-col h-full p-2 sm:p-4 gap-2 sm:gap-4 overflow-hidden",children:[s.jsxs("div",{className:"flex sm:hidden justify-center gap-2",children:[I(1,!0),I(2,!0),I(3,!0)]}),s.jsx("div",{className:"hidden sm:flex justify-center",children:I(2)}),s.jsxs("div",{className:"hidden sm:flex flex-1 items-center justify-between gap-4",children:[I(1),s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-4 min-h-[200px] bg-slate-800/30 rounded-2xl p-4",children:["waiting"===l.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("span",{className:"text-slate-400",children:"Waiting for players..."}),y&&P&&s.jsxs("button",{onClick:()=>a.requestStartGame(),className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2",children:[s.jsx(i,{className:"w-5 h-5"}),"Start Game"]}),y&&!P&&s.jsx("span",{className:"text-sm text-slate-500",children:"Need at least 2 players to start"})]}),("playing"===l.gamePhase||"ended"===l.gamePhase)&&s.jsx(s.Fragment,{children:S("desktop")}),"ended"===l.gamePhase&&G("desktop")]}),I(3)]}),s.jsxs("div",{className:"flex sm:hidden flex-1 flex-col items-center justify-center gap-2 bg-slate-800/30 rounded-xl p-2 min-h-[120px]",children:["waiting"===l.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for players..."}),y&&P&&s.jsxs("button",{onClick:()=>a.requestStartGame(),className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2 text-sm",children:[s.jsx(i,{className:"w-4 h-4"}),"Start"]}),y&&!P&&s.jsx("span",{className:"text-xs text-slate-500",children:"Need 2+ players"})]}),"playing"===l.gamePhase&&s.jsx(s.Fragment,{children:S("mobile")}),"ended"===l.gamePhase&&G("mobile")]}),s.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-4",children:[s.jsx("div",{className:"hidden sm:block",children:I(0)}),s.jsx("div",{className:"flex sm:hidden",children:I(0,!0)}),v&&"playing"===l.gamePhase&&s.jsx("div",{className:"flex justify-center max-w-full overflow-x-auto overflow-y-visible pt-4 p-0 md:p-4 pb-1",children:v.hand.map((e,t)=>s.jsx(f,{card:e,selected:h.includes(t),onClick:()=>(e=>{k&&"playing"===l.gamePhase&&u(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(t),disabled:!k,index:t},`${e.rank}-${e.suit}`))}),"playing"===l.gamePhase&&k&&s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[$?.valid&&s.jsx("span",{className:"text-green-400 text-xs sm:text-sm font-medium",children:"✓ Valid play"}),!1===$?.valid&&s.jsxs("span",{className:"text-red-400 text-xs sm:text-sm font-medium",children:["⚠️ ",$.error]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>{if(0===h.length||!v)return;const e=h.map(e=>v.hand[e]);a.requestPlayCards(e),u([])},disabled:0===h.length||!$?.valid,className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-900 disabled:cursor-not-allowed rounded-lg font-medium flex items-center gap-1 sm:gap-2 text-sm",children:[s.jsx(i,{className:"w-4 h-4"}),"Play"]}),l.lastCombination&&s.jsxs("button",{onClick:async()=>{await t.getState().confirm("You will not be able to play cards until the next round.","Pass this round?")&&a.requestPass()},className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-red-700 hover:bg-red-600 rounded-lg font-medium flex items-center gap-1 sm:gap-2 text-sm",children:[s.jsx(d,{className:"w-4 h-4"}),"Pass"]})]})]}),"waiting"!==l.gamePhase&&s.jsx("div",{className:"flex gap-2",children:s.jsxs("button",{onClick:async()=>{if(y&&"playing"===l.gamePhase){await t.getState().confirm("This will reset the current game and start fresh.","Start New Game?")&&a.requestNewGame()}else a.requestNewGame()},className:"px-3 py-1.5 sm:px-4 sm:py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs sm:text-sm flex items-center gap-1 sm:gap-2",children:[s.jsx(m,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"New game"]})})]}),y&&l.newGameRequest&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 sm:p-6 max-w-sm w-full shadow-xl",children:[s.jsx("h3",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"New Game Request"}),s.jsxs("p",{className:"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base",children:[s.jsx("span",{className:"font-medium text-white",children:l.newGameRequest.fromName})," ","wants to start a new game."]}),s.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[s.jsxs("button",{onClick:()=>a.declineNewGame(),className:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[s.jsx(c,{className:"w-4 h-4"}),"Decline"]}),s.jsxs("button",{onClick:()=>a.acceptNewGame(),className:"flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[s.jsx(x,{className:"w-4 h-4"}),"Accept"]})]})]})})]})}function f({card:e,selected:t,onClick:r,disabled:i=!1,index:d=0}){const m=e.suit===a.HEART||e.suit===a.DIAMOND?"text-red-500":"text-slate-800",c=0===d?"ml-0":"-ml-5 md:-ml-9";return s.jsx("button",{onClick:r,disabled:i,style:{zIndex:d},className:`\n        ${c}\n        w-10 h-16 md:w-16 md:h-20\n        bg-white rounded-md sm:rounded-lg shadow-lg\n        border-2 transition-all duration-150 font-bold shrink-0 relative\n        ${t?"border-primary-500 -translate-y-3 ring-2 ring-primary-400 shadow-primary-500/30 shadow-xl z-50":"border-slate-300 hover:border-slate-400"}\n        ${!i&&r?(t?"":"md:hover:-translate-y-1")+" cursor-pointer":"cursor-default"}\n      `,children:s.jsxs("div",{className:`absolute top-0.5 left-1 flex flex-col items-center leading-none ${m}`,children:[s.jsx("span",{className:"text-sm md:text-lg font-bold",children:l[e.rank]}),s.jsx("span",{className:"text-sm md:text-sm",children:n[e.suit]})]})})}function j({card:e,delay:t=0,index:r=0}){const i=e.suit===a.HEART||e.suit===a.DIAMOND?"text-red-500":"text-slate-800",d=0===r?"ml-0":"-ml-6 md:-ml-9";return s.jsx("div",{style:{animationDelay:`${t}ms`},className:`\n        ${d}\n        w-10 h-14 md:w-16 md:h-20\n        bg-white rounded-md sm:rounded-lg shadow-lg\n        border-2 border-slate-200 font-bold shrink-0 relative\n        animate-[cardPlay_0.3s_ease-out_forwards]\n      `,children:s.jsxs("div",{className:`absolute top-0.5 left-1 flex flex-col items-center leading-none ${i}`,children:[s.jsx("span",{className:"text-xs md:text-lg font-bold",children:l[e.rank]}),s.jsx("span",{className:"text-[10px] md:text-sm",children:n[e.suit]})]})})}function N({slot:e,index:t,isCurrentTurn:a,isHost:l,gamePhase:n,onAddBot:r,onJoinSlot:i,onRemove:d,compact:m=!1,isInGame:x}){const o=null===e.id,g=l&&"waiting"===n,f=!l&&"waiting"===n&&!x;return s.jsx("div",{className:`\n        ${m?"p-2 min-w-[90px]":"p-2 sm:p-3 min-w-[100px] sm:min-w-[120px]"}\n        rounded-lg sm:rounded-xl transition-all border-2\n        ${e.passed&&"playing"===n?"border-slate-600 bg-slate-900/70 opacity-50":a&&"playing"===n?"border-primary-600 bg-primary-500/10 animate-bounce":"border-slate-700 bg-slate-800/50"}\n        ${o?"border-dashed":""}\n      `,children:o?s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("span",{className:"text-slate-500 text-xs text-center",children:["Slot ",t+1]}),s.jsxs("div",{className:"flex gap-1",children:[g&&s.jsx("button",{onClick:r,className:"flex-1 p-1 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center",title:"Add Bot",children:s.jsx(h,{className:"w-5 h-5"})}),f&&s.jsxs("button",{onClick:i,className:"flex-1 p-1.5 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center gap-1",title:"Join this slot",children:[s.jsx(u,{className:"w-4 h-4"}),"Join"]})]})]}):s.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[e.isBot&&s.jsx(h,{className:"w-5 h-5 text-blue-400"}),e.isGuest&&s.jsx(u,{className:"w-5 h-5 text-green-400"}),e.isHost&&s.jsx(p,{className:"w-5 h-5 text-yellow-400"}),s.jsx("span",{className:"text-xs font-medium",children:e.username}),g&&(e.isBot||e.isGuest)&&s.jsx("button",{onClick:d,className:"p-0.5 hover:bg-slate-700 rounded",title:"Remove",children:s.jsx(c,{className:"w-5 h-5 text-red-400"})})]}),"playing"===n||"ended"===n&&s.jsxs("span",{className:"text-[10px] text-slate-400",children:[e.hand.length," cards"]}),e.passed&&s.jsx("span",{className:"text-[10px] text-yellow-400",children:"Passed"})]})})}export{g as default};
