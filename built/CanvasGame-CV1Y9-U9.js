import{B as t}from"./BaseGame-BjLvdXwv.js";import"./socket-DRbsQkF5.js";class s extends t{state;onStateChange;constructor(t,s,e,a,i){super(t,s,e,a),this.state={strokes:[]},this.init()}init(){this.isHost&&this.broadcastState()}onUpdate(t){this.onStateChange=t,t(this.state)}getState(){return{...this.state}}setState(t){this.state=t,this.onStateChange?.(this.state)}handleAction(t){const s=t.action;"DRAW"===s.type?this.handleDraw(s.payload):"CLEAR"===s.type?this.handleClear():"UNDO"===s.type?this.handleUndo(s.payload):"REQUEST_SYNC"===s.type&&this.isHost&&this.broadcastState()}makeMove(t){if(this.isHost)"DRAW"===t.type&&this.handleDraw(t.payload),"CLEAR"===t.type&&this.handleClear(),"UNDO"===t.type&&this.handleUndo(t.payload);else{if("DRAW"===t.type)this.state.strokes=[...this.state.strokes,t.payload],this.setState({...this.state});else if("CLEAR"===t.type)this.state.strokes=[],this.setState({...this.state});else if("UNDO"===t.type){const s=t.payload;let e=-1;for(let t=this.state.strokes.length-1;t>=0;t--)if(this.state.strokes[t].playerId===s){e=t;break}-1!==e&&(this.state.strokes=this.state.strokes.filter((t,s)=>s!==e),this.setState({...this.state}))}this.sendAction(t)}}handleDraw(t){this.isHost&&(this.state.strokes=[...this.state.strokes,t],this.broadcastState(),this.setState({...this.state}))}handleClear(){this.isHost&&(this.state.strokes=[],this.broadcastState(),this.setState({...this.state}))}handleUndo(t){if(!this.isHost)return;let s=-1;for(let e=this.state.strokes.length-1;e>=0;e--)if(this.state.strokes[e].playerId===t){s=e;break}-1!==s&&(this.state.strokes=this.state.strokes.filter((t,e)=>e!==s),this.broadcastState(),this.setState({...this.state}))}draw(t){const s={type:"DRAW",payload:t};this.makeMove(s)}clear(){this.makeMove({type:"CLEAR"})}undo(){const t={type:"UNDO",payload:this.userId};this.makeMove(t)}requestSync(){const t={type:"REQUEST_SYNC"};this.isHost?this.broadcastState():this.sendAction(t)}checkGameEnd(){return null}reset(){this.handleClear()}updatePlayers(t){}}export{s as default};
