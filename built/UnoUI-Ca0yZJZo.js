import{b as e,j as s,c as a}from"./index-BrrJSH2n.js";import{j as t,Z as l,i as n,a3 as r,a4 as i,K as d,X as c,z as m,M as x,y as o,x as h}from"./react-vendor-BZRLljed.js";import"./socket-DRbsQkF5.js";import{b as u,C as p,a as g,T as f}from"./types-k4MwRBn0.js";import"./zustand-B3oBTGP0.js";function j({game:x}){const o=x,[h,f]=t.useState(o.getState()),[j,w]=t.useState(null),[y,v]=t.useState(!1),[C,P]=t.useState(!1),{username:k}=e(),D=o.isHostUser,I=o.getMyPlayerIndex(),$=I>=0?h.players[I]:null,S=h.currentTurnIndex===I,z=o.canStartGame();t.useEffect(()=>{o.onUpdate(e=>{f(e),w(null)})},[o]);const G=()=>{o.requestDrawCard()},q=t.useMemo(()=>{const e=[],s=I>=0?I:0;for(let a=0;a<4;a++){const t=(s+a)%4;e.push({slot:h.players[t],actualIndex:t})}return e},[h.players,I]),R=h.discardPile[h.discardPile.length-1],T=(e,a=!1)=>{const t=q[e],l=I>=0;return s.jsx(N,{slot:t.slot,index:t.actualIndex,isCurrentTurn:h.currentTurnIndex===t.actualIndex,isHost:D,gamePhase:h.gamePhase,onAddBot:()=>o.requestAddBot(t.actualIndex),onJoinSlot:()=>o.requestJoinSlot(t.actualIndex,k),onRemove:()=>o.requestRemovePlayer(t.actualIndex),compact:a,isInGame:l},t.actualIndex)};return s.jsxs("div",{className:"flex flex-col h-full p-2 sm:p-4 gap-2 sm:gap-4 overflow-hidden",children:[s.jsxs("div",{className:"flex sm:hidden justify-center gap-2",children:[T(1,!0),T(2,!0),T(3,!0)]}),s.jsx("div",{className:"hidden sm:flex justify-center",children:T(2)}),s.jsxs("div",{className:"hidden sm:flex flex-1 items-center justify-between gap-4",children:[T(1),s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-4 min-h-[200px] bg-slate-800/30 rounded-2xl p-4",children:["waiting"===h.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("span",{className:"text-slate-400",children:"Waiting for players..."}),D&&z&&s.jsxs("button",{onClick:()=>o.requestStartGame(),className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2",children:[s.jsx(l,{className:"w-5 h-5"}),"Start Game"]}),D&&!z&&s.jsx("span",{className:"text-sm text-slate-500",children:"Need at least 2 players to start"})]}),"playing"===h.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsxs("button",{onClick:G,disabled:!S,className:"relative w-20 h-28 bg-gradient-to-br from-slate-700 to-slate-900 rounded-xl border-2 border-slate-600 flex items-center justify-center hover:border-slate-400 transition-all disabled:opacity-50",children:[s.jsx(n,{className:"w-8 h-8 text-slate-400"}),s.jsx("span",{className:"absolute bottom-1 text-xs text-slate-400",children:h.drawPile.length})]}),s.jsxs("button",{onClick:()=>P(!0),className:"relative w-20 h-28 cursor-pointer hover:scale-105 transition-transform",title:"Click to view history",children:[h.discardPile.slice(-4).map((e,a,t)=>{const l=a===t.length-1,n=3*(t.length-1-a),r=5*(a-Math.floor(t.length/2));return s.jsx("div",{className:"absolute inset-0 "+(l?"animate-[cardPlay_0.3s_ease-out]":""),style:{transform:`translateX(${n}px) translateY(${-n}px) rotate(${r}deg)`,zIndex:a,opacity:l?1:.7},children:s.jsx(b,{card:e,size:"large"})},e.id)}),R&&s.jsx("div",{className:`absolute -bottom-2 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full border-2 border-white z-10 ${u[h.currentColor]}`}),s.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-slate-600 rounded-full text-[10px] flex items-center justify-center z-20",children:h.discardPile.length})]})]}),h.pendingDraw>0&&s.jsxs("div",{className:"text-lg font-bold text-red-400 animate-pulse",children:["+",h.pendingDraw," cards pending!"]}),s.jsx("div",{className:"text-sm",children:S?s.jsxs("span",{className:"text-primary-400 font-medium",children:["Your Turn",h.hasDrawn&&" - Play drawn card or pass"]}):s.jsxs("span",{className:"text-slate-400",children:[h.players[h.currentTurnIndex]?.username,"'s Turn"]})}),s.jsxs("div",{className:"text-xs text-slate-500",children:["Direction:"," ",1===h.turnDirection?"→ Clockwise":"← Counter-clockwise"]})]}),"ended"===h.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx(r,{className:"w-12 h-12 text-yellow-400"}),s.jsxs("span",{className:"text-xl font-bold text-yellow-400",children:[h.players.find(e=>e.id===h.winner)?.username," ","Won!"]})]})]}),T(3)]}),s.jsxs("div",{className:"flex sm:hidden flex-1 flex-col items-center justify-center gap-2 bg-slate-800/30 rounded-xl p-2 min-h-[120px]",children:["waiting"===h.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for players..."}),D&&z&&s.jsxs("button",{onClick:()=>o.requestStartGame(),className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2 text-sm",children:[s.jsx(l,{className:"w-4 h-4"}),"Start"]})]}),"playing"===h.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("button",{onClick:G,disabled:!S,className:"relative w-14 h-20 bg-gradient-to-br from-slate-700 to-slate-900 rounded-lg border-2 border-slate-600 flex items-center justify-center",children:[s.jsx(n,{className:"w-5 h-5 text-slate-400"}),s.jsx("span",{className:"absolute bottom-0.5 text-[10px] text-slate-400",children:h.drawPile.length})]}),s.jsxs("button",{onClick:()=>P(!0),className:"relative w-14 h-20",children:[h.discardPile.slice(-3).map((e,a,t)=>{const l=a===t.length-1,n=2*(t.length-1-a),r=4*(a-Math.floor(t.length/2));return s.jsx("div",{className:"absolute inset-0 "+(l?"animate-[cardPlay_0.3s_ease-out]":""),style:{transform:`translateX(${n}px) translateY(${-n}px) rotate(${r}deg)`,zIndex:a,opacity:l?1:.6},children:s.jsx(b,{card:e,size:"medium"})},e.id)}),R&&s.jsx("div",{className:`absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-4 rounded-full border border-white z-10 ${u[h.currentColor]}`}),s.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-slate-600 rounded-full text-[8px] flex items-center justify-center z-20",children:h.discardPile.length})]})]}),h.pendingDraw>0&&s.jsxs("div",{className:"text-sm font-bold text-red-400",children:["+",h.pendingDraw," pending"]}),s.jsx("div",{className:"text-xs",children:S?s.jsx("span",{className:"text-primary-400",children:"Your Turn"}):s.jsxs("span",{className:"text-slate-400",children:[h.players[h.currentTurnIndex]?.username,"'s Turn"]})})]}),"ended"===h.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx(r,{className:"w-8 h-8 text-yellow-400"}),s.jsxs("span",{className:"text-base font-bold text-yellow-400",children:[h.players.find(e=>e.id===h.winner)?.username," Won!"]})]})]}),s.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-4",children:[s.jsx("div",{className:"hidden sm:block",children:T(0)}),s.jsx("div",{className:"flex sm:hidden",children:T(0,!0)}),$&&"playing"===h.gamePhase&&s.jsx("div",{className:"w-full overflow-x-auto overflow-y-visible pt-4 pb-1",children:s.jsx("div",{className:"flex w-fit mx-auto px-4",children:$.hand.map((e,a)=>{const t=S&&o.canPlayCardCheck(e);return s.jsx("button",{onClick:()=>(e=>{S&&"playing"===h.gamePhase&&(h.pendingDraw>0||o.canPlayCardCheck(e)&&(e.type===g.WILD||e.type===g.WILD_DRAW_FOUR?(w(e),v(!0)):o.requestPlayCard(e)))})(e),disabled:!S||!t,className:`transition-transform duration-150 ${a>0?"-ml-6 md:-ml-8":""} ${t?"-translate-y-2 hover:-translate-y-3 cursor-pointer":"cursor-not-allowed"}`,style:{zIndex:a},children:s.jsx(b,{card:e,size:"medium"})},e.id)})})}),"playing"===h.gamePhase&&S&&s.jsxs("div",{className:"flex gap-2",children:[h.pendingDraw>0&&s.jsxs("button",{onClick:G,className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-red-600 hover:bg-red-500 rounded-lg font-medium flex items-center gap-1 sm:gap-2 text-sm",children:[s.jsx(n,{className:"w-4 h-4"}),"Draw ",h.pendingDraw]}),h.hasDrawn&&s.jsx("button",{onClick:G,className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-1 sm:gap-2 text-sm",children:"Pass"}),$&&$.hand.length<=2&&!$.calledUno&&s.jsxs("button",{onClick:()=>{o.requestCallUno()},className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-yellow-600 hover:bg-yellow-500 rounded-lg font-bold flex items-center gap-1 sm:gap-2 text-sm animate-pulse",children:[s.jsx(i,{className:"w-4 h-4"}),"UNO!"]})]}),"waiting"!==h.gamePhase&&s.jsx("div",{className:"flex gap-2",children:s.jsxs("button",{onClick:async()=>{if(D&&"playing"===h.gamePhase){await a.getState().confirm("This will reset the current game and start fresh.","Start New Game?")&&o.requestNewGame()}else o.requestNewGame()},className:"px-3 py-1.5 sm:px-4 sm:py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs sm:text-sm flex items-center gap-1 sm:gap-2",children:[s.jsx(d,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"New game"]})})]}),y&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 sm:p-6 shadow-xl",children:[s.jsx("h3",{className:"text-base sm:text-lg font-bold mb-4 text-center",children:"Choose Color"}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:[p.RED,p.BLUE,p.GREEN,p.YELLOW].map(e=>s.jsx("button",{onClick:()=>(e=>{j&&(o.requestPlayCard(j,e),v(!1),w(null))})(e),className:`w-16 h-16 sm:w-20 sm:h-20 rounded-xl ${u[e]} hover:scale-110 transition-transform border-4 border-white/30`},e))}),s.jsx("button",{onClick:()=>{v(!1),w(null)},className:"mt-4 w-full py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm",children:"Cancel"})]})}),D&&h.newGameRequest&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 sm:p-6 max-w-sm w-full shadow-xl",children:[s.jsx("h3",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"New Game Request"}),s.jsxs("p",{className:"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base",children:[s.jsx("span",{className:"font-medium text-white",children:h.newGameRequest.fromName})," ","wants to start a new game."]}),s.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[s.jsxs("button",{onClick:()=>o.declineNewGame(),className:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[s.jsx(c,{className:"w-4 h-4"}),"Decline"]}),s.jsxs("button",{onClick:()=>o.acceptNewGame(),className:"flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[s.jsx(m,{className:"w-4 h-4"}),"Accept"]})]})]})}),C&&s.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>P(!1),children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 sm:p-6 max-w-md w-full max-h-[80vh] shadow-xl",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("h3",{className:"text-base sm:text-lg font-bold",children:["Discard Pile (",h.discardPile.length," cards)"]}),s.jsx("button",{onClick:()=>P(!1),className:"p-1 hover:bg-slate-700 rounded",children:s.jsx(c,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"overflow-y-auto max-h-[60vh] grid grid-cols-4 sm:grid-cols-5 gap-2",children:[...h.discardPile].reverse().map((e,a)=>s.jsx("div",{className:"relative",children:s.jsx(b,{card:e,size:"small"})},`${e.id}-${a}`))})]})})]})}function b({card:e,size:a="medium"}){return s.jsx("div",{className:`\n        ${{small:"w-10 h-14",medium:"w-14 h-20 md:w-16 md:h-24",large:"w-20 h-28"}[a]}\n        ${u[e.color]}\n        rounded-lg md:rounded-xl shadow-lg\n        border-2 border-white/30\n        font-bold text-white\n        ${{small:"text-lg",medium:"text-xl md:text-2xl",large:"text-3xl"}[a]}\n        shrink-0\n        relative\n      `,style:{textShadow:"1px 1px 2px rgba(0,0,0,0.5)"},children:s.jsx("span",{className:"absolute top-0.5 left-1.5",children:e.type===g.NUMBER?e.value?.toString()||"0":f[e.type]})})}function N({slot:e,index:a,isCurrentTurn:t,isHost:l,gamePhase:n,onAddBot:r,onJoinSlot:i,onRemove:d,compact:m=!1,isInGame:u}){const p=null===e.id,g=l&&"waiting"===n,f=!l&&"waiting"===n&&!u;return s.jsx("div",{className:`\n        ${m?"p-2 min-w-[90px]":"p-2 sm:p-3 min-w-[100px] sm:min-w-[120px]"}\n        rounded-lg sm:rounded-xl transition-all border-2\n        ${t&&"playing"===n?"border-primary-600 bg-primary-500/10 animate-bounce":"border-slate-700 bg-slate-800/50"}\n        ${p?"border-dashed":""}\n      `,children:p?s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("span",{className:"text-slate-500 text-xs text-center",children:["Slot ",a+1]}),s.jsxs("div",{className:"flex gap-1",children:[g&&s.jsx("button",{onClick:r,className:"flex-1 p-1 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center",title:"Add Bot",children:s.jsx(x,{className:"w-5 h-5"})}),f&&s.jsxs("button",{onClick:i,className:"flex-1 p-1.5 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center gap-1",title:"Join this slot",children:[s.jsx(o,{className:"w-4 h-4"}),"Join"]})]})]}):s.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[e.isBot&&s.jsx(x,{className:"w-5 h-5 text-blue-400"}),e.isGuest&&s.jsx(o,{className:"w-5 h-5 text-green-400"}),e.isHost&&s.jsx(h,{className:"w-5 h-5 text-yellow-400"}),s.jsx("span",{className:"text-xs font-medium",children:e.username}),g&&(e.isBot||e.isGuest)&&s.jsx("button",{onClick:d,className:"p-0.5 hover:bg-slate-700 rounded",title:"Remove",children:s.jsx(c,{className:"w-5 h-5 text-red-400"})})]}),("playing"===n||"ended"===n)&&s.jsxs("span",{className:"text-[10px] text-slate-400",children:[e.hand.length," cards"]}),e.calledUno&&e.hand.length<=1&&s.jsx("span",{className:"text-[10px] text-yellow-400 font-bold",children:"UNO!"})]})})}export{j as default};
