import{b as e,j as s,c as t}from"./index-BrrJSH2n.js";import{j as a,Z as l,a2 as n,K as r,X as i,z as d,a3 as m,M as c,y as x,x as o}from"./react-vendor-BZRLljed.js";import"./socket-DRbsQkF5.js";import{S as h,a as p,b as u}from"./types-B7pdz5Vg.js";import"./zustand-B3oBTGP0.js";function g({game:c}){const x=c,[o,h]=a.useState(x.getState()),[p,u]=a.useState([]),[g,b]=a.useState(!1),{username:y}=e(),w=x.isHostUser,v=x.getMyPlayerIndex(),k=v>=0?o.players[v]:null,P=o.currentTurnIndex===v,$=x.canStartGame(),C=a.useMemo(()=>{if(0===p.length||!k)return null;const e=p.map(e=>k.hand[e]);return x.validateSelectedCards(e)},[p,k,x]);a.useEffect(()=>{x.onUpdate(e=>{h(e),u([])})},[x]);const S=a.useMemo(()=>{const e=[],s=v>=0?v:0;for(let t=0;t<4;t++){const a=(s+t)%4;e.push({slot:o.players[a],actualIndex:a})}return e},[o.players,v]),G=e=>{const t="desktop"===e,a=t?"min-h-[80px]":"min-h-[60px]",l=t?"text-sm":"text-xs",n=t?"mt-6":"mt-4";return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`relative ${a} flex items-center justify-center`,children:0===o.currentTrick.length?s.jsx("span",{className:"text-slate-500 "+(t?"":"text-sm"),children:"New Round"}):s.jsx("div",{className:"flex cursor-pointer items-center justify-center max-w-[200px]",onClick:()=>b(!g),children:o.currentTrick.map((e,a)=>{const l=e.cards.length>1,n=o.currentTrick.length,r=(g?-30:-90)*a+-(g?-30*(n-1):-90*(n-1))/2,i=a*(t?4:3);return s.jsx("div",{style:{transform:`translateX(${r}%) translateY(${i}px)`},className:`\n                      flex rounded-lg transition-all duration-300 ease-out\n                      ${l?"bg-slate-700/30 ring-1 ring-slate-600":""}\n                    `,children:e.cards.map((e,t)=>s.jsx(j,{index:t,card:e,delay:50*t},t))},a)})})}),"playing"===o.gamePhase&&s.jsx("div",{className:`${l} border-t ${n} pt-2`,children:P?s.jsx("span",{className:"text-primary-400 font-medium",children:"Your Turn"}):s.jsxs("span",{className:"text-slate-400",children:[o.players[o.currentTurnIndex]?.username,"'s Turn"]})})]})},I=e=>{const t="desktop"===e,a=t?"w-12 h-12":"w-8 h-8",l=t?"text-xl":"text-base",n=t?"gap-4":"gap-2";return s.jsxs("div",{className:`flex flex-col items-center ${n}`,children:[s.jsx(m,{className:`${a} text-yellow-400`}),s.jsxs("span",{className:`${l} font-bold text-yellow-400`,children:[o.players.find(e=>e.id===o.winner)?.username," Won!"]})]})},T=(e,t=!1)=>{const a=S[e],l=v>=0;return s.jsx(N,{slot:a.slot,index:a.actualIndex,isCurrentTurn:o.currentTurnIndex===a.actualIndex,isHost:w,gamePhase:o.gamePhase,onAddBot:()=>x.requestAddBot(a.actualIndex),onJoinSlot:()=>x.requestJoinSlot(a.actualIndex,y),onRemove:()=>x.requestRemovePlayer(a.actualIndex),compact:t,isInGame:l},a.actualIndex)};return s.jsxs("div",{className:"flex flex-col h-full p-2 sm:p-4 gap-2 sm:gap-4 overflow-hidden",children:[s.jsxs("div",{className:"flex sm:hidden justify-center gap-2",children:[T(1,!0),T(2,!0),T(3,!0)]}),s.jsx("div",{className:"hidden sm:flex justify-center",children:T(2)}),s.jsxs("div",{className:"hidden sm:flex flex-1 items-center justify-between gap-4",children:[T(1),s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-4 min-h-[200px] bg-slate-800/30 rounded-2xl p-4",children:["waiting"===o.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("span",{className:"text-slate-400",children:"Waiting for players..."}),w&&$&&s.jsxs("button",{onClick:()=>x.requestStartGame(),className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2",children:[s.jsx(l,{className:"w-5 h-5"}),"Start Game"]}),w&&!$&&s.jsx("span",{className:"text-sm text-slate-500",children:"Need at least 2 players to start"})]}),("playing"===o.gamePhase||"ended"===o.gamePhase)&&s.jsx(s.Fragment,{children:G("desktop")}),"ended"===o.gamePhase&&I("desktop")]}),T(3)]}),s.jsxs("div",{className:"flex sm:hidden flex-1 flex-col items-center justify-center gap-2 bg-slate-800/30 rounded-xl p-2 min-h-[120px]",children:["waiting"===o.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for players..."}),w&&$&&s.jsxs("button",{onClick:()=>x.requestStartGame(),className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2 text-sm",children:[s.jsx(l,{className:"w-4 h-4"}),"Start"]}),w&&!$&&s.jsx("span",{className:"text-xs text-slate-500",children:"Need 2+ players"})]}),"playing"===o.gamePhase&&s.jsx(s.Fragment,{children:G("mobile")}),"ended"===o.gamePhase&&I("mobile")]}),s.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-4",children:[s.jsx("div",{className:"hidden sm:block",children:T(0)}),s.jsx("div",{className:"flex sm:hidden",children:T(0,!0)}),k&&"playing"===o.gamePhase&&s.jsx("div",{className:"flex justify-center max-w-full overflow-x-auto overflow-y-visible pt-4 p-0 md:p-4 pb-1",children:k.hand.map((e,t)=>s.jsx(f,{card:e,selected:p.includes(t),onClick:()=>(e=>{P&&"playing"===o.gamePhase&&u(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(t),disabled:!P,index:t},`${e.rank}-${e.suit}`))}),"playing"===o.gamePhase&&P&&s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[C?.valid&&s.jsx("span",{className:"text-green-400 text-xs sm:text-sm font-medium",children:"✓ Valid play"}),!1===C?.valid&&s.jsxs("span",{className:"text-red-400 text-xs sm:text-sm font-medium",children:["⚠️ ",C.error]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>{if(0===p.length||!k)return;const e=p.map(e=>k.hand[e]);x.requestPlayCards(e),u([])},disabled:0===p.length||!C?.valid,className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-900 disabled:cursor-not-allowed rounded-lg font-medium flex items-center gap-1 sm:gap-2 text-sm",children:[s.jsx(l,{className:"w-4 h-4"}),"Play"]}),o.lastCombination&&s.jsxs("button",{onClick:async()=>{await t.getState().confirm("You will not be able to play cards until the next round.","Pass this round?")&&x.requestPass()},className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-red-700 hover:bg-red-600 rounded-lg font-medium flex items-center gap-1 sm:gap-2 text-sm",children:[s.jsx(n,{className:"w-4 h-4"}),"Pass"]})]})]}),"waiting"!==o.gamePhase&&s.jsx("div",{className:"flex gap-2",children:s.jsxs("button",{onClick:async()=>{if(w&&"playing"===o.gamePhase){await t.getState().confirm("This will reset the current game and start fresh.","Start New Game?")&&x.requestNewGame()}else x.requestNewGame()},className:"px-3 py-1.5 sm:px-4 sm:py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs sm:text-sm flex items-center gap-1 sm:gap-2",children:[s.jsx(r,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"New game"]})})]}),w&&o.newGameRequest&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 sm:p-6 max-w-sm w-full shadow-xl",children:[s.jsx("h3",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"New Game Request"}),s.jsxs("p",{className:"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base",children:[s.jsx("span",{className:"font-medium text-white",children:o.newGameRequest.fromName})," ","wants to start a new game."]}),s.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[s.jsxs("button",{onClick:()=>x.declineNewGame(),className:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[s.jsx(i,{className:"w-4 h-4"}),"Decline"]}),s.jsxs("button",{onClick:()=>x.acceptNewGame(),className:"flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[s.jsx(d,{className:"w-4 h-4"}),"Accept"]})]})]})})]})}function f({card:e,selected:t,onClick:a,disabled:l=!1,index:n=0}){const r=e.suit===h.HEART||e.suit===h.DIAMOND?"text-red-500":"text-slate-800",i=0===n?"ml-0":"-ml-5 md:-ml-9";return s.jsx("button",{onClick:a,disabled:l,style:{zIndex:n},className:`\n        ${i}\n        w-10 h-16 md:w-16 md:h-20\n        bg-white rounded-md sm:rounded-lg shadow-lg\n        border-2 transition-all duration-150 font-bold shrink-0 relative\n        ${t?"border-primary-500 -translate-y-3 ring-2 ring-primary-400 shadow-primary-500/30 shadow-xl z-50":"border-slate-300 hover:border-slate-400"}\n        ${!l&&a?(t?"":"md:hover:-translate-y-1")+" cursor-pointer":"cursor-default"}\n      `,children:s.jsxs("div",{className:`absolute top-0.5 left-1 flex flex-col items-center leading-none ${r}`,children:[s.jsx("span",{className:"text-sm md:text-lg font-bold",children:p[e.rank]}),s.jsx("span",{className:"text-sm md:text-sm",children:u[e.suit]})]})})}function j({card:e,delay:t=0,index:a=0}){const l=e.suit===h.HEART||e.suit===h.DIAMOND?"text-red-500":"text-slate-800",n=0===a?"ml-0":"-ml-6 md:-ml-9";return s.jsx("div",{style:{animationDelay:`${t}ms`},className:`\n        ${n}\n        w-10 h-14 md:w-16 md:h-20\n        bg-white rounded-md sm:rounded-lg shadow-lg\n        border-2 border-slate-200 font-bold shrink-0 relative\n        animate-[cardPlay_0.3s_ease-out_forwards]\n      `,children:s.jsxs("div",{className:`absolute top-0.5 left-1 flex flex-col items-center leading-none ${l}`,children:[s.jsx("span",{className:"text-xs md:text-lg font-bold",children:p[e.rank]}),s.jsx("span",{className:"text-[10px] md:text-sm",children:u[e.suit]})]})})}function N({slot:e,index:t,isCurrentTurn:a,isHost:l,gamePhase:n,onAddBot:r,onJoinSlot:d,onRemove:m,compact:h=!1,isInGame:p}){const u=null===e.id,g=l&&"waiting"===n,f=!l&&"waiting"===n&&!p;return s.jsx("div",{className:`\n        ${h?"p-2 min-w-[90px]":"p-2 sm:p-3 min-w-[100px] sm:min-w-[120px]"}\n        rounded-lg sm:rounded-xl transition-all border-2\n        ${e.passed&&"playing"===n?"border-slate-600 bg-slate-900/70 opacity-50":a&&"playing"===n?"border-primary-600 bg-primary-500/10 animate-bounce":"border-slate-700 bg-slate-800/50"}\n        ${u?"border-dashed":""}\n      `,children:u?s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("span",{className:"text-slate-500 text-xs text-center",children:["Slot ",t+1]}),s.jsxs("div",{className:"flex gap-1",children:[g&&s.jsx("button",{onClick:r,className:"flex-1 p-1 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center",title:"Add Bot",children:s.jsx(c,{className:"w-5 h-5"})}),f&&s.jsxs("button",{onClick:d,className:"flex-1 p-1.5 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center gap-1",title:"Join this slot",children:[s.jsx(x,{className:"w-4 h-4"}),"Join"]})]})]}):s.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[e.isBot&&s.jsx(c,{className:"w-5 h-5 text-blue-400"}),e.isGuest&&s.jsx(x,{className:"w-5 h-5 text-green-400"}),e.isHost&&s.jsx(o,{className:"w-5 h-5 text-yellow-400"}),s.jsx("span",{className:"text-xs font-medium",children:e.username}),g&&(e.isBot||e.isGuest)&&s.jsx("button",{onClick:m,className:"p-0.5 hover:bg-slate-700 rounded",title:"Remove",children:s.jsx(i,{className:"w-5 h-5 text-red-400"})})]}),"playing"===n||"ended"===n&&s.jsxs("span",{className:"text-[10px] text-slate-400",children:[e.hand.length," cards"]}),e.passed&&s.jsx("span",{className:"text-[10px] text-yellow-400",children:"Passed"})]})})}export{g as default};
