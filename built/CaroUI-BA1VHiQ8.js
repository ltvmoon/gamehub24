import{b as e,j as t}from"./index-DvVjFfh0.js";import{i as s,X as n,e as l,J as o,M as i,O as a,Q as r,F as c}from"./react-vendor-DdoU0YZ6.js";import"./socket-DRbsQkF5.js";import"./zustand-BHVQ_asN.js";import"./chess-DTd62Tay.js";const h=50,d=40;function x({game:x}){const[m,u]=s.useState(x.getState()),{userId:p}=e(),{board:g,winningLine:f,pendingUndoRequest:w}=m,v=x.getPlayerSymbol(),j=m.currentTurn===v;s.useEffect(()=>{x.onUpdate(e=>u(e))},[x]);const b=s.useRef(null),y=s.useRef(null),[N,M]=s.useState({x:20,y:20}),[k,O]=s.useState(!1),[Y,T]=s.useState({x:0,y:0,viewportX:0,viewportY:0}),[X,S]=s.useState(null),[C,q]=s.useState({width:600,height:600}),R=()=>{const e=m.history;if(0===e.length)return null;const t=e[e.length-1],[s,n]=t.split(",").map(Number);return{row:s,col:n}};s.useEffect(()=>{const e=()=>{if(y.current){const e=y.current.clientWidth,t=window.innerHeight-200,s=Math.min(e,t,600);q({width:s,height:s})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{const e=b.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.clearRect(0,0,C.width,C.height);const s=d,n=Math.ceil(C.width/s),l=Math.ceil(C.height/s),o=-N.x*s%s,i=-N.y*s%s,a=Math.floor(N.x),r=Math.floor(N.y);t.strokeStyle="#334155",t.lineWidth=1;for(let c=0;c<=n+1;c++){const e=o+c*s;t.beginPath(),t.moveTo(e,0),t.lineTo(e,C.height),t.stroke()}for(let c=0;c<=l+1;c++){const e=i+c*s;t.beginPath(),t.moveTo(0,e),t.lineTo(C.width,e),t.stroke()}if(X&&j&&!m.gameOver){const e=X.col-a,c=X.row-r;e>=0&&e<n&&c>=0&&c<l&&(t.fillStyle="rgba(148, 163, 184, 0.2)",t.fillRect(o+e*s,i+c*s,s,s))}for(let c=0;c<n+1;c++)for(let e=0;e<l+1;e++){const n=a+c,l=r+e;if(n<0||n>=h||l<0||l>=h)continue;const d=g[`${l},${n}`];if(!d)continue;const x=o+c*s+20,m=i+e*s+20,u=f?.some(([e,t])=>e===l&&t===n),p=R(),w=p&&p.row===l&&p.col===n;if(w&&!u&&(t.fillStyle="rgba(251, 191, 36, 0.25)",t.fillRect(o+c*s,i+e*s,s,s)),"X"===d){t.strokeStyle=u?"#4ade80":"#3b82f6",t.lineWidth=w?4:3;const e=12;t.beginPath(),t.moveTo(x-e,m-e),t.lineTo(x+e,m+e),t.stroke(),t.beginPath(),t.moveTo(x+e,m-e),t.lineTo(x-e,m+e),t.stroke()}else{t.strokeStyle=u?"#4ade80":"#ef4444",t.lineWidth=w?4:3;const e=10;t.beginPath(),t.arc(x,m,e,0,2*Math.PI),t.stroke()}}t.fillStyle="#64748b",t.font="10px monospace",t.fillText(`(${a}, ${r})`,5,15)},[N,g,f,X,j,m.gameOver,C]);const P=(e,t)=>{const s=b.current;if(!s)return null;const n=s.getBoundingClientRect(),l=e-n.left,o=t-n.top,i=Math.floor(N.x+l/40),a=Math.floor(N.y+o/40);return i<0||i>=h||a<0||a>=h?null:{row:a,col:i}};return t.jsxs("div",{className:"flex flex-col gap-3 p-2 md:p-4 w-full",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"text-sm font-semibold",children:m.gameOver?m.winner?t.jsx("span",{className:m.winner===v?"text-green-400":"text-red-400",children:m.winner===v?"You Won!":"Opponent Won!"}):t.jsx("span",{className:"text-yellow-400",children:"Draw!"}):t.jsx("span",{className:j?"text-primary-400":"text-slate-400",children:j?"Your Turn":"Opponent's Turn"})}),t.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(n,{className:"w-3 h-3 text-blue-400"})," ","X"===v?"You":"Opp"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(l,{className:"w-3 h-3 text-red-400"})," ","O"===v?"You":"Opp"]})]})]}),t.jsxs("div",{className:"flex gap-1 md:gap-2 text-xs",children:[x.isHostUser&&!m.players.O&&!m.gameOver&&t.jsxs("button",{onClick:()=>x.addBot(),className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1",title:"Play against Bot",children:[t.jsx(o,{className:"w-3 h-3"}),t.jsx("span",{children:"Vs Bot"})]}),m.gameOver?t.jsxs("button",{onClick:()=>x.requestReset(),className:"px-2 py-1 bg-primary-600 hover:bg-primary-500 rounded text-white flex items-center gap-1",title:"New game",children:[t.jsx(i,{className:"w-3 h-3"}),t.jsx("span",{children:"New Game"})]}):Object.keys(g).length>0?t.jsxs("button",{onClick:()=>{const e=R();if(!e)return;const t=C.width/d,s=C.height/d,n=Math.max(0,e.col-t/2+.5),l=Math.max(0,e.row-s/2+.5),o=N.x,i=N.y,a=performance.now(),r=e=>{const t=e-a,s=Math.min(t/300,1),c=1-Math.pow(1-s,3);M({x:o+(n-o)*c,y:i+(l-i)*c}),s<1&&requestAnimationFrame(r)};requestAnimationFrame(r)},disabled:0===Object.keys(g).length,className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",title:"Focus to last move",children:[t.jsx(a,{className:"w-3 h-3"}),t.jsx("span",{children:"Last"})]}):null,!m.gameOver&&Object.keys(g).length>0&&!j&&!w&&t.jsxs("button",{onClick:()=>x.requestUndo(),className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1",title:"Request undo from opponent",children:[t.jsx(r,{className:"w-3 h-3"}),t.jsx("span",{children:"Undo"})]}),!m.gameOver&&0===Object.keys(g).length&&j&&t.jsxs("button",{onClick:()=>x.switchTurn(),className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1",title:"Give first move to opponent",children:[t.jsx(c,{className:"w-3 h-3"}),t.jsx("span",{children:"Give First Move"})]})]})]}),w&&t.jsxs("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg border border-slate-700",children:[w===p&&t.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-amber-400",children:[t.jsx(r,{className:"w-4 h-4 animate-pulse"}),t.jsx("span",{children:"Waiting for opponent to respond to undo request..."})]}),w!==p&&t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-300",children:[t.jsx(r,{className:"w-4 h-4 text-amber-400"}),t.jsx("span",{children:"Opponent is requesting to undo their last move"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>x.responseUndo(!0),className:"px-3 py-1.5 bg-green-600 hover:bg-green-500 rounded text-white text-sm font-medium flex items-center gap-1.5",title:"Allow undo",children:t.jsx("span",{children:"Allow"})}),t.jsx("button",{onClick:()=>x.responseUndo(!1),className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 rounded text-white text-sm font-medium flex items-center gap-1.5",title:"Deny undo",children:t.jsx("span",{children:"Deny"})})]})]})]}),t.jsx("div",{ref:y,className:"w-full flex items-center justify-center",children:t.jsx("canvas",{ref:b,width:C.width,height:C.height,style:{width:C.width,height:C.height},className:"border-2 border-slate-700 rounded-lg bg-slate-900 cursor-move touch-none",onMouseDown:e=>{O(!0),T({x:e.clientX,y:e.clientY,viewportX:N.x,viewportY:N.y})},onMouseMove:e=>{const t=P(e.clientX,e.clientY);if(S(t),k){const t=(Y.x-e.clientX)/d,s=(Y.y-e.clientY)/d;M({x:Math.max(0,Math.min(49,Y.viewportX+t)),y:Math.max(0,Math.min(49,Y.viewportY+s))})}},onMouseUp:()=>{O(!1)},onMouseLeave:()=>{O(!1),S(null)},onClick:e=>{if(Math.abs(e.clientX-Y.x)>5||Math.abs(e.clientY-Y.y)>5)return;if(!j||m.gameOver)return;const t=P(e.clientX,e.clientY);if(!t)return;const s=`${t.row},${t.col}`;g[s]||x.requestMove(t.row,t.col)},onTouchStart:e=>{const t=e.touches[0];O(!0),T({x:t.clientX,y:t.clientY,viewportX:N.x,viewportY:N.y})},onTouchMove:e=>{const t=e.touches[0],s=P(t.clientX,t.clientY);if(S(s),k){const e=(Y.x-t.clientX)/d,s=(Y.y-t.clientY)/d;M({x:Math.max(0,Math.min(49,Y.viewportX+e)),y:Math.max(0,Math.min(49,Y.viewportY+s))})}},onTouchEnd:e=>{const t=e.changedTouches[0];if(Math.abs(t.clientX-Y.x)>5||Math.abs(t.clientY-Y.y)>5)return O(!1),void S(null);if(O(!1),S(null),!j||m.gameOver)return;const s=P(t.clientX,t.clientY);if(!s)return;const n=`${s.row},${s.col}`;g[n]||x.requestMove(s.row,s.col)}})}),t.jsx("div",{className:"text-xs text-slate-500 text-center",children:"Drag to pan â€¢ Click to place"})]})}export{x as default};
