import{a as e,u as s,S as t,j as n}from"./index-7ewwbQld.js";import{b as i,c as a,aI as l,j as r,aM as c,X as o}from"./react-vendor-BLBa7-IT.js";import"./Chess-CmMuEQzd.js";import{C as d}from"./chess-DTd62Tay.js";import{C as h}from"./chessground-CpDKPGt0.js";import{u as x}from"./useGameState-DJPJV8mx.js";import{u as m}from"./usePrevious-O36GIYFB.js";import"./socket-DRbsQkF5.js";import"./zustand-BEg5S8SY.js";import"./BaseGame-D8z93T-B.js";function u({game:u}){const g=u,[v]=x(g),{userId:p}=e(),{ti:b,ts:w}=s(),[f,j]=i.useState(!1),N=i.useRef(null),y=i.useRef(null),k=g.getPlayerColor(),C=!!k&&v.turn===k,M=v.check;m(v.turn,(e,s)=>{v.gameOver||null!==e&&t.playTurnSwitch(C)}),i.useEffect(()=>{if(!N.current)return;const e="w"===k?"white":"black",s={fen:v.fen,orientation:e,turnColor:"w"===v.turn?"white":"black",movable:{free:!1,color:C?k:void 0,dests:q(v.fen)},events:{move:(e,s)=>{const t=new d(v.fen).get(e),n="p"===t?.type&&("w"===t.color&&"8"===s[1]||"b"===t.color&&"1"===s[1]);g.requestMove(e,s,n?"q":void 0)}},draggable:{enabled:!0,showGhost:!0},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200}};y.current?y.current.set({fen:v.fen,turnColor:"w"===v.turn?"white":"black",movable:{free:!1,color:C&&!v.gameOver?e:void 0,dests:C?q(v.fen):new Map},check:M?"w"===v.turn?"white":"black":void 0,lastMove:v.lastMove?[v.lastMove.from,v.lastMove.to]:void 0}):y.current=h(N.current,s);const t=new ResizeObserver(()=>{y.current&&y.current.redrawAll()});return N.current&&t.observe(N.current),()=>{t.disconnect()}},[v.fen,C,v.gameOver,k]);const q=e=>{const s=new Map;if(!C||v.gameOver)return s;const t=new d(e).moves({verbose:!0});for(const n of t){const e=n.from,t=n.to;s.has(e)||s.set(e,[]),s.get(e)?.push(t)}return s};return n.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-2xl mx-auto pb-16!",children:[n.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-slate-800 rounded-lg w-full max-w-[400px] mx-auto",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-1",children:b({en:"Players",vi:"Ng∆∞·ªùi ch∆°i"})}),["white","black"].map(e=>{const s=v.players[e],t=s?.isBot,i=v.turn===("white"===e?"w":"b")&&!v.gameOver,a=s?.id===p;return n.jsxs("div",{className:`\n                flex items-center justify-between p-2 rounded-lg\n                ${i?"bg-slate-600 ring-2 ring-yellow-400":"bg-slate-700"}\n              `,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center "+("white"===e?"bg-white":"bg-black")}),n.jsxs("span",{className:"text-white",children:[t?"Bot":s?s.username:b({en:"(waiting...)",vi:"(ƒëang ch·ªù...)"}),t&&" ü§ñ",a&&s&&b({en:" (You)",vi:" (B·∫°n)"})]})]}),t&&g.isHost&&!v.gameOver&&n.jsx("button",{onClick:()=>g.removeBot(),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:b({en:"Remove",vi:"X√≥a"})}),!s&&g.isHost&&!v.gameOver&&n.jsxs("button",{onClick:()=>g.addBot(),disabled:v.isBotLoading,className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors flex items-center gap-1",children:[v.isBotLoading?n.jsx("span",{className:"w-3 h-3 border-2 border-white/20 border-t-white rounded-full animate-spin"}):n.jsx(l,{className:"w-3 h-3"}),b({en:"Add Bot",vi:"Th√™m Bot"})]})]},e)})]}),v.gameOver?n.jsx("div",{className:"text-lg font-bold text-center my-2",children:v.winner?n.jsx("span",{className:v.winner===("w"===k?"white":"black")?"text-green-400":"text-red-400",children:v.winner===(p===v.players.white?.id?"white":"black")?b({en:"You Won!",vi:"B·∫°n th·∫Øng!"}):b({en:"Opponent Won!",vi:"ƒê·ªëi th·ªß th·∫Øng!"})}):n.jsx("span",{className:"text-yellow-400",children:b({en:"Draw!",vi:"H√≤a!"})})}):M&&v.turn===k&&n.jsx("div",{className:"text-center my-2",children:n.jsx("div",{className:"text-red-400 font-bold animate-pulse",children:b({en:"Check!",vi:"Chi·∫øu!"})})}),n.jsxs("div",{className:"flex flex-col gap-2 justify-center items-center w-full",children:[n.jsx("div",{className:"text-lg text-gray-400",children:C?n.jsx("span",{className:"text-green-400",children:b({en:"Your turn!",vi:"L∆∞·ª£t c·ªßa b·∫°n!"})}):n.jsxs("span",{children:[b({en:"Waiting for",vi:"ƒêang ch·ªù"})," ",v.players["w"===k?"black":"white"]?.username," ",b({en:"...",vi:"..."})]})}),!v.gameOver&&!v.pendingNewGameRequest&&n.jsxs("button",{onClick:()=>g.requestReset(),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[n.jsx(r,{className:"w-4 h-4"}),b({en:"New Game",vi:"V√°n m·ªõi"})]}),v.gameOver&&n.jsxs("button",{onClick:()=>g.requestReset(),className:"px-6 py-2 bg-primary-600 hover:bg-primary-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[n.jsx(r,{className:"w-4 h-4"}),b({en:"Play Again",vi:"Ch∆°i l·∫°i"})]})]}),v.pendingNewGameRequest&&v.pendingNewGameRequest!==p&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-xl flex flex-col gap-4 max-w-sm w-full",children:[n.jsx("div",{className:"text-lg text-white font-medium text-center",children:b({en:"Opponent wants to start a new game",vi:"ƒê·ªëi th·ªß mu·ªën ch∆°i v√°n m·ªõi"})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>g.onSocketGameAction({action:{type:"NEW_GAME_RESPONSE",accepted:!0}}),className:"flex-1 bg-green-600 hover:bg-green-500 py-2 rounded-lg text-white font-medium",children:b({en:"Accept",vi:"ƒê·ªìng √Ω"})}),n.jsx("button",{onClick:()=>g.onSocketGameAction({action:{type:"NEW_GAME_RESPONSE",accepted:!1}}),className:"flex-1 bg-red-600 hover:bg-red-500 py-2 rounded-lg text-white font-medium",children:b({en:"Decline",vi:"T·ª´ ch·ªëi"})})]})]})}),v.pendingNewGameRequest&&v.pendingNewGameRequest===p&&n.jsx("div",{className:"text-sm text-yellow-400 animate-pulse flex items-center justify-center",children:b({en:"Requesting New Game...",vi:"ƒêang y√™u c·∫ßu v√°n m·ªõi..."})}),n.jsx("div",{className:"w-full max-w-xl",children:n.jsx("div",{ref:N,className:"w-full aspect-square rounded-lg overflow-hidden",style:{maxHeight:"min(80vh, 600px)"}})}),n.jsxs("div",{className:"w-full flex justify-between gap-4 text-sm",children:[n.jsxs("div",{className:"rounded-lg p-2 flex-1 bg-slate-400",children:[n.jsxs("div",{className:"text-xs text-slate-100 mb-1",children:[b({en:"White captured:",vi:"Tr·∫Øng b·∫Øt:"})," "]}),n.jsx("div",{className:"flex flex-wrap gap-1",children:v.capturedPieces.white.map((e,s)=>n.jsx("img",{src:`https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/cburnett/b${e.toUpperCase()}.svg`,alt:e,className:"w-5 h-5 object-contain"},s))})]}),n.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[n.jsx("div",{className:"text-xs text-slate-400 mb-1",children:b({en:"Black captured:",vi:"ƒêen b·∫Øt:"})}),n.jsx("div",{className:"flex flex-wrap gap-1",children:v.capturedPieces.black.map((e,s)=>n.jsx("img",{src:`https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/cburnett/w${e.toUpperCase()}.svg`,alt:e,className:"w-5 h-5 object-contain"},s))})]})]}),n.jsx("button",{onClick:()=>j(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-500 transition-colors z-40 shadow-lg border border-slate-500",title:w({en:"Rules",vi:"Lu·∫≠t ch∆°i"}),children:n.jsx(c,{size:24})}),f&&a.createPortal(n.jsx("div",{className:"fixed inset-0 bg-black/80 glass-blur z-100 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full shadow-2xl relative",children:[n.jsxs("div",{className:"flex justify-between p-4 pr-2",children:[n.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[n.jsx(c,{className:"w-6 h-6 text-yellow-500"}),b({en:"Game Rules: Chess",vi:"Lu·∫≠t Ch∆°i: C·ªù Vua"})]}),n.jsx("button",{onClick:()=>j(!1),className:"p-2 hover:bg-white/10 rounded-full transition-colors text-slate-400 hover:text-white",children:n.jsx(o,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"p-4 pt-0 space-y-4 text-slate-300 leading-relaxed max-h-[80vh] overflow-y-auto",children:n.jsxs("div",{className:"space-y-4 text-slate-300 leading-relaxed",children:[n.jsxs("section",{children:[n.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:b({en:"Objective",vi:"M·ª•c ti√™u"})}),n.jsx("p",{children:b({en:"Checkmate the opponent's king. White moves first.",vi:"Chi·∫øu b√≠ vua c·ªßa ƒë·ªëi ph∆∞∆°ng. Tr·∫Øng ƒëi tr∆∞·ªõc."})})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:b({en:"Basic Rules",vi:"Quy T·∫Øc C∆° B·∫£n"})}),n.jsxs("ul",{className:"list-disc pl-4",children:[n.jsxs("li",{children:[n.jsx("strong",{children:b({en:"King",vi:"Vua"})}),":"," ",b({en:"Moves one square in any direction.",vi:"Di chuy·ªÉn 1 √¥ theo m·ªçi h∆∞·ªõng."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:b({en:"Queen",vi:"H·∫≠u"})}),":"," ",b({en:"Moves diagonally, horizontally, or vertically any number of squares.",vi:"Di chuy·ªÉn ngang, d·ªçc, ch√©o bao nhi√™u √¥ t√πy √Ω."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:b({en:"Rook",vi:"Xe"})}),":"," ",b({en:"Moves horizontally or vertically any number of squares.",vi:"Di chuy·ªÉn ngang ho·∫∑c d·ªçc bao nhi√™u √¥ t√πy √Ω."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:b({en:"Bishop",vi:"T∆∞·ª£ng"})}),":"," ",b({en:"Moves diagonally any number of squares.",vi:"Di chuy·ªÉn ch√©o bao nhi√™u √¥ t√πy √Ω."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:b({en:"Knight",vi:"M√£"})}),":"," ",b({en:"Moves in an 'L' shape: two squares in one direction and then one square perpendicular to that direction.",vi:"Di chuy·ªÉn theo h√¨nh ch·ªØ L."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:b({en:"Pawn",vi:"T·ªët"})}),":"," ",b({en:"Moves forward one square (or two on the first move). Captures diagonally.",vi:"Di chuy·ªÉn th·∫≥ng 1 √¥ (ho·∫∑c 2 ·ªü n∆∞·ªõc ƒë·∫ßu). ƒÇn ch√©o."})]})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:b({en:"Special Moves",vi:"N∆∞·ªõc ƒêi ƒê·∫∑c Bi·ªát"})}),n.jsxs("ul",{className:"list-disc pl-4",children:[n.jsx("li",{children:b({en:"Castling: Move the King two squares towards a Rook.",vi:"Nh·∫≠p th√†nh: Di chuy·ªÉn Vua 2 √¥ v·ªÅ ph√≠a Xe."})}),n.jsx("li",{children:b({en:"En Passant: Special pawn capture.",vi:"B·∫Øt t·ªët qua ƒë∆∞·ªùng."})}),n.jsx("li",{children:b({en:"Promotion: Pawn reaching the other side becomes a Queen, Rook, Bishop, or Knight.",vi:"Phong c·∫•p: T·ªët ƒëi ƒë·∫øn cu·ªëi b√†n c·ªù ƒë∆∞·ª£c phong l√†m H·∫≠u, Xe, T∆∞·ª£ng ho·∫∑c M√£."})})]})]})]})})]})}),document.body)]})}export{u as default};
