import{u as e,j as s,b as t}from"./index-Dgl20RHv.js";import{l,i as a,af as n,a5 as r,X as i,A as d,a4 as c,ae as o,a3 as m,Y as x,J as u}from"./react-vendor-DqvDgvkG.js";import"./socket-DRbsQkF5.js";import{C as h,b as p,a as f,T as g}from"./types-k4MwRBn0.js";import"./zustand-DHxpPrWm.js";function b({game:m}){const x=m,[u,g]=l.useState(x.getState()),[b,y]=l.useState(null),[v,P]=l.useState(!1),[R,k]=l.useState(!1),{username:C}=e(),[D,S]=l.useState(null),[I,$]=l.useState(!1),[z,G]=l.useState(0),T=l.useRef([null,null,null,null]),q=l.useRef([null,null,null,null]),B=l.useRef(null),U=l.useRef(null),E=l.useRef(null),H=l.useRef(null),A=l.useRef(null),J=l.useRef(null),W=x.isHostUser,L=x.getMyPlayerIndex(),O=L>=0?u.players[L]:null,M=u.currentTurnIndex===L,Y=x.canStartGame(),_=l.useRef(u.discardPile.length),F=l.useRef(u.players.map(e=>e.hand.length));l.useEffect(()=>{x.onUpdate(e=>{if(e.discardPile.length>_.current&&"playing"===e.gamePhase){const s=e.discardPile[e.discardPile.length-1],t=(e.currentTurnIndex-e.turnDirection+4)%4;$(!0),S({card:s,fromPlayerIndex:t,direction:"toDiscard"}),setTimeout(()=>{$(!1),S(null)},350)}e.players.forEach((s,t)=>{const l=F.current[t]||0,a=s.hand.length;if(a>l&&"playing"===e.gamePhase){const e=t===L,n=a-l,r=e?s.hand[s.hand.length-1]:void 0;e&&G(n),S({card:r,fromPlayerIndex:t,direction:"toHand",hidden:!e}),setTimeout(()=>{e&&G(0),S(null)},350)}}),_.current=e.discardPile.length,F.current=e.players.map(e=>e.hand.length),g(e),y(null)})},[x,L]);const X=()=>{x.requestDrawCard()},K=l.useMemo(()=>{const e=[],s=L>=0?L:0;for(let t=0;t<4;t++){const l=(s+t)%4;e.push({slot:u.players[l],actualIndex:l})}return e},[u.players,L]),Q=u.discardPile[u.discardPile.length-1],V=(e,t=!1,l)=>{const a=K[e],n=L>=0;return s.jsx("div",{ref:s=>{l&&(l.current[e]=s)},children:s.jsx(w,{slot:a.slot,index:a.actualIndex,isCurrentTurn:u.currentTurnIndex===a.actualIndex,isHost:W,gamePhase:u.gamePhase,onAddBot:()=>x.requestAddBot(a.actualIndex),onJoinSlot:()=>x.requestJoinSlot(a.actualIndex,C),onRemove:()=>x.requestRemovePlayer(a.actualIndex),compact:t,isInGame:n})},a.actualIndex)},Z=(e,t,l)=>{const n=e?"medium":"large",r=e?"w-14 h-20":"w-20 h-28",i=e?"w-5 h-5":"w-8 h-8",d=e?"flex sm:hidden flex-1 flex-col items-center justify-center gap-2 bg-slate-800/30 rounded-xl p-2 min-h-[120px]":"hidden sm:flex flex-1 flex-col items-center justify-center gap-4 min-h-[200px] bg-slate-800/30 rounded-2xl p-4";return s.jsxs("div",{className:d,children:["waiting"===u.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center "+(e?"gap-2":"gap-4"),children:[s.jsx("span",{className:e?"text-slate-400 text-sm":"text-slate-400",children:"Waiting for players..."}),W&&Y&&s.jsxs("button",{onClick:()=>x.requestStartGame(),className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2 "+(e?"text-sm px-4 py-2":""),children:[s.jsx(c,{className:e?"w-4 h-4":"w-5 h-5"}),e?"Start":"Start Game"]}),W&&!Y&&s.jsx("span",{className:"text-sm text-slate-500",children:"Need at least 2 players to start"})]}),"playing"===u.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center "+(e?"gap-2":"gap-4"),children:[s.jsxs("div",{className:"flex items-center "+(e?"gap-4":"gap-6"),children:[s.jsxs("button",{ref:l,onClick:X,disabled:!M,className:`relative ${r} bg-gradient-to-br from-slate-700 to-slate-900 rounded-xl border-2 border-slate-600 flex items-center justify-center hover:border-slate-400 transition-all disabled:opacity-50`,children:[s.jsx(a,{className:`${i} text-slate-400`}),s.jsx("span",{className:"absolute bottom-1 text-xs text-slate-400",children:u.drawPile.length})]}),s.jsx("div",{ref:t,className:`relative ${r}`,children:s.jsxs("button",{onClick:()=>k(!0),className:"absolute inset-0 cursor-pointer hover:scale-105 transition-transform",title:"Click to view history",children:[u.discardPile.slice(-4).map((t,l,a)=>{const r=l===a.length-1;if(r&&I)return null;const i=(a.length-1-l)*(e?2:3),d=(l-Math.floor(a.length/2))*(e?4:5);return s.jsx("div",{className:"absolute inset-0",style:{transform:`translateX(${i}px) translateY(${-i}px) rotate(${d}deg)`,zIndex:l,opacity:r?1:.7},children:s.jsx(j,{card:t,size:n})},t.id)}),Q&&s.jsx("div",{className:`absolute -bottom-2 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full border-2 border-white z-10 ${p[u.currentColor]}`}),s.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-slate-600 rounded-full text-[10px] flex items-center justify-center z-20",children:u.discardPile.length})]})})]}),u.pendingDraw>0&&s.jsxs("div",{className:"text-lg font-bold text-red-400 animate-pulse",children:["+",u.pendingDraw," cards pending!"]}),s.jsx("div",{className:"text-sm "+(e?"hidden":"block"),children:M?s.jsxs("span",{className:"text-primary-400 font-medium",children:["Your Turn",u.hasDrawn&&" - Play drawn card or pass"]}):s.jsxs("span",{className:"text-slate-400",children:[u.players[u.currentTurnIndex]?.username,"'s Turn"]})}),s.jsxs("div",{className:"text-xs text-slate-500 "+(e?"hidden":"block"),children:["Direction:"," ",1===u.turnDirection?"→ Clockwise":"← Counter-clockwise"]})]}),"ended"===u.gamePhase&&s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx(o,{className:(e?"w-8 h-8":"w-12 h-12")+" text-yellow-400"}),s.jsxs("span",{className:(e?"text-lg":"text-xl")+" font-bold text-yellow-400",children:[u.players.find(e=>e.id===u.winner)?.username," Won!"]})]})]})};return s.jsxs("div",{ref:A,className:"relative flex flex-col h-full p-2 sm:p-4 gap-2 sm:gap-4 overflow-hidden",children:[s.jsxs("div",{className:"flex sm:hidden justify-center gap-2",children:[V(1,!0,q),V(2,!0,q),V(3,!0,q)]}),s.jsx("div",{className:"hidden sm:flex justify-center",children:V(2,!1,T)}),s.jsxs("div",{className:"hidden sm:flex flex-1 items-center justify-between gap-4",children:[V(1,!1,T),Z(!1,B,E),V(3,!1,T)]}),Z(!0,U,H),s.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-4",children:[s.jsx("div",{className:"hidden sm:block",children:V(0,!1,T)}),s.jsx("div",{className:"flex sm:hidden",children:V(0,!0,q)}),O&&"playing"===u.gamePhase&&s.jsx("div",{className:"w-full overflow-x-auto overflow-y-visible pt-4 pb-1",children:s.jsx("div",{ref:J,className:"flex w-fit mx-auto px-4",children:O.hand.map((e,t)=>{const l=M&&x.canPlayCardCheck(e);return t>=O.hand.length-z?null:s.jsx("button",{onClick:()=>(e=>{M&&"playing"===u.gamePhase&&(u.pendingDraw>0||x.canPlayCardCheck(e)&&(e.type===f.WILD||e.type===f.WILD_DRAW_FOUR?(y(e),P(!0)):x.requestPlayCard(e)))})(e),disabled:!M||!l,className:`transition-transform duration-150 ${t>0?"-ml-6 md:-ml-8":""} ${l?"-translate-y-2 hover:-translate-y-3 cursor-pointer":"cursor-not-allowed"}`,style:{zIndex:t},children:s.jsx(j,{card:e,size:"medium"})},e.id)})})}),"playing"===u.gamePhase&&M&&s.jsxs("div",{className:"flex gap-2",children:[u.pendingDraw>0&&s.jsxs("button",{onClick:X,className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-red-600 hover:bg-red-500 rounded-lg font-medium flex items-center gap-1 sm:gap-2 text-sm",children:[s.jsx(a,{className:"w-4 h-4"}),"Draw ",u.pendingDraw]}),u.hasDrawn&&s.jsx("button",{onClick:X,className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-1 sm:gap-2 text-sm",children:"Pass"}),O&&O.hand.length<=2&&!O.calledUno&&s.jsxs("button",{onClick:()=>{x.requestCallUno()},className:"px-4 py-1.5 sm:px-6 sm:py-2 bg-yellow-600 hover:bg-yellow-500 rounded-lg font-bold flex items-center gap-1 sm:gap-2 text-sm animate-pulse",children:[s.jsx(n,{className:"w-4 h-4"}),"UNO!"]})]}),"waiting"!==u.gamePhase&&s.jsx("div",{className:"flex gap-2",children:s.jsxs("button",{onClick:async()=>{if(W&&"playing"===u.gamePhase){await t.getState().confirm("This will reset the current game and start fresh.","Start New Game?")&&x.requestNewGame()}else x.requestNewGame()},className:"px-3 py-1.5 sm:px-4 sm:py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs sm:text-sm flex items-center gap-1 sm:gap-2",children:[s.jsx(r,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"New game"]})})]}),v&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 sm:p-6 shadow-xl",children:[s.jsx("h3",{className:"text-base sm:text-lg font-bold mb-4 text-center",children:"Choose Color"}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:[h.RED,h.BLUE,h.GREEN,h.YELLOW].map(e=>s.jsx("button",{onClick:()=>(e=>{b&&(x.requestPlayCard(b,e),P(!1),y(null))})(e),className:`w-16 h-16 sm:w-20 sm:h-20 rounded-xl ${p[e]} hover:scale-110 transition-transform border-4 border-white/30`},e))}),s.jsx("button",{onClick:()=>{P(!1),y(null)},className:"mt-4 w-full py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm",children:"Cancel"})]})}),W&&u.newGameRequest&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 sm:p-6 max-w-sm w-full shadow-xl",children:[s.jsx("h3",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"New Game Request"}),s.jsxs("p",{className:"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base",children:[s.jsx("span",{className:"font-medium text-white",children:u.newGameRequest.fromName})," ","wants to start a new game."]}),s.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[s.jsxs("button",{onClick:()=>x.declineNewGame(),className:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[s.jsx(i,{className:"w-4 h-4"}),"Decline"]}),s.jsxs("button",{onClick:()=>x.acceptNewGame(),className:"flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[s.jsx(d,{className:"w-4 h-4"}),"Accept"]})]})]})}),R&&s.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>k(!1),children:s.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 sm:p-6 max-w-md w-full max-h-[80vh] shadow-xl",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("h3",{className:"text-base sm:text-lg font-bold",children:["Discard Pile (",u.discardPile.length," cards)"]}),s.jsx("button",{onClick:()=>k(!1),className:"p-1 hover:bg-slate-700 rounded",children:s.jsx(i,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"overflow-y-auto max-h-[60vh] grid grid-cols-4 sm:grid-cols-5 gap-2",children:[...u.discardPile].reverse().map((e,t)=>s.jsx("div",{className:"relative",children:s.jsx(j,{card:e,size:"small"})},`${e.id}-${t}`))})]})}),D&&s.jsx(N,{card:D.card,hidden:D.hidden,fromPlayerIndex:D.fromPlayerIndex,myIndex:L,desktopSlotRefs:T,mobileSlotRefs:q,myHandRef:J,desktopDiscardPileRef:B,mobileDiscardPileRef:U,desktopDrawPileRef:E,mobileDrawPileRef:H,containerRef:A,direction:D.direction})]})}function j({card:e,size:t="medium",hidden:l=!1}){const a={small:"w-10 h-14",medium:"w-14 h-20 md:w-16 md:h-24",large:"w-20 h-28"};if(l||!e)return s.jsx("div",{className:`\n        ${a[t]}\n        bg-slate-900\n        rounded-lg md:rounded-xl shadow-lg\n        border-2 border-slate-700\n        shrink-0\n        relative\n        overflow-hidden\n      `,children:s.jsx("div",{className:"absolute inset-1 rounded border-2 border-slate-600 flex items-center justify-center bg-gradient-to-br from-slate-800 to-black",children:s.jsx("span",{className:"text-slate-700/50 font-bold transform -rotate-45 select-none text-sm md:text-base",children:"UNO"})})});return s.jsx("div",{className:`\n        ${a[t]}\n        ${p[e.color]}\n        rounded-lg md:rounded-xl shadow-lg\n        border-2 border-white/30\n        font-bold text-white\n        ${{small:"text-lg",medium:"text-xl md:text-2xl",large:"text-3xl"}[t]}\n        shrink-0\n        relative\n      `,style:{textShadow:"1px 1px 2px rgba(0,0,0,0.5)"},children:s.jsx("span",{className:"absolute top-0.5 left-1.5",children:e.type===f.NUMBER?e.value?.toString()||"0":g[e.type]})})}function N({card:e,hidden:t=!1,fromPlayerIndex:a,myIndex:n,myHandRef:r,desktopSlotRefs:i,mobileSlotRefs:d,desktopDiscardPileRef:c,mobileDiscardPileRef:o,desktopDrawPileRef:m,mobileDrawPileRef:x,containerRef:u,direction:h="toDiscard"}){const[p,f]=l.useState(null),[g,b]=l.useState(!1);if(l.useEffect(()=>{const e=(a-(n>=0?n:0)+4)%4;let s;const t=e=>e&&null!==e.offsetParent;s=0===e&&t(r.current)?r.current:t(i.current?.[e])?i.current?.[e]:t(d.current?.[e])?d.current?.[e]:r.current||i.current?.[e]||d.current?.[e];const l=t(c.current)?c.current:o.current||c.current||o.current,p=t(m?.current)?m?.current:x?.current||m?.current||x?.current,g=u.current;if(!s||!l||!g)return;let j,N;if("toDiscard"===h)j=s,N=l;else{if(!p)return;j=p,N=s}const w=g.getBoundingClientRect(),y=j.getBoundingClientRect(),v=N.getBoundingClientRect(),P={x:y.left+y.width/2-w.left-40,y:y.top+y.height/2-w.top-56},R={x:v.left+v.width/2-w.left-40,y:v.top+v.height/2-w.top-56};f({startPos:P,endPos:R});const k=setTimeout(()=>{b(!0)},10);return()=>clearTimeout(k)},[a,n,i,d,r,c,o,m,x,u,h]),!p)return null;const{startPos:N,endPos:w}=p,y=g?w:N;return s.jsx("div",{className:"absolute pointer-events-none z-50",style:{left:y.x,top:y.y,transition:g?"all 300ms ease-out":"none",transform:g?"scale(1.1) rotate(5deg)":"scale(0.8)",opacity:g?1:.8},children:s.jsx(j,{card:e,size:"large",hidden:t})})}function w({slot:e,index:t,isCurrentTurn:l,isHost:a,gamePhase:n,onAddBot:r,onJoinSlot:d,onRemove:c,compact:o=!1,isInGame:h}){const p=null===e.id,f=a&&"waiting"===n,g=!a&&"waiting"===n&&!h;return s.jsx("div",{className:`\n        ${o?"p-2 min-w-[90px]":"p-2 sm:p-3 min-w-[100px] sm:min-w-[120px]"}\n        rounded-lg sm:rounded-xl transition-all border-2\n        ${l&&"playing"===n?"border-primary-600 bg-primary-500/10 animate-bounce":"border-slate-700 bg-slate-800/50"}\n        ${p?"border-dashed":""}\n      `,children:p?s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("span",{className:"text-slate-500 text-xs text-center",children:["Slot ",t+1]}),s.jsxs("div",{className:"flex gap-1",children:[f&&s.jsx("button",{onClick:r,className:"flex-1 p-1 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center",title:"Add Bot",children:s.jsx(m,{className:"w-5 h-5"})}),g&&s.jsxs("button",{onClick:d,className:"flex-1 p-1.5 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center gap-1",title:"Join this slot",children:[s.jsx(x,{className:"w-4 h-4"}),"Join"]})]})]}):s.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[e.isBot&&s.jsx(m,{className:"w-5 h-5 text-blue-400"}),e.isHost&&s.jsx(u,{className:"w-5 h-5 text-yellow-400"}),s.jsx("span",{className:"text-xs font-medium",children:e.username}),f&&e.id&&!e.isHost&&s.jsx("button",{onClick:c,className:"p-0.5 hover:bg-slate-700 rounded",title:"Remove",children:s.jsx(i,{className:"w-5 h-5 text-red-400"})})]}),("playing"===n||"ended"===n)&&s.jsxs("span",{className:"text-[10px] text-slate-400",children:[e.hand.length," cards"]}),e.calledUno&&e.hand.length<=1&&s.jsx("span",{className:"text-[10px] text-yellow-400 font-bold",children:"UNO!"})]})})}export{b as default};
