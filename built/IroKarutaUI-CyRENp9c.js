import{b as e,u as t,j as s}from"./index-BuwAuyRH.js";import{b as a,y as r,bn as l,aD as n,Z as i,az as d,bo as o,X as c}from"./react-vendor-BPKxesl1.js";import{u as x}from"./useGameState-6Sg9cn7I.js";import"./BaseGame-Bn3OX2xB.js";import{b as m,c as p,r as u,f as h,a as g}from"./helper-CQgxB6Hs.js";import"./socket-DRbsQkF5.js";import"./zustand-BVhu8Aq7.js";const f=a.memo(function({startTime:e}){const[t,r]=a.useState(0);return a.useEffect(()=>{if(!e)return;const t=setInterval(()=>r(Date.now()-e),100);return()=>clearInterval(t)},[e]),s.jsxs("span",{className:"text-xs font-mono text-text-muted flex items-center gap-1",children:[s.jsx(d,{className:"w-3 h-3"}),h(t)]})});function b({game:b,currentUserId:j}){const v=b,{confirm:N}=e(),[y]=x(v),{ts:w}=t(),k=j||"",C=v.isHost,M=y.playerData[k],A=M?.cardsInZone?.map(e=>y.availableCards.find(t=>t.id===e))?.filter(Boolean)||[],T=a.useMemo(()=>0===A.length?[255,255,255]:m(A),[A]),R=a.useMemo(()=>0===A.length?0:p(T,y.targetColor),[T,y.targetColor]),I=a.useCallback(e=>{v.makeAction({type:"DROP_CARD",playerId:k,cardId:e})},[v,k]),D=a.useCallback(e=>{v.makeAction({type:"REMOVE_CARD",playerId:k,cardId:e})},[v,k]),$=a.useCallback(()=>v.makeAction({type:"START_GAME"}),[v]),S=a.useCallback(()=>v.makeAction({type:"NEXT_ROUND"}),[v]),G=a.useCallback(async()=>{await N(w({en:"Current progress will be lost",vi:"Tiáº¿n trÃ¬nh hiá»‡n táº¡i sáº½ máº¥t"}),w({en:"New Game?",vi:"Game má»›i?"}))&&v.makeAction({type:"RESET_GAME"})},[v]);if("waiting"===y.phase)return s.jsxs("div",{className:"flex flex-col items-center justify-center gap-6 py-12 px-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold bg-linear-to-r from-cyan-400 via-pink-400 to-yellow-400 bg-clip-text text-transparent mb-2",children:"ðŸŽ¨ Iro Karuta"}),s.jsx("p",{className:"text-text-muted text-sm max-w-xs mx-auto",children:w({en:"Mix CMYK ink cards to match the target color!",vi:"Trá»™n cÃ¡c tháº» má»±c CMYK Ä‘á»ƒ táº¡o ra mÃ u má»¥c tiÃªu!"})})]}),s.jsx("div",{className:"flex gap-2",children:[[0,255,255],[255,0,255],[255,255,0]].map((e,t)=>s.jsx("div",{className:"w-12 h-16 rounded-lg animate-pulse",style:{backgroundColor:u(e,.8),animationDelay:200*t+"ms"}},t))}),s.jsxs("div",{className:"text-sm text-text-muted",children:[v.players.length," ",w({en:"player(s) in room",vi:"ngÆ°á»i chÆ¡i trong phÃ²ng"})]}),s.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:v.players.map(e=>s.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs",style:{background:"var(--glass-bg, rgba(255,255,255,0.05))",border:"1px solid var(--glass-border, rgba(255,255,255,0.1))"},children:[s.jsx("span",{className:"text-text-primary",children:e.username||e.id.slice(0,6)}),e.id===k&&s.jsx("span",{className:"text-[9px] text-text-muted",children:w({en:"(you)",vi:"(báº¡n)"})})]},e.id))}),C?s.jsxs("button",{onClick:$,className:"px-6 py-3 rounded-xl bg-linear-to-r from-purple-500 to-pink-500 text-white font-semibold flex items-center gap-2 hover:scale-105 transition-transform",children:[s.jsx(r,{className:"w-5 h-5"}),w({en:"Start Game",vi:"Báº¯t Ä‘áº§u"})]}):s.jsxs("div",{className:"px-6 py-3 rounded-xl text-text-muted font-semibold flex items-center gap-2",children:[s.jsx(l,{className:"w-5 h-5 animate-spin"}),w({en:"Waiting for host...",vi:"Äang chá» chá»§ phÃ²ng..."})]})]});if("summary"===y.phase&&y.round>=y.maxRounds){const e=Object.entries(y.playerData).sort(([,e],[,t])=>t.score-e.score);return s.jsxs("div",{className:"flex flex-col items-center gap-4 py-8 px-4 max-w-lg mx-auto",children:[s.jsx(n,{className:"w-10 h-10 text-yellow-400"}),s.jsx("h2",{className:"text-xl font-bold text-text-primary",children:w({en:"Game Over!",vi:"Káº¿t thÃºc!"})}),s.jsx("div",{className:"w-full space-y-3",children:e.map(([e,t],a)=>{const r=v.players.find(t=>t.id===e);return s.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl backdrop-blur-sm border",style:{background:0===a?"linear-gradient(135deg, rgba(255,204,0,0.15), rgba(255,149,0,0.1))":"var(--glass-bg, rgba(255,255,255,0.05))",borderColor:0===a?"rgba(255,204,0,0.3)":"var(--glass-border, rgba(255,255,255,0.1))"},children:[s.jsx("span",{className:"text-lg font-bold w-8 text-center",children:0===a?"ðŸ¥‡":1===a?"ðŸ¥ˆ":2===a?"ðŸ¥‰":`#${a+1}`}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-text-primary truncate",children:r?.username||e.slice(0,6)}),s.jsx("div",{className:"text-xs text-text-muted",children:t.finishedAt&&y.roundStartTime?h(t.finishedAt-y.roundStartTime):w({en:"DNF",vi:"ChÆ°a xong"})})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"font-bold text-lg text-purple-400",children:t.score}),s.jsx("div",{className:"text-xs text-text-muted",children:"pts"})]})]},e)})}),C&&s.jsxs("button",{onClick:G,className:"mt-4 px-5 py-2.5 rounded-xl bg-linear-to-r from-purple-500 to-pink-500 text-white font-semibold flex items-center gap-2 hover:scale-105 transition-transform",children:[s.jsx(i,{className:"w-4 h-4"}),w({en:"Play Again",vi:"ChÆ¡i láº¡i"})]})]})}if("summary"===y.phase){const e=Object.entries(y.playerData).sort(([,e],[,t])=>t.score-e.score);return s.jsxs("div",{className:"flex flex-col items-center gap-4 py-6 px-4 max-w-lg mx-auto border border-white/10 rounded-xl",children:[s.jsx("h3",{className:"text-lg font-bold text-text-primary",children:w({en:`Round ${y.round} Result`,vi:`Káº¿t quáº£ vÃ²ng ${y.round}`})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-sm text-text-muted",children:w({en:"Target:",vi:"Má»¥c tiÃªu:"})}),s.jsx("div",{className:"w-10 h-10 rounded-lg border border-white/10",style:{backgroundColor:g(y.targetColor)}})]}),s.jsx("div",{className:"w-full space-y-2",children:e.map(([e,t])=>{const a=v.players.find(t=>t.id===e),r=t.cardsInZone.map(e=>y.availableCards.find(t=>t.id===e)).filter(Boolean),l=r.length>0?p(m(r),y.targetColor):0;return s.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl backdrop-blur-sm",style:{background:"var(--glass-bg, rgba(255,255,255,0.05))",border:"1px solid var(--glass-border, rgba(255,255,255,0.1))"},children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-text-primary truncate text-sm",children:a?.username||e.slice(0,6)}),s.jsx("div",{className:"flex gap-1 mt-1",children:r.map((e,t)=>s.jsx("div",{className:"w-5 h-5 rounded-sm border border-white/20",style:{backgroundColor:u(e.color,e.opacity)},title:`${e.label} (${Math.round(100*e.opacity)}%)`},t))})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"text-sm font-semibold text-purple-400",children:[l,"%"]}),t.finishedAt&&y.roundStartTime&&s.jsxs("div",{className:"text-xs text-text-muted flex items-center gap-1",children:[s.jsx(d,{className:"w-3 h-3"}),h(t.finishedAt-y.roundStartTime)]})]})]},e)})}),C&&s.jsx("button",{onClick:y.round>=y.maxRounds?G:S,className:"mt-2 px-5 py-2.5 rounded-xl bg-linear-to-r from-cyan-500 to-blue-500 text-white font-semibold flex items-center gap-2 hover:scale-105 transition-transform",children:y.round>=y.maxRounds?s.jsxs(s.Fragment,{children:[s.jsx(n,{className:"w-4 h-4"}),w({en:"Final Results",vi:"Káº¿t quáº£ cuá»‘i"})]}):s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"w-4 h-4"}),w({en:"Next Round",vi:"VÃ²ng tiáº¿p"})]})})]})}const O=null!==M?.finishedAt;return s.jsxs("div",{className:"flex flex-col gap-3 p-3 sm:p-4 max-w-xl mx-auto select-none",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-text-muted",children:w({en:`Round ${y.round}/${y.maxRounds}`,vi:`VÃ²ng ${y.round}/${y.maxRounds}`})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{startTime:y.roundStartTime||0}),C&&s.jsx("button",{onClick:G,className:"p-1.5 rounded-lg text-text-muted hover:text-red-400 hover:bg-red-500/10 transition-colors",title:w({en:"New Game",vi:"VÃ¡n má»›i"}),children:s.jsx(i,{className:"w-3.5 h-3.5"})})]})]}),s.jsxs("div",{className:"flex items-center justify-center gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted mb-1",children:w({en:"Target",vi:"Má»¥c tiÃªu"})}),s.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-2xl border-2 border-white/20",style:{backgroundColor:g(y.targetColor)}})]}),s.jsx("div",{className:"text-2xl text-text-muted",children:"â†’"}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted mb-1",children:w({en:"Your Mix",vi:"MÃ u cá»§a báº¡n"})}),s.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-2xl border-2 transition-colors",style:{backgroundColor:g(T),borderColor:R>=100?"rgba(52,199,89,0.8)":"rgba(255,255,255,0.2)"}})]})]}),s.jsxs("div",{className:"w-full",children:[s.jsxs("div",{className:"flex justify-between mb-1",children:[s.jsx("span",{className:"text-xs text-text-muted",children:w({en:"Similarity",vi:"Äá»™ giá»‘ng"})}),s.jsxs("span",{className:"text-xs font-bold",style:{color:R>=100?"#34c759":R>=80?"#ff9500":R>=50?"#ffcc00":"#ff453a"},children:[R,"%"]})]}),s.jsx("div",{className:"h-2 rounded-full bg-white/10 overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full transition-all duration-300",style:{width:`${R}%`,background:R>=100?"linear-gradient(90deg, #34c759, #30d158)":R>=80?"linear-gradient(90deg, #ff9500, #ffb340)":R>=50?"linear-gradient(90deg, #ffcc00, #ffd426)":"linear-gradient(90deg, #ff453a, #ff6961)"}})})]}),O&&s.jsxs("div",{className:"text-center py-2 px-4 rounded-xl bg-green-500/15 border border-green-500/30 text-green-400 text-sm font-semibold animate-bounce",children:["ðŸŽ‰ ",w({en:"Perfect Match!",vi:"TrÃ¹ng khá»›p!"})]}),s.jsx("div",{className:"relative mx-auto w-full rounded-2xl border-2 border-dashed overflow-hidden",style:{minHeight:"150px",background:"#ffffff",borderColor:R>=100?"rgba(52,199,89,0.6)":"rgba(0,0,0,0.15)"},children:0===A.length?s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("span",{className:"text-gray-400 text-xs text-center pointer-events-none px-4",children:w({en:"Tap cards below to add",vi:"Nháº¥n cÃ¡c lÃ¡ bÃ i bÃªn dÆ°á»›i Ä‘á»ƒ thÃªm"})})}):s.jsx("div",{className:"relative w-full flex items-center justify-center",style:{minHeight:"140px"},children:[...A].sort((e,t)=>{const s=255===e.color[0]&&255===e.color[1]&&255===e.color[2];return s===(255===t.color[0]&&255===t.color[1]&&255===t.color[2])?0:s?1:-1}).map((e,t)=>{const a=A.length,r=(t-(a-1)/2)*Math.min(20,100/a),l=4*(t-(a-1)/2),n=255===e.color[0]&&255===e.color[1]&&255===e.color[2];return s.jsxs("div",{className:"absolute rounded-xl group",style:{width:80,height:110,left:`calc(50% - 40px + ${r}px)`,top:"calc(50% - 55px)",transform:`rotate(${l}deg)`,zIndex:t+1,backgroundColor:u(e.color,e.opacity),mixBlendMode:n?"normal":"multiply",cursor:O?"default":"pointer"},onClick:()=>!O&&D(e.id),children:[s.jsxs("div",{className:"absolute inset-0 rounded-xl border border-black/5 flex flex-col items-center justify-end pb-1.5 pointer-events-none gap-0.5",style:{mixBlendMode:"normal"},children:[s.jsx("span",{className:"text-[9px] font-bold px-1.5 py-0.5 rounded bg-white/70 text-gray-600",children:e.label}),s.jsxs("span",{className:"text-[8px] font-mono px-1 rounded bg-black/10 text-gray-500",children:[Math.round(100*e.opacity),"%"]})]}),!O&&s.jsx("button",{onClick:t=>{t.stopPropagation(),D(e.id)},className:"absolute -top-2 -right-2 w-5 h-5 rounded-full bg-red-500 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",style:{mixBlendMode:"normal"},children:s.jsx(c,{className:"w-3 h-3"})})]},e.id)})})}),s.jsxs("div",{className:"mt-1",children:[s.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted mb-2 text-center",children:w({en:"Find 2-3 cards â€” tap to add/remove",vi:"TÃ¬m 2-3 lÃ¡ bÃ i â€” nháº¥n Ä‘á»ƒ thÃªm/bá»"})}),s.jsx("div",{className:"flex flex-wrap justify-center gap-1 bg-white rounded-xl p-2",children:y.availableCards.map(e=>{const t=M?.cardsInZone?.includes(e.id)??!1;return s.jsxs("div",{onClick:()=>t?D(e.id):I(e.id),className:"relative w-14 h-[76px] sm:w-16 sm:h-[88px] rounded-xl cursor-pointer transition-transform hover:scale-110 active:scale-95",style:{backgroundColor:u(e.color,t?.4*e.opacity:e.opacity),opacity:t?.5:1,outline:t?"2px solid rgba(175,82,222,0.6)":"1px solid #0003",outlineOffset:"-2px"},children:[s.jsx("div",{className:"absolute inset-0 rounded-xl border-2 border-white/25"}),s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-end pb-1 gap-0.5",children:[s.jsxs("span",{className:"text-[9px] font-bold bg-white/70 text-gray-600 px-1 rounded",children:[e.label," ",y.answerCardIds.findIndex(t=>t===e.id)+1||""]}),s.jsxs("span",{className:"text-[7px] font-mono px-1 rounded bg-black/20 text-white/80",children:[Math.round(100*e.opacity),"%"]})]}),t&&s.jsx("div",{className:"absolute top-1 right-1 w-4 h-4 rounded-full bg-purple-500 text-white flex items-center justify-center text-[8px] font-bold",children:"âœ“"})]},e.id)})})]}),Object.keys(y.playerData).length>1&&s.jsxs("div",{className:"mt-2 space-y-1",children:[s.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted text-center",children:w({en:"Players",vi:"NgÆ°á»i chÆ¡i"})}),s.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:Object.entries(y.playerData).map(([e,t])=>{const a=v.players.find(t=>t.id===e),r=t.cardsInZone.map(e=>y.availableCards.find(t=>t.id===e)).filter(Boolean),l=r.length>0?m(r):[255,255,255];return s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs",style:{background:t.finishedAt?"rgba(52,199,89,0.1)":"var(--glass-bg, rgba(255,255,255,0.05))",border:"1px solid "+(t.finishedAt?"rgba(52,199,89,0.3)":"var(--glass-border, rgba(255,255,255,0.1))")},children:[s.jsx("div",{className:"w-5 h-5 rounded-sm border border-white/20 shrink-0",style:{backgroundColor:g(l)}}),s.jsx("span",{className:"text-text-primary truncate max-w-[80px]",children:a?.username||e.slice(0,6)}),t.finishedAt?s.jsx("span",{className:"text-green-400",children:"âœ“"}):s.jsxs("span",{className:"text-text-muted",children:[t.cardsInZone.length," ",w({en:"cards",vi:"tháº»"})]})]},e)})})]})]})}export{b as default};
