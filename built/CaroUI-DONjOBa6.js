import{u as e,j as t}from"./index-B5e3DCQv.js";import{j as s,X as n,e as l,K as a,M as r,Q as i,V as o,Y as c,O as d}from"./react-vendor-BBF6bHIx.js";import"./socket-DRbsQkF5.js";import"./zustand-BazUDoMU.js";const x=50,h=40;function m({game:m}){const u=m,[g,p]=s.useState(u.getState()),{userId:f,username:w}=e(),{board:v,winningLine:b,pendingUndoRequest:j}=g,y=u.getPlayerSymbol(),N=g.currentTurn===y;s.useEffect(()=>{u.onUpdate(e=>p(e))},[u]);const M=s.useRef(null),k=s.useRef(null),[O,T]=s.useState({x:20,y:20}),[Y,X]=s.useState(!1),[S,C]=s.useState({x:0,y:0,viewportX:0,viewportY:0}),[P,U]=s.useState(null),[W,q]=s.useState({width:600,height:600}),R=()=>{const e=g.history;if(0===e.length)return null;const t=e[e.length-1],[s,n]=t.split(",").map(Number);return{row:s,col:n}};s.useEffect(()=>{const e=()=>{if(k.current){const e=k.current.clientWidth,t=window.innerHeight-200,s=Math.min(e,t,600);q({width:s,height:s})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{const e=M.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.clearRect(0,0,W.width,W.height);const s=h,n=Math.ceil(W.width/s),l=Math.ceil(W.height/s),a=-O.x*s%s,r=-O.y*s%s,i=Math.floor(O.x),o=Math.floor(O.y);t.strokeStyle="#334155",t.lineWidth=1;for(let c=0;c<=n+1;c++){const e=a+c*s;t.beginPath(),t.moveTo(e,0),t.lineTo(e,W.height),t.stroke()}for(let c=0;c<=l+1;c++){const e=r+c*s;t.beginPath(),t.moveTo(0,e),t.lineTo(W.width,e),t.stroke()}if(P&&N&&!g.gameOver){const e=P.col-i,c=P.row-o;e>=0&&e<n&&c>=0&&c<l&&(t.fillStyle="rgba(148, 163, 184, 0.2)",t.fillRect(a+e*s,r+c*s,s,s))}for(let c=0;c<n+1;c++)for(let e=0;e<l+1;e++){const n=i+c,l=o+e;if(n<0||n>=x||l<0||l>=x)continue;const d=v[`${l},${n}`];if(!d)continue;const h=a+c*s+20,m=r+e*s+20,u=b?.some(([e,t])=>e===l&&t===n),g=R(),p=g&&g.row===l&&g.col===n;if(p&&!u&&(t.fillStyle="rgba(251, 191, 36, 0.25)",t.fillRect(a+c*s,r+e*s,s,s)),"X"===d){t.strokeStyle=u?"#4ade80":"#3b82f6",t.lineWidth=p?4:3;const e=12;t.beginPath(),t.moveTo(h-e,m-e),t.lineTo(h+e,m+e),t.stroke(),t.beginPath(),t.moveTo(h+e,m-e),t.lineTo(h-e,m+e),t.stroke()}else{t.strokeStyle=u?"#4ade80":"#ef4444",t.lineWidth=p?4:3;const e=10;t.beginPath(),t.arc(h,m,e,0,2*Math.PI),t.stroke()}}t.fillStyle="#64748b",t.font="10px monospace",t.fillText(`(${i}, ${o})`,5,15)},[O,v,b,P,N,g.gameOver,W]);const $=(e,t)=>{const s=M.current;if(!s)return null;const n=s.getBoundingClientRect(),l=e-n.left,a=t-n.top,r=Math.floor(O.x+l/40),i=Math.floor(O.y+a/40);return r<0||r>=x||i<0||i>=x?null:{row:i,col:r}};return t.jsxs("div",{className:"flex flex-col gap-3 p-2 md:p-4 w-full",children:[t.jsxs("div",{className:"flex flex-col gap-2 p-3 bg-slate-800 rounded-lg w-full max-w-[400px] mx-auto",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-1",children:"Players"}),["X","O"].map(e=>{const s=g.players[e],r=g.currentTurn===e&&!g.gameOver,i=e===y,o="BOT"===s,c=o?"Bot":i?w:s?"Opponent":null;return t.jsxs("div",{className:`\n                flex items-center justify-between p-2 rounded-lg\n                ${r?"bg-slate-600 ring-2 ring-blue-400":"bg-slate-700"}\n              `,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:"X"===e?t.jsx(n,{className:"w-5 h-5 text-blue-400",strokeWidth:2.5}):t.jsx(l,{className:"w-5 h-5 text-red-400",strokeWidth:2.5})}),t.jsxs("span",{className:"text-white",children:[c||"(waiting...)",o&&" ðŸ¤–",i&&s&&" (You)"]})]}),o&&u.isHostUser&&!g.gameOver&&t.jsx("button",{onClick:()=>u.removeBot(),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:"Remove"}),!s&&u.isHostUser&&!g.gameOver&&"O"===e&&t.jsxs("button",{onClick:()=>u.addBot(),className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors flex items-center gap-1",children:[t.jsx(a,{className:"w-3 h-3"})," Add Bot"]})]},e)})]}),"waiting"===g.gamePhase&&u.isHostUser&&t.jsx("div",{className:"flex flex-col items-center gap-2",children:u.canStartGame()?t.jsxs("button",{onClick:()=>u.startGame(),className:"px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(r,{className:"w-4 h-4"}),"Start Game"]}):t.jsx("span",{className:"text-sm text-slate-400",children:"Waiting for opponent to join..."})}),"waiting"===g.gamePhase&&!u.isHostUser&&t.jsx("div",{className:"text-sm text-slate-400",children:"Waiting for host to start the game..."}),"playing"===g.gamePhase&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("div",{className:"text-sm font-semibold",children:g.gameOver?g.winner?t.jsx("span",{className:g.winner===y?"text-green-400":"text-red-400",children:g.winner===y?"You Won!":"Opponent Won!"}):t.jsx("span",{className:"text-yellow-400",children:"Draw!"}):t.jsx("span",{className:N?"text-primary-400":"text-slate-400",children:N?"Your Turn":"Opponent's Turn"})})}),t.jsxs("div",{className:"flex gap-1 md:gap-2 text-xs",children:[g.gameOver?t.jsxs("button",{onClick:()=>u.requestReset(),className:"px-2 py-1 bg-primary-600 hover:bg-primary-500 rounded text-white flex items-center gap-1",title:"New game",children:[t.jsx(i,{className:"w-3 h-3"}),t.jsx("span",{children:"New Game"})]}):Object.keys(v).length>0?t.jsxs("button",{onClick:()=>{const e=R();if(!e)return;const t=W.width/h,s=W.height/h,n=Math.max(0,e.col-t/2+.5),l=Math.max(0,e.row-s/2+.5),a=O.x,r=O.y,i=performance.now(),o=e=>{const t=e-i,s=Math.min(t/300,1),c=1-Math.pow(1-s,3);T({x:a+(n-a)*c,y:r+(l-r)*c}),s<1&&requestAnimationFrame(o)};requestAnimationFrame(o)},disabled:0===Object.keys(v).length,className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",title:"Focus to last move",children:[t.jsx(o,{className:"w-3 h-3"}),t.jsx("span",{children:"Last"})]}):null,!g.gameOver&&Object.keys(v).length>0&&!N&&!j&&t.jsxs("button",{onClick:()=>u.requestUndo(),className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1",title:"Request undo from opponent",children:[t.jsx(c,{className:"w-3 h-3"}),t.jsx("span",{children:"Undo"})]}),!g.gameOver&&0===Object.keys(v).length&&N&&t.jsxs("button",{onClick:()=>u.switchTurn(),className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1",title:"Give first move to opponent",children:[t.jsx(d,{className:"w-3 h-3"}),t.jsx("span",{children:"Give First Move"})]})]})]}),j&&t.jsxs("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg border border-slate-700",children:[j===f&&t.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-amber-400",children:[t.jsx(c,{className:"w-4 h-4 animate-pulse"}),t.jsx("span",{children:"Waiting for opponent to respond to undo request..."})]}),j!==f&&t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-300",children:[t.jsx(c,{className:"w-4 h-4 text-amber-400"}),t.jsx("span",{children:"Opponent is requesting to undo their last move"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>u.responseUndo(!0),className:"px-3 py-1.5 bg-green-600 hover:bg-green-500 rounded text-white text-sm font-medium flex items-center gap-1.5",title:"Allow undo",children:t.jsx("span",{children:"Allow"})}),t.jsx("button",{onClick:()=>u.responseUndo(!1),className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 rounded text-white text-sm font-medium flex items-center gap-1.5",title:"Deny undo",children:t.jsx("span",{children:"Deny"})})]})]})]}),t.jsx("div",{ref:k,className:"w-full flex items-center justify-center",children:t.jsx("canvas",{ref:M,width:W.width,height:W.height,style:{width:W.width,height:W.height},className:"border-2 border-slate-700 rounded-lg bg-slate-900 cursor-move touch-none",onMouseDown:e=>{X(!0),C({x:e.clientX,y:e.clientY,viewportX:O.x,viewportY:O.y})},onMouseMove:e=>{const t=$(e.clientX,e.clientY);if(U(t),Y){const t=(S.x-e.clientX)/h,s=(S.y-e.clientY)/h;T({x:Math.max(0,Math.min(49,S.viewportX+t)),y:Math.max(0,Math.min(49,S.viewportY+s))})}},onMouseUp:()=>{X(!1)},onMouseLeave:()=>{X(!1),U(null)},onClick:e=>{if(Math.abs(e.clientX-S.x)>5||Math.abs(e.clientY-S.y)>5)return;if(!N||g.gameOver)return;const t=$(e.clientX,e.clientY);if(!t)return;const s=`${t.row},${t.col}`;v[s]||u.requestMove(t.row,t.col)},onTouchStart:e=>{const t=e.touches[0];X(!0),C({x:t.clientX,y:t.clientY,viewportX:O.x,viewportY:O.y})},onTouchMove:e=>{const t=e.touches[0],s=$(t.clientX,t.clientY);if(U(s),Y){const e=(S.x-t.clientX)/h,s=(S.y-t.clientY)/h;T({x:Math.max(0,Math.min(49,S.viewportX+e)),y:Math.max(0,Math.min(49,S.viewportY+s))})}},onTouchEnd:e=>{const t=e.changedTouches[0];if(Math.abs(t.clientX-S.x)>5||Math.abs(t.clientY-S.y)>5)return X(!1),void U(null);if(X(!1),U(null),!N||g.gameOver)return;const s=$(t.clientX,t.clientY);if(!s)return;const n=`${s.row},${s.col}`;v[n]||u.requestMove(s.row,s.col)}})}),t.jsx("div",{className:"text-xs text-slate-500 text-center",children:"Drag to pan â€¢ Click to place"})]})}export{m as default};
