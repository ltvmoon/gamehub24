import{a as e,u as s,j as t}from"./index-D-XPE7Sg.js";import{l as n,aa as i,a5 as a,V as l,X as r}from"./react-vendor-DHfsLwQ8.js";import"./Chess-DNA3ARjp.js";import{C as o}from"./chess-DTd62Tay.js";import{C as c}from"./chessground-CpDKPGt0.js";import"./socket-DRbsQkF5.js";import"./zustand-B0wmbcSC.js";import"./BaseGame-CdCeozej.js";function d({game:d}){const h=d,[x,m]=n.useState(h.getState()),{userId:u}=e(),{ti:g,ts:v}=s(),[p,b]=n.useState(!1),w=n.useRef(null),f=n.useRef(null);n.useEffect(()=>h.onUpdate(e=>m(e)),[h]);const j=h.getPlayerColor(),N=!!j&&x.turn===j,y=x.check;n.useEffect(()=>{if(!w.current)return;const e="w"===j?"white":"black",s={fen:x.fen,orientation:e,turnColor:"w"===x.turn?"white":"black",movable:{free:!1,color:N?j:void 0,dests:k(x.fen)},events:{move:(e,s)=>{const t=new o(x.fen).get(e),n="p"===t?.type&&("w"===t.color&&"8"===s[1]||"b"===t.color&&"1"===s[1]);h.requestMove(e,s,n?"q":void 0)}},draggable:{enabled:!0,showGhost:!0},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200}};return f.current?f.current.set({fen:x.fen,turnColor:"w"===x.turn?"white":"black",movable:{free:!1,color:N&&!x.gameOver?e:void 0,dests:N?k(x.fen):new Map},check:y?"w"===x.turn?"white":"black":void 0,lastMove:x.lastMove?[x.lastMove.from,x.lastMove.to]:void 0}):f.current=c(w.current,s),()=>{}},[x.fen,N,x.gameOver,j]);const k=e=>{const s=new Map;if(!N||x.gameOver)return s;const t=new o(e).moves({verbose:!0});for(const n of t){const e=n.from,t=n.to;s.has(e)||s.set(e,[]),s.get(e)?.push(t)}return s};return t.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-2xl mx-auto",children:[p&&t.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full max-h-[80vh] overflow-y-auto shadow-2xl relative",children:[t.jsx("button",{onClick:()=>b(!1),className:"absolute top-4 right-4 p-2 hover:bg-white/10 rounded-full transition-colors text-slate-400 hover:text-white",children:t.jsx(r,{className:"w-5 h-5"})}),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[t.jsx(i,{className:"w-6 h-6 text-yellow-500"}),g({en:"Game Rules",vi:"Luáº­t ChÆ¡i"})]}),t.jsxs("div",{className:"space-y-4 text-slate-300 leading-relaxed",children:[t.jsxs("section",{children:[t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:g({en:"Objective",vi:"Má»¥c tiÃªu"})}),t.jsx("p",{children:g({en:"Checkmate the opponent's king. White moves first.",vi:"Chiáº¿u bÃ­ vua cá»§a Ä‘á»‘i phÆ°Æ¡ng. Tráº¯ng Ä‘i trÆ°á»›c."})})]}),t.jsxs("section",{children:[t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:g({en:"Basic Rules",vi:"Quy Táº¯c CÆ¡ Báº£n"})}),t.jsxs("ul",{className:"space-y-2 list-disc pl-4 text-sm",children:[t.jsxs("li",{children:[t.jsx("strong",{children:g({en:"King",vi:"Vua"})}),":"," ",g({en:"Moves one square in any direction.",vi:"Di chuyá»ƒn 1 Ã´ theo má»i hÆ°á»›ng."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:g({en:"Queen",vi:"Háº­u"})}),":"," ",g({en:"Moves diagonally, horizontally, or vertically any number of squares.",vi:"Di chuyá»ƒn ngang, dá»c, chÃ©o bao nhiÃªu Ã´ tÃ¹y Ã½."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:g({en:"Rook",vi:"Xe"})}),":"," ",g({en:"Moves horizontally or vertically any number of squares.",vi:"Di chuyá»ƒn ngang hoáº·c dá»c bao nhiÃªu Ã´ tÃ¹y Ã½."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:g({en:"Bishop",vi:"TÆ°á»£ng"})}),":"," ",g({en:"Moves diagonally any number of squares.",vi:"Di chuyá»ƒn chÃ©o bao nhiÃªu Ã´ tÃ¹y Ã½."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:g({en:"Knight",vi:"MÃ£"})}),":"," ",g({en:"Moves in an 'L' shape: two squares in one direction and then one square perpendicular to that direction.",vi:"Di chuyá»ƒn theo hÃ¬nh chá»¯ L."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:g({en:"Pawn",vi:"Tá»‘t"})}),":"," ",g({en:"Moves forward one square (or two on the first move). Captures diagonally.",vi:"Di chuyá»ƒn tháº³ng 1 Ã´ (hoáº·c 2 á»Ÿ nÆ°á»›c Ä‘áº§u). Ä‚n chÃ©o."})]})]})]}),t.jsxs("section",{children:[t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:g({en:"Special Moves",vi:"NÆ°á»›c Äi Äáº·c Biá»‡t"})}),t.jsxs("ul",{className:"space-y-2 list-disc pl-4 text-sm",children:[t.jsx("li",{children:g({en:"Castling: Move the King two squares towards a Rook.",vi:"Nháº­p thÃ nh: Di chuyá»ƒn Vua 2 Ã´ vá» phÃ­a Xe."})}),t.jsx("li",{children:g({en:"En Passant: Special pawn capture.",vi:"Báº¯t tá»‘t qua Ä‘Æ°á»ng."})}),t.jsx("li",{children:g({en:"Promotion: Pawn reaching the other side becomes a Queen, Rook, Bishop, or Knight.",vi:"Phong cáº¥p: Tá»‘t Ä‘i Ä‘áº¿n cuá»‘i bÃ n cá» Ä‘Æ°á»£c phong lÃ m Háº­u, Xe, TÆ°á»£ng hoáº·c MÃ£."})})]})]})]})]})]})}),t.jsx("button",{onClick:()=>b(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-500 transition-colors z-40 shadow-lg border border-slate-500",title:v({en:"Rules",vi:"Luáº­t chÆ¡i"}),children:t.jsx(i,{size:24})}),t.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-slate-800 rounded-lg w-full max-w-[400px] mx-auto",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-1",children:g({en:"Players",vi:"NgÆ°á»i chÆ¡i"})}),["white","black"].map(e=>{const s=x.players[e],n=s?.isBot,i=x.turn===("white"===e?"w":"b")&&!x.gameOver,l=s?.id===u;return t.jsxs("div",{className:`\n                flex items-center justify-between p-2 rounded-lg\n                ${i?"bg-slate-600 ring-2 ring-yellow-400":"bg-slate-700"}\n              `,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center "+("white"===e?"bg-white":"bg-black")}),t.jsxs("span",{className:"text-white",children:[n?"Bot":s?s.username:g({en:"(waiting...)",vi:"(Ä‘ang chá»...)"}),n&&" ðŸ¤–",l&&s&&g({en:" (You)",vi:" (Báº¡n)"})]})]}),n&&h.isHost&&!x.gameOver&&t.jsx("button",{onClick:()=>h.removeBot(),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:g({en:"Remove",vi:"XÃ³a"})}),!s&&h.isHost&&!x.gameOver&&t.jsxs("button",{onClick:()=>h.addBot(),disabled:x.isBotLoading,className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors flex items-center gap-1",children:[x.isBotLoading?t.jsx("span",{className:"w-3 h-3 border-2 border-white/20 border-t-white rounded-full animate-spin"}):t.jsx(a,{className:"w-3 h-3"}),g({en:"Add Bot",vi:"ThÃªm Bot"})]})]},e)})]}),x.gameOver?t.jsx("div",{className:"text-lg font-bold text-center my-2",children:x.winner?t.jsx("span",{className:x.winner===("w"===j?"white":"black")?"text-green-400":"text-red-400",children:x.winner===(u===x.players.white?.id?"white":"black")?g({en:"You Won!",vi:"Báº¡n tháº¯ng!"}):g({en:"Opponent Won!",vi:"Äá»‘i thá»§ tháº¯ng!"})}):t.jsx("span",{className:"text-yellow-400",children:g({en:"Draw!",vi:"HÃ²a!"})})}):y&&x.turn===j&&t.jsx("div",{className:"text-center my-2",children:t.jsx("div",{className:"text-red-400 font-bold animate-pulse",children:g({en:"Check!",vi:"Chiáº¿u!"})})}),t.jsxs("div",{className:"flex flex-col gap-2 justify-center items-center w-full",children:[t.jsx("div",{className:"text-lg text-gray-400",children:N?t.jsx("span",{className:"text-green-400",children:g({en:"Your turn!",vi:"LÆ°á»£t cá»§a báº¡n!"})}):t.jsxs("span",{children:[g({en:"Waiting for",vi:"Äang chá»"})," ",x.players["w"===j?"black":"white"]?.username," ",g({en:"...",vi:"..."})]})}),!x.gameOver&&!x.pendingNewGameRequest&&t.jsxs("button",{onClick:()=>h.requestReset(),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(l,{className:"w-4 h-4"}),g({en:"New Game",vi:"VÃ¡n má»›i"})]}),x.gameOver&&t.jsxs("button",{onClick:()=>h.requestReset(),className:"px-6 py-2 bg-primary-600 hover:bg-primary-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(l,{className:"w-4 h-4"}),g({en:"Play Again",vi:"ChÆ¡i láº¡i"})]})]}),x.pendingNewGameRequest&&x.pendingNewGameRequest!==u&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-xl flex flex-col gap-4 max-w-sm w-full",children:[t.jsx("div",{className:"text-lg text-white font-medium text-center",children:g({en:"Opponent wants to start a new game",vi:"Äá»‘i thá»§ muá»‘n chÆ¡i vÃ¡n má»›i"})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>h.onSocketGameAction({action:{type:"NEW_GAME_RESPONSE",accepted:!0}}),className:"flex-1 bg-green-600 hover:bg-green-500 py-2 rounded-lg text-white font-medium",children:g({en:"Accept",vi:"Äá»“ng Ã½"})}),t.jsx("button",{onClick:()=>h.onSocketGameAction({action:{type:"NEW_GAME_RESPONSE",accepted:!1}}),className:"flex-1 bg-red-600 hover:bg-red-500 py-2 rounded-lg text-white font-medium",children:g({en:"Decline",vi:"Tá»« chá»‘i"})})]})]})}),x.pendingNewGameRequest&&x.pendingNewGameRequest===u&&t.jsx("div",{className:"text-sm text-yellow-400 animate-pulse flex items-center justify-center",children:g({en:"Requesting New Game...",vi:"Äang yÃªu cáº§u vÃ¡n má»›i..."})}),t.jsx("div",{className:"w-full max-w-xl",children:t.jsx("div",{ref:w,className:"w-full aspect-square rounded-lg overflow-hidden",style:{maxHeight:"min(80vh, 600px)"}})}),t.jsxs("div",{className:"w-full flex justify-between gap-4 text-sm",children:[t.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1 bg-slate-400",children:[t.jsxs("div",{className:"text-xs text-slate-100 mb-1",children:[g({en:"White captured:",vi:"Tráº¯ng báº¯t:"})," "]}),t.jsx("div",{className:"flex flex-wrap gap-1",children:x.capturedPieces.white.map((e,s)=>t.jsx("img",{src:`https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/cburnett/b${e.toUpperCase()}.svg`,alt:e,className:"w-5 h-5 object-contain"},s))})]}),t.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[t.jsx("div",{className:"text-xs text-slate-400 mb-1",children:g({en:"Black captured:",vi:"Äen báº¯t:"})}),t.jsx("div",{className:"flex flex-wrap gap-1",children:x.capturedPieces.black.map((e,s)=>t.jsx("img",{src:`https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/cburnett/w${e.toUpperCase()}.svg`,alt:e,className:"w-5 h-5 object-contain"},s))})]})]})]})}export{d as default};
