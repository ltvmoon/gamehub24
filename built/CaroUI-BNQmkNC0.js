import{u as e,a as t,j as n}from"./index-Dgl20RHv.js";import{l as s,X as i,e as a,a3 as o,a4 as l,a6 as r,a7 as c,a8 as h,a5 as d}from"./react-vendor-DqvDgvkG.js";import"./socket-DRbsQkF5.js";import"./zustand-DHxpPrWm.js";const x=50,m=40;function u({game:u}){const g=u,[p,v]=s.useState(g.getState()),{userId:f,username:w}=e(),{ti:b}=t(),{board:j,winningLine:y,pendingUndoRequest:N}=p,M=g.getPlayerSymbol(),k=p.currentTurn===M;s.useEffect(()=>{g.onUpdate(e=>v(e))},[g]);const O=s.useRef(null),T=s.useRef(null),[X,Y]=s.useState({x:20,y:20}),[S,C]=s.useState(!1),[q,P]=s.useState({x:0,y:0,viewportX:0,viewportY:0}),[U,W]=s.useState(null),[B,R]=s.useState({width:600,height:600}),$=()=>{const e=p.history;if(0===e.length)return null;const t=e[e.length-1],[n,s]=t.split(",").map(Number);return{row:n,col:s}};s.useEffect(()=>{const e=()=>{if(T.current){const e=T.current.clientWidth,t=window.innerHeight-200,n=Math.min(e,t,600);R({width:n,height:n})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{const e=O.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.clearRect(0,0,B.width,B.height);const n=m,s=Math.ceil(B.width/n),i=Math.ceil(B.height/n),a=-X.x*n%n,o=-X.y*n%n,l=Math.floor(X.x),r=Math.floor(X.y);t.strokeStyle="#334155",t.lineWidth=1;for(let c=0;c<=s+1;c++){const e=a+c*n;t.beginPath(),t.moveTo(e,0),t.lineTo(e,B.height),t.stroke()}for(let c=0;c<=i+1;c++){const e=o+c*n;t.beginPath(),t.moveTo(0,e),t.lineTo(B.width,e),t.stroke()}if(U&&k&&!p.gameOver){const e=U.col-l,c=U.row-r;e>=0&&e<s&&c>=0&&c<i&&(t.fillStyle="rgba(148, 163, 184, 0.2)",t.fillRect(a+e*n,o+c*n,n,n))}for(let c=0;c<s+1;c++)for(let e=0;e<i+1;e++){const s=l+c,i=r+e;if(s<0||s>=x||i<0||i>=x)continue;const h=j[`${i},${s}`];if(!h)continue;const d=a+c*n+20,m=o+e*n+20,u=y?.some(([e,t])=>e===i&&t===s),g=$(),p=g&&g.row===i&&g.col===s;if(p&&!u&&(t.fillStyle="rgba(251, 191, 36, 0.25)",t.fillRect(a+c*n,o+e*n,n,n)),"X"===h){t.strokeStyle=u?"#4ade80":"#3b82f6",t.lineWidth=p?4:3;const e=12;t.beginPath(),t.moveTo(d-e,m-e),t.lineTo(d+e,m+e),t.stroke(),t.beginPath(),t.moveTo(d+e,m-e),t.lineTo(d-e,m+e),t.stroke()}else{t.strokeStyle=u?"#4ade80":"#ef4444",t.lineWidth=p?4:3;const e=10;t.beginPath(),t.arc(d,m,e,0,2*Math.PI),t.stroke()}}t.fillStyle="#64748b",t.font="10px monospace",t.fillText(`(${l}, ${r})`,5,15)},[X,j,y,U,k,p.gameOver,B]);const H=(e,t)=>{const n=O.current;if(!n)return null;const s=n.getBoundingClientRect(),i=e-s.left,a=t-s.top,o=Math.floor(X.x+i/40),l=Math.floor(X.y+a/40);return o<0||o>=x||l<0||l>=x?null:{row:l,col:o}};return n.jsxs("div",{className:"flex flex-col gap-3 p-2 md:p-4 w-full",children:[n.jsxs("div",{className:"flex flex-col gap-2 p-3 bg-slate-800 rounded-lg w-full max-w-[400px] mx-auto",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-1",children:"Players"}),["X","O"].map(e=>{const t=p.players[e],s=p.currentTurn===e&&!p.gameOver,l=e===M,r="BOT"===t,c=r?"Bot":l?w:t?b({en:"Opponent",vi:"Äá»‘i thá»§"}):null;return n.jsxs("div",{className:`\n                flex items-center justify-between p-2 rounded-lg\n                ${s?"bg-slate-600 ring-2 ring-blue-400":"bg-slate-700"}\n              `,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:"X"===e?n.jsx(i,{className:"w-5 h-5 text-blue-400",strokeWidth:2.5}):n.jsx(a,{className:"w-5 h-5 text-red-400",strokeWidth:2.5})}),n.jsxs("span",{className:"text-white",children:[c||b({en:"(waiting...)",vi:"(Ä‘ang chá»...)"}),r&&" ðŸ¤–",l&&t&&b({en:" (You)",vi:" (Báº¡n)"})]})]}),r&&g.isHostUser&&!p.gameOver&&n.jsx("button",{onClick:()=>g.removeBot(),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:b({en:"Remove",vi:"XÃ³a"})}),!t&&g.isHostUser&&!p.gameOver&&"O"===e&&n.jsxs("button",{onClick:()=>g.addBot(),className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors flex items-center gap-1",children:[n.jsx(o,{className:"w-3 h-3"})," ",b({en:"Add Bot",vi:"ThÃªm Bot"})]})]},e)})]}),"waiting"===p.gamePhase&&g.isHostUser&&n.jsx("div",{className:"flex flex-col items-center gap-2",children:g.canStartGame()?n.jsxs("button",{onClick:()=>g.startGame(),className:"px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[n.jsx(l,{className:"w-4 h-4"}),b({en:"Start Game",vi:"Báº¯t Ä‘áº§u"})]}):n.jsx("span",{className:"text-sm text-slate-400",children:b({en:"Waiting for opponent to join...",vi:"Äang chá» Ä‘á»‘i thá»§ tham gia..."})})}),"waiting"===p.gamePhase&&!g.isHostUser&&n.jsx("div",{className:"text-sm text-slate-400",children:b({en:"Waiting for host to start the game...",vi:"Äang chá» chá»§ phÃ²ng báº¯t Ä‘áº§u..."})}),"playing"===p.gamePhase&&n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"flex items-center gap-3",children:n.jsx("div",{className:"text-sm font-semibold",children:p.gameOver?p.winner?n.jsx("span",{className:p.winner===M?"text-green-400":"text-red-400",children:p.winner===M?b({en:"You Won!",vi:"Báº¡n tháº¯ng!"}):b({en:"Opponent Won!",vi:"Äá»‘i thá»§ tháº¯ng!"})}):n.jsx("span",{className:"text-yellow-400",children:b({en:"Draw!",vi:"HÃ²a!"})}):n.jsx("span",{className:k?"text-primary-400":"text-slate-400",children:b(k?{en:"Your Turn",vi:"LÆ°á»£t cá»§a báº¡n"}:{en:"Opponent's Turn",vi:"LÆ°á»£t Ä‘á»‘i thá»§"})})})}),n.jsxs("div",{className:"flex gap-1 md:gap-2 text-xs",children:[p.gameOver?n.jsxs("button",{onClick:()=>g.requestReset(),className:"px-2 py-1 bg-primary-600 hover:bg-primary-500 rounded text-white flex items-center gap-1",title:b({en:"New game",vi:"VÃ¡n má»›i"}),children:[n.jsx(r,{className:"w-3 h-3"}),n.jsx("span",{children:b({en:"New Game",vi:"VÃ¡n má»›i"})})]}):Object.keys(j).length>0?n.jsxs("button",{onClick:()=>{const e=$();if(!e)return;const t=B.width/m,n=B.height/m,s=Math.max(0,e.col-t/2+.5),i=Math.max(0,e.row-n/2+.5),a=X.x,o=X.y,l=performance.now(),r=e=>{const t=e-l,n=Math.min(t/300,1),c=1-Math.pow(1-n,3);Y({x:a+(s-a)*c,y:o+(i-o)*c}),n<1&&requestAnimationFrame(r)};requestAnimationFrame(r)},disabled:0===Object.keys(j).length,className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",title:b({en:"Focus to last move",vi:"Xem nÆ°á»›c Ä‘i cuá»‘i"}),children:[n.jsx(c,{className:"w-3 h-3"}),n.jsx("span",{children:b({en:"Last",vi:"Cuá»‘i"})})]}):null,!p.gameOver&&Object.keys(j).length>0&&!k&&!N&&n.jsxs("button",{onClick:()=>g.requestUndo(),className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1",title:b({en:"Request undo from opponent",vi:"YÃªu cáº§u Ä‘á»‘i thá»§ hoÃ n tÃ¡c"}),children:[n.jsx(h,{className:"w-3 h-3"}),n.jsx("span",{children:b({en:"Undo",vi:"HoÃ n tÃ¡c"})})]}),!p.gameOver&&0===Object.keys(j).length&&k&&n.jsxs("button",{onClick:()=>g.switchTurn(),className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1",title:b({en:"Give first move to opponent",vi:"NhÆ°á»ng nÆ°á»›c Ä‘i Ä‘áº§u cho Ä‘á»‘i thá»§"}),children:[n.jsx(d,{className:"w-3 h-3"}),n.jsx("span",{children:b({en:"Give First Move",vi:"NhÆ°á»ng Ä‘i trÆ°á»›c"})})]})]})]}),N&&n.jsxs("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg border border-slate-700",children:[N===f&&n.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-amber-400",children:[n.jsx(h,{className:"w-4 h-4 animate-pulse"}),n.jsx("span",{children:b({en:"Waiting for opponent to respond to undo request...",vi:"Äang chá» Ä‘á»‘i thá»§ pháº£n há»“i yÃªu cáº§u hoÃ n tÃ¡c..."})})]}),N!==f&&n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-300",children:[n.jsx(h,{className:"w-4 h-4 text-amber-400"}),n.jsx("span",{children:b({en:"Opponent is requesting to undo their last move",vi:"Äá»‘i thá»§ yÃªu cáº§u hoÃ n tÃ¡c nÆ°á»›c Ä‘i cuá»‘i"})})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>g.responseUndo(!0),className:"px-3 py-1.5 bg-green-600 hover:bg-green-500 rounded text-white text-sm font-medium flex items-center gap-1.5",title:b({en:"Allow undo",vi:"Cho phÃ©p hoÃ n tÃ¡c"}),children:n.jsx("span",{children:b({en:"Allow",vi:"Äá»“ng Ã½"})})}),n.jsx("button",{onClick:()=>g.responseUndo(!1),className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 rounded text-white text-sm font-medium flex items-center gap-1.5",title:b({en:"Deny undo",vi:"Tá»« chá»‘i hoÃ n tÃ¡c"}),children:n.jsx("span",{children:b({en:"Deny",vi:"Tá»« chá»‘i"})})})]})]})]}),n.jsx("div",{ref:T,className:"w-full flex items-center justify-center",children:n.jsx("canvas",{ref:O,width:B.width,height:B.height,style:{width:B.width,height:B.height},className:"border-2 border-slate-700 rounded-lg bg-slate-900 cursor-move touch-none",onMouseDown:e=>{C(!0),P({x:e.clientX,y:e.clientY,viewportX:X.x,viewportY:X.y})},onMouseMove:e=>{const t=H(e.clientX,e.clientY);if(W(t),S){const t=(q.x-e.clientX)/m,n=(q.y-e.clientY)/m;Y({x:Math.max(0,Math.min(49,q.viewportX+t)),y:Math.max(0,Math.min(49,q.viewportY+n))})}},onMouseUp:()=>{C(!1)},onMouseLeave:()=>{C(!1),W(null)},onClick:e=>{if(Math.abs(e.clientX-q.x)>5||Math.abs(e.clientY-q.y)>5)return;if(!k||p.gameOver)return;const t=H(e.clientX,e.clientY);if(!t)return;const n=`${t.row},${t.col}`;j[n]||g.requestMove(t.row,t.col)},onTouchStart:e=>{const t=e.touches[0];C(!0),P({x:t.clientX,y:t.clientY,viewportX:X.x,viewportY:X.y})},onTouchMove:e=>{const t=e.touches[0],n=H(t.clientX,t.clientY);if(W(n),S){const e=(q.x-t.clientX)/m,n=(q.y-t.clientY)/m;Y({x:Math.max(0,Math.min(49,q.viewportX+e)),y:Math.max(0,Math.min(49,q.viewportY+n))})}},onTouchEnd:e=>{const t=e.changedTouches[0];if(Math.abs(t.clientX-q.x)>5||Math.abs(t.clientY-q.y)>5)return C(!1),void W(null);if(C(!1),W(null),!k||p.gameOver)return;const n=H(t.clientX,t.clientY);if(!n)return;const s=`${n.row},${n.col}`;j[s]||g.requestMove(n.row,n.col)}})}),n.jsx("div",{className:"text-xs text-slate-500 text-center",children:b({en:"Drag to pan â€¢ Click to place",vi:"KÃ©o Ä‘á»ƒ di chuyá»ƒn â€¢ Nháº¥p Ä‘á»ƒ Ä‘áº·t quÃ¢n"})})]})}export{u as default};
