import{a as e,u as t,j as s}from"./index-D69VEbX5.js";import{c as n,ab as i,a9 as a,$ as l,ae as r,X as o}from"./react-vendor-BYtLKAeB.js";import"./Chess-BIwGRn9N.js";import{C as c}from"./chess-DTd62Tay.js";import{C as d}from"./chessground-CpDKPGt0.js";import"./socket-DRbsQkF5.js";import"./zustand-BLoNJECv.js";import"./BaseGame-CZt47sds.js";function h({game:h}){const x=h,[m,u]=n.useState(x.getState()),{userId:g}=e(),{ti:v,ts:p}=t(),[b,w]=n.useState(!1),f=n.useRef(null),j=n.useRef(null);n.useEffect(()=>x.onUpdate(e=>u(e)),[x]);const N=x.getPlayerColor(),y=!!N&&m.turn===N,k=m.check;n.useEffect(()=>{if(!f.current)return;const e="w"===N?"white":"black",t={fen:m.fen,orientation:e,turnColor:"w"===m.turn?"white":"black",movable:{free:!1,color:y?N:void 0,dests:C(m.fen)},events:{move:(e,t)=>{const s=new c(m.fen).get(e),n="p"===s?.type&&("w"===s.color&&"8"===t[1]||"b"===s.color&&"1"===t[1]);x.requestMove(e,t,n?"q":void 0)}},draggable:{enabled:!0,showGhost:!0},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200}};return j.current?j.current.set({fen:m.fen,turnColor:"w"===m.turn?"white":"black",movable:{free:!1,color:y&&!m.gameOver?e:void 0,dests:y?C(m.fen):new Map},check:k?"w"===m.turn?"white":"black":void 0,lastMove:m.lastMove?[m.lastMove.from,m.lastMove.to]:void 0}):j.current=d(f.current,t),()=>{}},[m.fen,y,m.gameOver,N]);const C=e=>{const t=new Map;if(!y||m.gameOver)return t;const s=new c(e).moves({verbose:!0});for(const n of s){const e=n.from,s=n.to;t.has(e)||t.set(e,[]),t.get(e)?.push(s)}return t};return s.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-2xl mx-auto",children:[s.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-slate-800 rounded-lg w-full max-w-[400px] mx-auto",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-1",children:v({en:"Players",vi:"Ng∆∞·ªùi ch∆°i"})}),["white","black"].map(e=>{const t=m.players[e],n=t?.isBot,i=m.turn===("white"===e?"w":"b")&&!m.gameOver,l=t?.id===g;return s.jsxs("div",{className:`\n                flex items-center justify-between p-2 rounded-lg\n                ${i?"bg-slate-600 ring-2 ring-yellow-400":"bg-slate-700"}\n              `,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center "+("white"===e?"bg-white":"bg-black")}),s.jsxs("span",{className:"text-white",children:[n?"Bot":t?t.username:v({en:"(waiting...)",vi:"(ƒëang ch·ªù...)"}),n&&" ü§ñ",l&&t&&v({en:" (You)",vi:" (B·∫°n)"})]})]}),n&&x.isHost&&!m.gameOver&&s.jsx("button",{onClick:()=>x.removeBot(),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:v({en:"Remove",vi:"X√≥a"})}),!t&&x.isHost&&!m.gameOver&&s.jsxs("button",{onClick:()=>x.addBot(),disabled:m.isBotLoading,className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors flex items-center gap-1",children:[m.isBotLoading?s.jsx("span",{className:"w-3 h-3 border-2 border-white/20 border-t-white rounded-full animate-spin"}):s.jsx(a,{className:"w-3 h-3"}),v({en:"Add Bot",vi:"Th√™m Bot"})]})]},e)})]}),m.gameOver?s.jsx("div",{className:"text-lg font-bold text-center my-2",children:m.winner?s.jsx("span",{className:m.winner===("w"===N?"white":"black")?"text-green-400":"text-red-400",children:m.winner===(g===m.players.white?.id?"white":"black")?v({en:"You Won!",vi:"B·∫°n th·∫Øng!"}):v({en:"Opponent Won!",vi:"ƒê·ªëi th·ªß th·∫Øng!"})}):s.jsx("span",{className:"text-yellow-400",children:v({en:"Draw!",vi:"H√≤a!"})})}):k&&m.turn===N&&s.jsx("div",{className:"text-center my-2",children:s.jsx("div",{className:"text-red-400 font-bold animate-pulse",children:v({en:"Check!",vi:"Chi·∫øu!"})})}),s.jsxs("div",{className:"flex flex-col gap-2 justify-center items-center w-full",children:[s.jsx("div",{className:"text-lg text-gray-400",children:y?s.jsx("span",{className:"text-green-400",children:v({en:"Your turn!",vi:"L∆∞·ª£t c·ªßa b·∫°n!"})}):s.jsxs("span",{children:[v({en:"Waiting for",vi:"ƒêang ch·ªù"})," ",m.players["w"===N?"black":"white"]?.username," ",v({en:"...",vi:"..."})]})}),!m.gameOver&&!m.pendingNewGameRequest&&s.jsxs("button",{onClick:()=>x.requestReset(),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[s.jsx(l,{className:"w-4 h-4"}),v({en:"New Game",vi:"V√°n m·ªõi"})]}),m.gameOver&&s.jsxs("button",{onClick:()=>x.requestReset(),className:"px-6 py-2 bg-primary-600 hover:bg-primary-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[s.jsx(l,{className:"w-4 h-4"}),v({en:"Play Again",vi:"Ch∆°i l·∫°i"})]})]}),m.pendingNewGameRequest&&m.pendingNewGameRequest!==g&&s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-xl flex flex-col gap-4 max-w-sm w-full",children:[s.jsx("div",{className:"text-lg text-white font-medium text-center",children:v({en:"Opponent wants to start a new game",vi:"ƒê·ªëi th·ªß mu·ªën ch∆°i v√°n m·ªõi"})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>x.onSocketGameAction({action:{type:"NEW_GAME_RESPONSE",accepted:!0}}),className:"flex-1 bg-green-600 hover:bg-green-500 py-2 rounded-lg text-white font-medium",children:v({en:"Accept",vi:"ƒê·ªìng √Ω"})}),s.jsx("button",{onClick:()=>x.onSocketGameAction({action:{type:"NEW_GAME_RESPONSE",accepted:!1}}),className:"flex-1 bg-red-600 hover:bg-red-500 py-2 rounded-lg text-white font-medium",children:v({en:"Decline",vi:"T·ª´ ch·ªëi"})})]})]})}),m.pendingNewGameRequest&&m.pendingNewGameRequest===g&&s.jsx("div",{className:"text-sm text-yellow-400 animate-pulse flex items-center justify-center",children:v({en:"Requesting New Game...",vi:"ƒêang y√™u c·∫ßu v√°n m·ªõi..."})}),s.jsx("div",{className:"w-full max-w-xl",children:s.jsx("div",{ref:f,className:"w-full aspect-square rounded-lg overflow-hidden",style:{maxHeight:"min(80vh, 600px)"}})}),s.jsxs("div",{className:"w-full flex justify-between gap-4 text-sm",children:[s.jsxs("div",{className:"rounded-lg p-2 flex-1 bg-slate-400",children:[s.jsxs("div",{className:"text-xs text-slate-100 mb-1",children:[v({en:"White captured:",vi:"Tr·∫Øng b·∫Øt:"})," "]}),s.jsx("div",{className:"flex flex-wrap gap-1",children:m.capturedPieces.white.map((e,t)=>s.jsx("img",{src:`https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/cburnett/b${e.toUpperCase()}.svg`,alt:e,className:"w-5 h-5 object-contain"},t))})]}),s.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[s.jsx("div",{className:"text-xs text-slate-400 mb-1",children:v({en:"Black captured:",vi:"ƒêen b·∫Øt:"})}),s.jsx("div",{className:"flex flex-wrap gap-1",children:m.capturedPieces.black.map((e,t)=>s.jsx("img",{src:`https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/cburnett/w${e.toUpperCase()}.svg`,alt:e,className:"w-5 h-5 object-contain"},t))})]})]}),s.jsx("button",{onClick:()=>w(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-500 transition-colors z-40 shadow-lg border border-slate-500",title:p({en:"Rules",vi:"Lu·∫≠t ch∆°i"}),children:s.jsx(r,{size:24})}),b&&i.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-100 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full max-h-[80vh] overflow-y-auto shadow-2xl relative",children:[s.jsx("button",{onClick:()=>w(!1),className:"absolute top-4 right-4 p-2 hover:bg-white/10 rounded-full transition-colors text-slate-400 hover:text-white",children:s.jsx(o,{className:"w-5 h-5"})}),s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[s.jsx(r,{className:"w-6 h-6 text-yellow-500"}),v({en:"Game Rules",vi:"Lu·∫≠t Ch∆°i"})]}),s.jsxs("div",{className:"space-y-4 text-slate-300 leading-relaxed",children:[s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:v({en:"Objective",vi:"M·ª•c ti√™u"})}),s.jsx("p",{children:v({en:"Checkmate the opponent's king. White moves first.",vi:"Chi·∫øu b√≠ vua c·ªßa ƒë·ªëi ph∆∞∆°ng. Tr·∫Øng ƒëi tr∆∞·ªõc."})})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:v({en:"Basic Rules",vi:"Quy T·∫Øc C∆° B·∫£n"})}),s.jsxs("ul",{className:"list-disc pl-4 text-sm",children:[s.jsxs("li",{children:[s.jsx("strong",{children:v({en:"King",vi:"Vua"})}),":"," ",v({en:"Moves one square in any direction.",vi:"Di chuy·ªÉn 1 √¥ theo m·ªçi h∆∞·ªõng."})]}),s.jsxs("li",{children:[s.jsx("strong",{children:v({en:"Queen",vi:"H·∫≠u"})}),":"," ",v({en:"Moves diagonally, horizontally, or vertically any number of squares.",vi:"Di chuy·ªÉn ngang, d·ªçc, ch√©o bao nhi√™u √¥ t√πy √Ω."})]}),s.jsxs("li",{children:[s.jsx("strong",{children:v({en:"Rook",vi:"Xe"})}),":"," ",v({en:"Moves horizontally or vertically any number of squares.",vi:"Di chuy·ªÉn ngang ho·∫∑c d·ªçc bao nhi√™u √¥ t√πy √Ω."})]}),s.jsxs("li",{children:[s.jsx("strong",{children:v({en:"Bishop",vi:"T∆∞·ª£ng"})}),":"," ",v({en:"Moves diagonally any number of squares.",vi:"Di chuy·ªÉn ch√©o bao nhi√™u √¥ t√πy √Ω."})]}),s.jsxs("li",{children:[s.jsx("strong",{children:v({en:"Knight",vi:"M√£"})}),":"," ",v({en:"Moves in an 'L' shape: two squares in one direction and then one square perpendicular to that direction.",vi:"Di chuy·ªÉn theo h√¨nh ch·ªØ L."})]}),s.jsxs("li",{children:[s.jsx("strong",{children:v({en:"Pawn",vi:"T·ªët"})}),":"," ",v({en:"Moves forward one square (or two on the first move). Captures diagonally.",vi:"Di chuy·ªÉn th·∫≥ng 1 √¥ (ho·∫∑c 2 ·ªü n∆∞·ªõc ƒë·∫ßu). ƒÇn ch√©o."})]})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:v({en:"Special Moves",vi:"N∆∞·ªõc ƒêi ƒê·∫∑c Bi·ªát"})}),s.jsxs("ul",{className:"list-disc pl-4 text-sm",children:[s.jsx("li",{children:v({en:"Castling: Move the King two squares towards a Rook.",vi:"Nh·∫≠p th√†nh: Di chuy·ªÉn Vua 2 √¥ v·ªÅ ph√≠a Xe."})}),s.jsx("li",{children:v({en:"En Passant: Special pawn capture.",vi:"B·∫Øt t·ªët qua ƒë∆∞·ªùng."})}),s.jsx("li",{children:v({en:"Promotion: Pawn reaching the other side becomes a Queen, Rook, Bishop, or Knight.",vi:"Phong c·∫•p: T·ªët ƒëi ƒë·∫øn cu·ªëi b√†n c·ªù ƒë∆∞·ª£c phong l√†m H·∫≠u, Xe, T∆∞·ª£ng ho·∫∑c M√£."})})]})]})]})]})]})}),document.body)]})}export{h as default};
