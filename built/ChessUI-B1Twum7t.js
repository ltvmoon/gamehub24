import{b as e,j as t}from"./index-DvVjFfh0.js";import{i as s,M as a,J as l}from"./react-vendor-DdoU0YZ6.js";import"./socket-DRbsQkF5.js";import{C as n}from"./chess-DTd62Tay.js";import{C as i}from"./chessground-CpDKPGt0.js";import"./zustand-BHVQ_asN.js";function r({game:r}){const[o,c]=s.useState(r.getState()),{userId:d}=e(),x=s.useRef(null),m=s.useRef(null);s.useEffect(()=>{r.onUpdate(e=>c(e))},[r]);const h="w"===r.getPlayerColor()?"white":"black",u=o.turn===("white"===h?"w":"b"),p=o.check;s.useEffect(()=>{if(!x.current)return;const e={fen:o.fen,orientation:h,turnColor:"w"===o.turn?"white":"black",movable:{free:!1,color:u?h:void 0,dests:g(o.fen)},events:{move:(e,t)=>{r.requestMove(e,t)}},draggable:{enabled:!0,showGhost:!0},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200}};return m.current?m.current.set({fen:o.fen,turnColor:"w"===o.turn?"white":"black",movable:{free:!1,color:u&&!o.gameOver?h:void 0,dests:u?g(o.fen):new Map},check:p?"w"===o.turn?"white":"black":void 0,lastMove:o.lastMove?[o.lastMove.from,o.lastMove.to]:void 0}):m.current=i(x.current,e),()=>{}},[o.fen,u,o.gameOver,h]);const g=e=>{const t=new Map;if(!u||o.gameOver)return t;const s=new n(e).moves({verbose:!0});for(const a of s){const e=a.from,s=a.to;t.has(e)||t.set(e,[]),t.get(e)?.push(s)}return t},w={p:"pawn",n:"knight",b:"bishop",r:"rook",q:"queen",k:"king"};return t.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-2xl mx-auto",children:[t.jsxs("div",{className:"w-full flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[o.gameOver?t.jsx("div",{className:"text-lg font-bold",children:o.winner?t.jsx("span",{className:o.winner===("white"===h?"white":"black")?"text-green-400":"text-red-400",children:o.winner===(d===o.players.white?"white":"black")?"You Won!":"Opponent Won!"}):t.jsx("span",{className:"text-yellow-400",children:"Draw!"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-lg font-bold "+(u?"text-primary-400":"text-slate-400"),children:u?"Your Turn":"Opponent's Turn"}),p&&o.turn===("white"===h?"w":"b")&&t.jsx("div",{className:"text-sm text-red-400 font-semibold",children:"You are in check!"})]}),t.jsxs("div",{className:"text-xs text-slate-500",children:["Playing as ","white"===h?"White":"Black"]})]}),t.jsxs("div",{className:"flex gap-2",children:[!o.gameOver&&!o.pendingNewGameRequest&&t.jsxs("button",{onClick:()=>r.requestReset(),className:"px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(a,{className:"w-4 h-4"}),"New Game"]}),o.gameOver&&t.jsxs("button",{onClick:()=>r.requestReset(),className:"px-3 py-2 bg-primary-600 hover:bg-primary-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(a,{className:"w-4 h-4"}),"Play Again"]}),!o.gameOver&&!o.players.black&&r.isHostUser&&t.jsxs("button",{onClick:()=>r.addBot(),disabled:o.isBotLoading,className:"px-3 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2 "+(o.isBotLoading?"opacity-50 cursor-not-allowed":""),children:[o.isBotLoading?t.jsx("span",{className:"w-4 h-4 border-2 border-white/20 border-t-white rounded-full animate-spin"}):t.jsx(l,{className:"w-4 h-4"}),o.isBotLoading?"Loading Bot...":"Play vs Bot"]})]}),o.pendingNewGameRequest&&o.pendingNewGameRequest!==d&&t.jsxs("div",{className:"flex flex-col gap-2 bg-slate-800 p-2 rounded-lg border border-slate-700 absolute top-20 left-1/2 -translate-x-1/2 z-10 shadow-xl",children:[t.jsx("div",{className:"text-sm text-white font-medium whitespace-nowrap",children:"Opponent wants New Game"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>r.handleAction({action:{type:"NEW_GAME_RESPONSE",accepted:!0}}),className:"flex-1 bg-green-600 hover:bg-green-500 text-xs py-1 px-2 rounded text-white",children:"Accept"}),t.jsx("button",{onClick:()=>r.handleAction({action:{type:"NEW_GAME_RESPONSE",accepted:!1}}),className:"flex-1 bg-red-600 hover:bg-red-500 text-xs py-1 px-2 rounded text-white",children:"Decline"})]})]}),o.pendingNewGameRequest&&o.pendingNewGameRequest===d&&t.jsx("div",{className:"text-sm text-yellow-400 animate-pulse flex items-center",children:"Requesting New Game..."})]}),t.jsx("div",{className:"w-full max-w-xl",children:t.jsx("div",{ref:x,className:"w-full aspect-square rounded-lg overflow-hidden",style:{maxHeight:"min(80vh, 600px)"}})}),t.jsxs("div",{className:"w-full flex justify-between gap-4 text-sm",children:[t.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[t.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"White captured:"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:o.capturedPieces.white.map((e,s)=>t.jsx("div",{className:`cg-icon ${w[e.toLowerCase()]} black`,style:{width:20,height:20,display:"inline-block",backgroundSize:"contain"}},s))})]}),t.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[t.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Black captured:"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:o.capturedPieces.black.map((e,s)=>t.jsx("div",{className:`cg-icon ${w[e.toLowerCase()]} white`,style:{width:20,height:20,display:"inline-block",backgroundSize:"contain"}},s))})]})]})]})}export{r as default};
