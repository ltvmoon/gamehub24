import{u as e,a as t,j as s}from"./index-Dgl20RHv.js";import{l as n,a6 as a,a3 as i}from"./react-vendor-DqvDgvkG.js";import"./socket-DRbsQkF5.js";import{C as l}from"./chess-DTd62Tay.js";import{C as r}from"./chessground-CpDKPGt0.js";import"./zustand-DHxpPrWm.js";function o({game:o}){const c=o,[d,m]=n.useState(c.getState()),{userId:x}=e(),{ti:h}=t(),u=n.useRef(null),p=n.useRef(null);n.useEffect(()=>{c.onUpdate(e=>m(e))},[c]);const g="w"===c.getPlayerColor()?"white":"black",v=d.turn===("white"===g?"w":"b"),w=d.check;n.useEffect(()=>{if(!u.current)return;const e={fen:d.fen,orientation:g,turnColor:"w"===d.turn?"white":"black",movable:{free:!1,color:v?g:void 0,dests:f(d.fen)},events:{move:(e,t)=>{c.requestMove(e,t)}},draggable:{enabled:!0,showGhost:!0},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200}};return p.current?p.current.set({fen:d.fen,turnColor:"w"===d.turn?"white":"black",movable:{free:!1,color:v&&!d.gameOver?g:void 0,dests:v?f(d.fen):new Map},check:w?"w"===d.turn?"white":"black":void 0,lastMove:d.lastMove?[d.lastMove.from,d.lastMove.to]:void 0}):p.current=r(u.current,e),()=>{}},[d.fen,v,d.gameOver,g]);const f=e=>{const t=new Map;if(!v||d.gameOver)return t;const s=new l(e).moves({verbose:!0});for(const n of s){const e=n.from,s=n.to;t.has(e)||t.set(e,[]),t.get(e)?.push(s)}return t},b={p:"pawn",n:"knight",b:"bishop",r:"rook",q:"queen",k:"king"};return s.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-2xl mx-auto",children:[s.jsxs("div",{className:"w-full flex items-center justify-between",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[d.gameOver?s.jsx("div",{className:"text-lg font-bold",children:d.winner?s.jsx("span",{className:d.winner===("white"===g?"white":"black")?"text-green-400":"text-red-400",children:d.winner===(x===d.players.white?"white":"black")?h({en:"You Won!",vi:"Bạn thắng!"}):h({en:"Opponent Won!",vi:"Đối thủ thắng!"})}):s.jsx("span",{className:"text-yellow-400",children:h({en:"Draw!",vi:"Hòa!"})})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-lg font-bold "+(v?"text-primary-400":"text-slate-400"),children:h(v?{en:"Your Turn",vi:"Lượt của bạn"}:{en:"Opponent's Turn",vi:"Lượt đối thủ"})}),w&&d.turn===("white"===g?"w":"b")&&s.jsx("div",{className:"text-sm text-red-400 font-semibold",children:h({en:"You are in check!",vi:"Bạn bị chiếu!"})})]}),s.jsxs("div",{className:"text-xs text-slate-500",children:[h({en:"Playing as",vi:"Đang chơi với quân"})," ",h("white"===g?{en:"White",vi:"Trắng"}:{en:"Black",vi:"Đen"})]})]}),s.jsxs("div",{className:"flex gap-2",children:[!d.gameOver&&!d.pendingNewGameRequest&&s.jsxs("button",{onClick:()=>c.requestReset(),className:"px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),h({en:"New Game",vi:"Ván mới"})]}),d.gameOver&&s.jsxs("button",{onClick:()=>c.requestReset(),className:"px-3 py-2 bg-primary-600 hover:bg-primary-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),h({en:"Play Again",vi:"Chơi lại"})]}),!d.gameOver&&!d.players.black&&c.isHostUser&&s.jsxs("button",{onClick:()=>c.addBot(),disabled:d.isBotLoading,className:"px-3 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2 "+(d.isBotLoading?"opacity-50 cursor-not-allowed":""),children:[d.isBotLoading?s.jsx("span",{className:"w-4 h-4 border-2 border-white/20 border-t-white rounded-full animate-spin"}):s.jsx(i,{className:"w-4 h-4"}),d.isBotLoading?h({en:"Loading Bot...",vi:"Đang tải Bot..."}):h({en:"Play vs Bot",vi:"Chơi với Bot"})]})]}),d.pendingNewGameRequest&&d.pendingNewGameRequest!==x&&s.jsxs("div",{className:"flex flex-col gap-2 bg-slate-800 p-2 rounded-lg border border-slate-700 absolute top-20 left-1/2 -translate-x-1/2 z-10 shadow-xl",children:[s.jsx("div",{className:"text-sm text-white font-medium whitespace-nowrap",children:h({en:"Opponent wants New Game",vi:"Đối thủ muốn chơi ván mới"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>c.handleAction({action:{type:"NEW_GAME_RESPONSE",accepted:!0}}),className:"flex-1 bg-green-600 hover:bg-green-500 text-xs py-1 px-2 rounded text-white",children:h({en:"Accept",vi:"Đồng ý"})}),s.jsx("button",{onClick:()=>c.handleAction({action:{type:"NEW_GAME_RESPONSE",accepted:!1}}),className:"flex-1 bg-red-600 hover:bg-red-500 text-xs py-1 px-2 rounded text-white",children:h({en:"Decline",vi:"Từ chối"})})]})]}),d.pendingNewGameRequest&&d.pendingNewGameRequest===x&&s.jsx("div",{className:"text-sm text-yellow-400 animate-pulse flex items-center",children:h({en:"Requesting New Game...",vi:"Đang yêu cầu ván mới..."})})]}),s.jsx("div",{className:"w-full max-w-xl",children:s.jsx("div",{ref:u,className:"w-full aspect-square rounded-lg overflow-hidden",style:{maxHeight:"min(80vh, 600px)"}})}),s.jsxs("div",{className:"w-full flex justify-between gap-4 text-sm",children:[s.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[s.jsxs("div",{className:"text-xs text-slate-400 mb-1",children:[h({en:"White captured:",vi:"Trắng bắt:"})," "]}),s.jsx("div",{className:"flex flex-wrap gap-1",children:d.capturedPieces.white.map((e,t)=>s.jsx("div",{className:`cg-icon ${b[e.toLowerCase()]} black`,style:{width:20,height:20,display:"inline-block",backgroundSize:"contain"}},t))})]}),s.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[s.jsx("div",{className:"text-xs text-slate-400 mb-1",children:h({en:"Black captured:",vi:"Đen bắt:"})}),s.jsx("div",{className:"flex flex-wrap gap-1",children:d.capturedPieces.black.map((e,t)=>s.jsx("div",{className:`cg-icon ${b[e.toLowerCase()]} white`,style:{width:20,height:20,display:"inline-block",backgroundSize:"contain"}},t))})]})]})]})}export{o as default};
