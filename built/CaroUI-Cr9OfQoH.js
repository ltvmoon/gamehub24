import{a as e,b as t,u as s,S as n,j as i}from"./index-C2uk-7Ac.js";import{b as l,c as a,X as o,h as r,ao as c,x as h,ap as d,aq as x,ar as m,as as u}from"./react-vendor-oAIxreiG.js";import"./BaseGame-C5gQy5jq.js";import{u as g}from"./useGameState-DOEQEi4j.js";import{u as p}from"./usePrevious-Cu35J0pC.js";import"./socket-DRbsQkF5.js";import"./zustand-BCVlJ__8.js";const v=50,f=40;function b({game:b}){const w=b,[j]=g(w),{userId:y}=e(),{confirm:N}=t(),{ti:k,ts:M}=s(),[T,C]=l.useState(!1),{board:O,winningLine:X,pendingUndoRequest:S}=j,Y=w.getPlayerSymbol(),P=j.currentTurn===Y;p(j.currentTurn,(e,t)=>{"playing"!==j.gamePhase||j.gameOver||null!==e&&n.playTurnSwitch(P)});const R=l.useRef(null),B=l.useRef(null),[q,G]=l.useState({x:20,y:20}),[L,W]=l.useState(!1),[$,H]=l.useState({x:0,y:0,viewportX:0,viewportY:0}),[z,A]=l.useState(null),[D,U]=l.useState({width:600,height:600}),E=()=>{const e=j.history;if(0===e.length)return null;const t=e[e.length-1],[s,n]=t.split(",").map(Number);return{row:s,col:n}};l.useEffect(()=>{const e=()=>{if(B.current){const e=B.current.clientWidth,t=window.innerHeight-200,s=Math.min(e,t,600);U({width:s,height:s})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),l.useEffect(()=>{const e=R.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.clearRect(0,0,D.width,D.height);const s=f,n=Math.ceil(D.width/s),i=Math.ceil(D.height/s),l=-q.x*s%s,a=-q.y*s%s,o=Math.floor(q.x),r=Math.floor(q.y);t.strokeStyle="#334155",t.lineWidth=1;for(let c=0;c<=n+1;c++){const e=l+c*s;t.beginPath(),t.moveTo(e,0),t.lineTo(e,D.height),t.stroke()}for(let c=0;c<=i+1;c++){const e=a+c*s;t.beginPath(),t.moveTo(0,e),t.lineTo(D.width,e),t.stroke()}if(z&&P&&!j.gameOver){const e=z.col-o,c=z.row-r;e>=0&&e<n&&c>=0&&c<i&&(t.fillStyle="rgba(148, 163, 184, 0.2)",t.fillRect(l+e*s,a+c*s,s,s))}for(let c=0;c<n+1;c++)for(let e=0;e<i+1;e++){const n=o+c,i=r+e;if(n<0||n>=v||i<0||i>=v)continue;const h=O[`${i},${n}`];if(!h)continue;const d=l+c*s+20,x=a+e*s+20,m=X?.some(([e,t])=>e===i&&t===n),u=E(),g=u&&u.row===i&&u.col===n;if(g&&!m&&(t.fillStyle="rgba(251, 191, 36, 0.25)",t.fillRect(l+c*s,a+e*s,s,s)),"X"===h){t.strokeStyle=m?"#4ade80":"#3b82f6",t.lineWidth=g?4:3;const e=12;t.beginPath(),t.moveTo(d-e,x-e),t.lineTo(d+e,x+e),t.stroke(),t.beginPath(),t.moveTo(d+e,x-e),t.lineTo(d-e,x+e),t.stroke()}else{t.strokeStyle=m?"#4ade80":"#ef4444",t.lineWidth=g?4:3;const e=10;t.beginPath(),t.arc(d,x,e,0,2*Math.PI),t.stroke()}}t.fillStyle="#64748b",t.font="10px monospace",t.fillText(`(${o}, ${r})`,5,15)},[q,O,X,z,P,j.gameOver,D]);const F=(e,t)=>{const s=R.current;if(!s)return null;const n=s.getBoundingClientRect(),i=e-n.left,l=t-n.top,a=Math.floor(q.x+i/40),o=Math.floor(q.y+l/40);return a<0||a>=v||o<0||o>=v?null:{row:o,col:a}};return i.jsxs("div",{className:"flex flex-col gap-3 p-2 @md:p-4 w-full pb-16!",children:[i.jsx("div",{className:"flex flex-col gap-2 p-3 bg-slate-800 rounded-lg w-full max-w-[400px] mx-auto",children:["X","O"].map(e=>{const t=j.players[e],s=j.currentTurn===e&&!j.gameOver,n=e===Y,l=t?.isBot,a=l?"Bot":t?.username;return i.jsxs("div",{className:`\n                flex items-center justify-between p-2 rounded-lg\n                ${s?"bg-slate-600 ring-2 ring-blue-400":"bg-slate-700"}\n              `,children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:"X"===e?i.jsx(o,{className:"w-5 h-5 text-blue-400",strokeWidth:2.5}):i.jsx(r,{className:"w-5 h-5 text-red-400",strokeWidth:2.5})}),i.jsxs("span",{className:"text-white",children:[a||k({en:"(waiting...)",vi:"(ƒëang ch·ªù...)"}),l&&" ü§ñ",n&&t&&k({en:" (You)",vi:" (B·∫°n)"})]})]}),l&&w.isHost&&!j.gameOver&&"playing"!==j.gamePhase&&i.jsx("button",{onClick:()=>w.removeBot(),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:k({en:"Remove",vi:"X√≥a"})}),!t&&w.isHost&&!j.gameOver&&"O"===e&&i.jsxs("button",{onClick:()=>w.addBot(),className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors flex items-center gap-1",children:[i.jsx(c,{className:"w-3 h-3"})," ",k({en:"Add Bot",vi:"Th√™m Bot"})]})]},e)})}),"waiting"===j.gamePhase&&w.isHost&&i.jsx("div",{className:"flex flex-col items-center gap-2",children:w.canStartGame()?i.jsxs("button",{onClick:()=>w.startGame(),className:"px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[i.jsx(h,{className:"w-4 h-4"}),k({en:"Start Game",vi:"B·∫Øt ƒë·∫ßu"})]}):i.jsx("span",{className:"text-sm text-slate-400",children:k({en:"Waiting for opponent to join...",vi:"ƒêang ch·ªù ƒë·ªëi th·ªß tham gia..."})})}),"playing"===j.gamePhase&&w.isHost&&i.jsx("div",{className:"flex flex-col items-center gap-2",children:i.jsxs("button",{onClick:async()=>{(j.gameOver||await N(M({en:"Are you sure you want to reset the game?",vi:"B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ch∆°i l·∫°i?"}),M({en:"Reset Game",vi:"Ch∆°i l·∫°i"})))&&w.reset()},className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[i.jsx(d,{className:"w-4 h-4"}),k({en:"Reset Game",vi:"Ch∆°i l·∫°i"})]})}),"waiting"===j.gamePhase&&!w.isHost&&i.jsx("div",{className:"text-sm text-slate-400",children:k({en:"Waiting for host to start the game...",vi:"ƒêang ch·ªù ch·ªß ph√≤ng b·∫Øt ƒë·∫ßu..."})}),"playing"===j.gamePhase&&i.jsxs("div",{className:"flex flex-col items-center justify-between",children:[i.jsx("div",{className:"text-md font-semibold",children:j.gameOver?j.winner?i.jsx("span",{className:j.winner===Y?"text-green-400":"text-red-400",children:j.winner===Y?k({en:"You Won!",vi:"B·∫°n th·∫Øng!"}):k({en:"Opponent Won!",vi:"ƒê·ªëi th·ªß th·∫Øng!"})}):i.jsx("span",{className:"text-yellow-400",children:k({en:"Draw!",vi:"H√≤a!"})}):i.jsx("span",{className:P?"text-primary-400":"text-slate-400",children:k(P?{en:"Your Turn",vi:"L∆∞·ª£t c·ªßa b·∫°n"}:{en:"Opponent's Turn",vi:"L∆∞·ª£t ƒë·ªëi th·ªß"})})}),i.jsxs("div",{className:"flex gap-1 @md:gap-2 text-xs",children:[!j.gameOver&&Object.keys(O).length>0?i.jsxs("button",{onClick:()=>{const e=E();if(!e)return;const t=D.width/f,s=D.height/f,n=Math.max(0,e.col-t/2+.5),i=Math.max(0,e.row-s/2+.5),l=q.x,a=q.y,o=performance.now(),r=e=>{const t=e-o,s=Math.min(t/300,1),c=1-Math.pow(1-s,3);G({x:l+(n-l)*c,y:a+(i-a)*c}),s<1&&requestAnimationFrame(r)};requestAnimationFrame(r)},disabled:0===Object.keys(O).length,className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",title:k({en:"Focus to last move",vi:"Xem n∆∞·ªõc ƒëi cu·ªëi"}),children:[i.jsx(x,{className:"w-3 h-3"}),i.jsx("span",{children:k({en:"Last",vi:"Cu·ªëi"})})]}):null,!j.gameOver&&Object.keys(O).length>0&&!P&&!S&&i.jsxs("button",{onClick:()=>w.requestUndo(),className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1",title:k({en:"Request undo from opponent",vi:"Y√™u c·∫ßu ƒë·ªëi th·ªß ho√†n t√°c"}),children:[i.jsx(m,{className:"w-3 h-3"}),i.jsx("span",{children:k({en:"Undo",vi:"Ho√†n t√°c"})})]}),!j.gameOver&&0===Object.keys(O).length&&P&&i.jsxs("button",{onClick:()=>w.switchTurn(),className:"px-2 py-1 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 flex items-center gap-1",title:k({en:"Give first move to opponent",vi:"Nh∆∞·ªùng n∆∞·ªõc ƒëi ƒë·∫ßu cho ƒë·ªëi th·ªß"}),children:[i.jsx(d,{className:"w-3 h-3"}),i.jsx("span",{children:k({en:"Give First Move",vi:"Nh∆∞·ªùng ƒëi tr∆∞·ªõc"})})]})]})]}),S&&i.jsxs("div",{className:"px-3 py-2 bg-slate-800/50 rounded-lg border border-slate-700",children:[S===y&&i.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-amber-400",children:[i.jsx(m,{className:"w-4 h-4 animate-pulse"}),i.jsx("span",{children:k({en:"Waiting for opponent to respond to undo request...",vi:"ƒêang ch·ªù ƒë·ªëi th·ªß ph·∫£n h·ªìi y√™u c·∫ßu ho√†n t√°c..."})})]}),S!==y&&i.jsxs("div",{className:"flex items-center justify-between gap-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-300",children:[i.jsx(m,{className:"w-4 h-4 text-amber-400"}),i.jsx("span",{children:k({en:"Opponent is requesting to undo their last move",vi:"ƒê·ªëi th·ªß y√™u c·∫ßu ho√†n t√°c n∆∞·ªõc ƒëi cu·ªëi"})})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>w.responseUndo(!0),className:"px-3 py-1.5 bg-green-600 hover:bg-green-500 rounded text-white text-sm font-medium flex items-center gap-1.5",title:k({en:"Allow undo",vi:"Cho ph√©p ho√†n t√°c"}),children:i.jsx("span",{children:k({en:"Allow",vi:"ƒê·ªìng √Ω"})})}),i.jsx("button",{onClick:()=>w.responseUndo(!1),className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 rounded text-white text-sm font-medium flex items-center gap-1.5",title:k({en:"Deny undo",vi:"T·ª´ ch·ªëi ho√†n t√°c"}),children:i.jsx("span",{children:k({en:"Deny",vi:"T·ª´ ch·ªëi"})})})]})]})]}),i.jsx("div",{ref:B,className:"w-full flex items-center justify-center",children:i.jsx("canvas",{ref:R,width:D.width,height:D.height,style:{width:D.width,height:D.height},className:"border-2 border-slate-700 rounded-lg bg-slate-900 cursor-move touch-none",onMouseDown:e=>{W(!0),H({x:e.clientX,y:e.clientY,viewportX:q.x,viewportY:q.y})},onMouseMove:e=>{const t=F(e.clientX,e.clientY);if(A(t),L){const t=($.x-e.clientX)/f,s=($.y-e.clientY)/f;G({x:Math.max(0,Math.min(49,$.viewportX+t)),y:Math.max(0,Math.min(49,$.viewportY+s))})}},onMouseUp:()=>{W(!1)},onMouseLeave:()=>{W(!1),A(null)},onClick:e=>{if(Math.abs(e.clientX-$.x)>5||Math.abs(e.clientY-$.y)>5)return;if(!P||j.gameOver)return;const t=F(e.clientX,e.clientY);if(!t)return;const s=`${t.row},${t.col}`;O[s]||w.requestMove(t.row,t.col)},onTouchStart:e=>{const t=e.touches[0];W(!0),H({x:t.clientX,y:t.clientY,viewportX:q.x,viewportY:q.y})},onTouchMove:e=>{const t=e.touches[0],s=F(t.clientX,t.clientY);if(A(s),L){const e=($.x-t.clientX)/f,s=($.y-t.clientY)/f;G({x:Math.max(0,Math.min(49,$.viewportX+e)),y:Math.max(0,Math.min(49,$.viewportY+s))})}},onTouchEnd:e=>{const t=e.changedTouches[0];if(Math.abs(t.clientX-$.x)>5||Math.abs(t.clientY-$.y)>5)return W(!1),void A(null);if(W(!1),A(null),!P||j.gameOver)return;const s=F(t.clientX,t.clientY);if(!s)return;const n=`${s.row},${s.col}`;O[n]||w.requestMove(s.row,s.col)}})}),i.jsx("div",{className:"text-xs text-slate-500 text-center",children:k({en:"Drag to pan ‚Ä¢ Click to place",vi:"K√©o ƒë·ªÉ di chuy·ªÉn ‚Ä¢ Nh·∫•p ƒë·ªÉ ƒë·∫∑t qu√¢n"})}),i.jsx("button",{onClick:()=>C(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-500 transition-colors z-40 shadow-lg border border-slate-500",title:M({en:"Rules",vi:"Lu·∫≠t ch∆°i"}),children:i.jsx(u,{size:24})}),T&&a.createPortal(i.jsx("div",{className:"fixed inset-0 bg-black/80 glass-blur z-100 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full shadow-2xl relative",children:[i.jsxs("div",{className:"flex justify-between p-4 pr-2",children:[i.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[i.jsx(u,{className:"w-6 h-6 text-yellow-500"}),k({en:"Game Rules: Caro (Gomoku)",vi:"Lu·∫≠t Ch∆°i: C·ªù Caro"})]}),i.jsx("button",{onClick:()=>C(!1),className:"p-2 hover:bg-white/10 rounded-full transition-colors text-slate-400 hover:text-white",children:i.jsx(o,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"p-4 space-y-4 text-slate-300 leading-relaxed max-h-[80vh] overflow-y-auto",children:i.jsxs("div",{className:"space-y-4 text-slate-300 leading-relaxed",children:[i.jsxs("section",{children:[i.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:k({en:"Objective",vi:"M·ª•c ti√™u"})}),i.jsx("p",{children:k({en:"Be the first player to get 5 of your marks in a row (horizontally, vertically, or diagonally).",vi:"L√† ng∆∞·ªùi ƒë·∫ßu ti√™n t·∫°o ƒë∆∞·ª£c 5 d·∫•u li√™n ti·∫øp (ngang, d·ªçc ho·∫∑c ch√©o)."})})]}),i.jsxs("section",{children:[i.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:k({en:"Rules",vi:"Quy T·∫Øc"})}),i.jsxs("ul",{className:"list-disc pl-4",children:[i.jsx("li",{children:k({en:"Players take turns placing their mark (X or O) on an empty square.",vi:"Ng∆∞·ªùi ch∆°i l·∫ßn l∆∞·ª£t ƒë·∫∑t d·∫•u (X ho·∫∑c O) v√†o m·ªôt √¥ tr·ªëng."})}),i.jsx("li",{children:k({en:"The game is played on an infinite board (expandable).",vi:"Tr√≤ ch∆°i di·ªÖn ra tr√™n b√†n c·ªù v√¥ t·∫≠n (c√≥ th·ªÉ m·ªü r·ªông)."})}),i.jsx("li",{children:k({en:"The game ends when one player gets 5 in a row.",vi:"Tr√≤ ch∆°i k·∫øt th√∫c khi c√≥ ng∆∞·ªùi ch∆°i ƒë·∫°t 5 d·∫•u li√™n ti·∫øp."})})]})]}),i.jsxs("section",{children:[i.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:k({en:"Controls",vi:"ƒêi·ªÅu Khi·ªÉn"})}),i.jsxs("ul",{className:"list-disc pl-4",children:[i.jsx("li",{children:k({en:"Click/Tap to place a mark.",vi:"Click/Ch·∫°m ƒë·ªÉ ƒë·∫∑t d·∫•u."})}),i.jsx("li",{children:k({en:"Drag to pan the board.",vi:"K√©o ƒë·ªÉ di chuy·ªÉn b√†n c·ªù."})})]})]})]})})]})}),document.body)]})}export{b as default};
