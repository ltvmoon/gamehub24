import{u as e,a as t,j as s}from"./index-Dgl20RHv.js";import{l as n,a3 as a,a4 as r,a5 as i,a7 as l}from"./react-vendor-DqvDgvkG.js";import"./socket-DRbsQkF5.js";import{e as o,B as c,T as u,a as d,P as h,b as m}from"./types-BE9t39eT.js";import"./zustand-DHxpPrWm.js";function x({game:x}){const g=x,[f,p]=n.useState(g.getState()),{username:v}=e(),{ti:b}=t(),y=n.useRef(null),w=n.useRef(null),j=n.useRef(g.getState().balls),N=n.useRef([]),S=n.useRef(new Set),[P,k]=n.useState(!1),[M,B]=n.useState(0),[T,C]=n.useState(0),[R,E]=n.useState(null),[L,A]=n.useState(1),I=g.isMyTurn(),Y=n.useRef(()=>{}),W=n.useRef(!1);W.current=P;const F=n.useRef(0);F.current=M;const X=n.useRef(0);X.current=T,n.useEffect(()=>{const e=()=>{if(w.current){const e=w.current.clientWidth-16,t=Math.min(1,e/u);A(t)}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const D=n.useRef({isAiming:P,aimAngle:M,aimPower:T,mousePos:R});D.current={isAiming:P,aimAngle:M,aimPower:T,mousePos:R};const U=n.useRef(L);U.current=L;const q=n.useCallback((e,t,s)=>{const n=o[t.id]||"#FFF";s&&(e.save(),e.shadowColor=s,e.shadowBlur=15,e.fillStyle=s,e.globalAlpha=.6,e.beginPath(),e.arc(t.x,t.y,c+4,0,2*Math.PI),e.fill(),e.restore()),e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.arc(t.x+2,t.y+2,c,0,2*Math.PI),e.fill(),e.fillStyle=n,e.beginPath(),e.arc(t.x,t.y,c,0,2*Math.PI),e.fill(),t.id>=9&&t.id<=15&&(e.fillStyle="white",e.beginPath(),e.arc(t.x,t.y,.7*c,0,2*Math.PI),e.fill()),0!==t.id&&(e.fillStyle=t.id>=9&&t.id<=15?"black":"white",e.font=`bold ${c}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.id.toString(),t.x,t.y)),e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.arc(t.x-.3*c,t.y-.3*c,.3*c,0,2*Math.PI),e.fill()},[]),G=n.useCallback(()=>{const e=y.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const s=U.current,{isAiming:n,aimAngle:a,aimPower:r}=D.current;e.width=u*s,e.height=d*s,t.save(),t.scale(s,s),t.fillStyle="#1a472a",t.fillRect(0,0,u,d),t.strokeStyle="#5d3a1a",t.lineWidth=20,t.strokeRect(10,10,u-20,d-20),t.fillStyle="#111";for(const c of h)t.beginPath(),t.arc(c.x,c.y,m,0,2*Math.PI),t.fill();const i=g.getState(),l=g.getMySlot(),o=l===i.currentTurn&&"playing"===i.gamePhase&&!i.isSimulating,x=l?i.players[l].ballType:null,f=x&&0===j.current.filter(e=>!e.pocketed&&e.type===x).length;for(const c of j.current){if(c.pocketed)continue;let e;o&&(0===c.id?e="#00ff88":x&&(f&&8===c.id?e="#ffcc00":c.type===x&&(e="#00aaff"))),q(t,c,e)}const p=j.current.find(e=>0===e.id&&!e.pocketed);if(n&&p&&r>0){const e=p.x+Math.cos(a)*r*150,s=p.y+Math.sin(a)*r*150,n=t.createLinearGradient(p.x,p.y,e,s);n.addColorStop(0,"rgba(255, 255, 255, 0.8)"),n.addColorStop(1,"rgba(255, 100, 100, 0.8)"),t.strokeStyle=n,t.lineWidth=3,t.setLineDash([10,5]),t.beginPath(),t.moveTo(p.x,p.y),t.lineTo(e,s),t.stroke(),t.setLineDash([]);const i=200,l=c+5+50*r,o=p.x-Math.cos(a)*l,u=p.y-Math.sin(a)*l,d=o-Math.cos(a)*i,h=u-Math.sin(a)*i;t.strokeStyle="#8B4513",t.lineWidth=6,t.lineCap="round",t.beginPath(),t.moveTo(o,u),t.lineTo(d,h),t.stroke(),t.fillStyle="#E6D5B8",t.beginPath(),t.arc(o,u,4,0,2*Math.PI),t.fill()}const v=performance.now(),b=[];for(const c of N.current){const e=(v-c.startTime)/c.duration;if(e<1){b.push(c);for(let s=0;s<3;s++){const n=Math.max(0,e-.15*s);if(n>0&&n<1){const e=m+40*n,s=.6*(1-n);t.strokeStyle=c.color,t.globalAlpha=s,t.lineWidth=3-2*n,t.beginPath(),t.arc(c.x,c.y,e,0,2*Math.PI),t.stroke()}}t.globalAlpha=1}}N.current=b,t.restore()},[q]);Y.current=G,n.useEffect(()=>{G()},[G,f,P,M,T,L]),n.useEffect(()=>{g.onUpdate(e=>{p(e),j.current=e.balls,Y.current()}),g.onFrame(e=>{const t=new Set(e.filter(e=>e.pocketed).map(e=>e.id));for(const s of e)if(s.pocketed&&!S.current.has(s.id))for(const e of h){const t=s.x-e.x,n=s.y-e.y;if(Math.sqrt(t*t+n*n)<2*m){const t=o[s.id]||"#FFF";N.current.push({x:e.x,y:e.y,color:t,startTime:performance.now(),duration:2e3});break}}S.current=t,j.current=e,Y.current()})},[g]);const H=n.useCallback((e,t)=>{const s=y.current;if(!s)return null;const n=s.getBoundingClientRect();return{x:(e-n.left)/L,y:(t-n.top)/L}},[L]),z=e=>{if(!I||f.isSimulating)return;const t=j.current.find(e=>0===e.id&&!e.pocketed);if(!t)return;const s="touches"in e?e.touches[0].clientX:e.clientX,n="touches"in e?e.touches[0].clientY:e.clientY,a=H(s,n);if(!a)return;const r=a.x-t.x,i=a.y-t.y;Math.sqrt(r*r+i*i)<5*c&&(e.preventDefault(),k(!0),E(a))},O=n.useCallback((e,t)=>{const s=j.current.find(e=>0===e.id&&!e.pocketed);if(!s)return;const n=H(e,t);if(!n)return;E(n);const a=Math.atan2(n.y-s.y,n.x-s.x)+Math.PI;B(a);const r=n.x-s.x,i=n.y-s.y,l=Math.sqrt(r*r+i*i),o=Math.min(1,l/200);C(o)},[H]),$=e=>{if(!P)return;e.preventDefault();const t="touches"in e?e.touches[0].clientX:e.clientX,s="touches"in e?e.touches[0].clientY:e.clientY;O(t,s)},V=n.useCallback(()=>{X.current>.05&&g.shoot(F.current,X.current),k(!1),C(0),E(null)},[g]);n.useEffect(()=>{const e=e=>{W.current&&O(e.clientX,e.clientY)},t=()=>{W.current&&V()},s=e=>{W.current&&e.touches.length>0&&O(e.touches[0].clientX,e.touches[0].clientY)},n=()=>{W.current&&V()};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("touchend",n),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",n)}},[O,V]);const J=e=>{const t=f.players[e];return t.id?"BOT"===t.id?"Bot ü§ñ":t.id===g.userId?v||b({en:"You",vi:"B·∫°n"}):t.username||b({en:"Player",vi:"Ng∆∞·ªùi ch∆°i"})+" "+e:b({en:"(waiting...)",vi:"(ƒëang ch·ªù...)"})},K=e=>{const t=f.players[e].ballType;return t?b("solid"===t?{en:"(Solids 1-7)",vi:"(Tr∆°n 1-7)"}:{en:"(Stripes 9-15)",vi:"(S·ªçc 9-15)"}):""};return s.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-4xl mx-auto",ref:w,children:[s.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-slate-800 rounded-lg w-full max-w-[500px]",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-1",children:"Players"}),[1,2].map(e=>{const t=f.players[e],n=f.currentTurn===e&&"playing"===f.gamePhase,r=t.id===g.userId,i="BOT"===t.id;return s.jsxs("div",{className:`\n                flex items-center justify-between p-3 rounded-lg\n                ${n?"bg-slate-600 ring-2 ring-blue-400":"bg-slate-700"}\n              `,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-6 h-6 rounded-full "+(1===e?"bg-blue-500":"bg-red-500")}),s.jsxs("div",{children:[s.jsxs("span",{className:"text-white font-medium",children:[J(e),r&&t.id&&b({en:" (You)",vi:" (B·∫°n)"})]}),s.jsx("span",{className:"text-gray-400 text-sm ml-2",children:K(e)})]})]}),i&&g.isHostUser&&"waiting"===f.gamePhase&&s.jsx("button",{onClick:()=>g.removeBot(),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:b({en:"Remove",vi:"X√≥a"})}),!t.id&&g.isHostUser&&2===e&&"waiting"===f.gamePhase&&s.jsxs("button",{onClick:()=>g.addBot(),className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors flex items-center gap-1",children:[s.jsx(a,{className:"w-3 h-3"})," ",b({en:"Add Bot",vi:"Th√™m Bot"})]})]},e)})]}),"waiting"===f.gamePhase&&g.isHostUser&&s.jsx("div",{className:"flex flex-col items-center gap-2",children:g.canStartGame()?s.jsxs("button",{onClick:()=>g.startGame(),className:"px-6 py-3 bg-green-600 hover:bg-green-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[s.jsx(r,{className:"w-5 h-5"}),b({en:"Start Game",vi:"B·∫Øt ƒë·∫ßu"})]}):s.jsx("span",{className:"text-sm text-slate-400",children:b({en:"Waiting for opponent to join...",vi:"ƒêang ch·ªù ƒë·ªëi th·ªß tham gia..."})})}),"playing"===f.gamePhase&&g.isHostUser&&!f.isSimulating&&s.jsxs("button",{onClick:()=>g.requestReset(),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-300 text-sm font-medium transition-colors flex items-center gap-2",children:[s.jsx(i,{className:"w-4 h-4"}),b({en:"New Game",vi:"V√°n m·ªõi"})]}),"waiting"===f.gamePhase&&!g.isHostUser&&s.jsx("div",{className:"text-sm text-slate-400",children:b({en:"Waiting for host to start the game...",vi:"ƒêang ch·ªù ch·ªß ph√≤ng b·∫Øt ƒë·∫ßu..."})}),"playing"===f.gamePhase&&!f.winner&&s.jsx("div",{className:"text-lg text-gray-400",children:f.isSimulating?s.jsx("span",{className:"text-yellow-400",children:b({en:"Balls in motion...",vi:"B√≥ng ƒëang lƒÉn..."})}):I?s.jsxs("span",{className:"text-green-400 flex items-center gap-2",children:[s.jsx(l,{className:"w-5 h-5"}),b({en:"Your turn! Click near the cue ball and drag to aim.",vi:"L∆∞·ª£t c·ªßa b·∫°n! Nh·∫•p v√†o b√≥ng tr·∫Øng v√† k√©o ƒë·ªÉ ng·∫Øm."})]}):s.jsx("span",{children:b({en:"Waiting for opponent...",vi:"ƒêang ch·ªù ƒë·ªëi th·ªß..."})})}),f.turnMessage&&s.jsx("div",{className:"text-yellow-400 text-sm",children:f.turnMessage}),s.jsx("div",{className:"relative bg-slate-900 p-2 rounded-xl shadow-2xl overflow-hidden",children:s.jsx("canvas",{ref:y,width:u*L,height:d*L,className:"rounded-lg cursor-crosshair block",style:{touchAction:"none"},onMouseDown:z,onMouseMove:$,onTouchStart:z,onTouchMove:$})}),P&&s.jsxs("div",{className:"w-full max-w-xs",children:[s.jsxs("div",{className:"text-sm text-gray-400 mb-1",children:[b({en:"Power",vi:"L·ª±c"}),": ",Math.round(100*T),"%"]}),s.jsx("div",{className:"h-3 bg-slate-700 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full transition-all duration-75",style:{width:100*T+"%",background:"linear-gradient(90deg, #22c55e, #eab308, #ef4444)"}})})]}),f.winner&&s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-green-400 mb-4",children:["üèÜ ",J(f.winner)," ",b({en:"wins!",vi:"th·∫Øng!"})]}),s.jsxs("button",{onClick:()=>g.requestReset(),className:"px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors flex items-center gap-2 mx-auto",children:[s.jsx(i,{className:"w-5 h-5"}),b({en:"Play Again",vi:"Ch∆°i l·∫°i"})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2 justify-center text-xs text-gray-400",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"w-3 h-3 rounded-full bg-yellow-500"})," ",b({en:"Solids (1-7)",vi:"Tr∆°n (1-7)"})]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"w-3 h-3 rounded-full border-2 border-yellow-500 bg-white"})," ",b({en:"Stripes (9-15)",vi:"S·ªçc (9-15)"})]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"w-3 h-3 rounded-full bg-black border border-gray-600"})," ",b({en:"8-Ball",vi:"B√≥ng 8"})]})]})]})}export{x as default};
