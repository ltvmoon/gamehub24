import{B as t}from"./BaseGame-B3WT17lS.js";import"./socket-DRbsQkF5.js";import"./index-lqVnuPzo.js";import"./react-vendor-Do69iInB.js";import"./zustand-CCNgd6Y3.js";class e extends t{isGameOver(t){return t.gameOver}getInitState(){return{board:Array(9).fill(null),currentTurn:"X",winner:null,winningLine:null,isDraw:!1,players:{X:this.players[0],O:this.players[1]},gameOver:!1,lastMoveIndex:null,gamePhase:"waiting"}}onSocketGameAction(t){const e=t.action;if(this.isHost)switch(e.type){case"MAKE_MOVE":this.makeMove(e);break;case"RESET_GAME":this.reset();break;case"SWITCH_TURN":this.handleSwitchTurn();break;case"START_GAME":this.handleStartGame()}}makeMove(t){const{cellIndex:e,playerId:s}=t;if("playing"!==this.state.gamePhase)return;if(this.state.gameOver)return;if(null!==this.state.board[e])return;const a=this.getPlayerSymbolInternal(s);if(!a)return;if(a!==this.state.currentTurn)return;this.state.board[e]=a,this.state.lastMoveIndex=e;const i=this.checkGameEnd();i?(this.state.winner=i.winner||null,i.pattern&&(this.state.winningLine=i.pattern),this.state.isDraw=i.isDraw||!1,this.state.gameOver=!0,this.clearSavedState()):this.state.currentTurn="X"===this.state.currentTurn?"O":"X",this.checkBotTurn()}checkGameEnd(){const{board:t}=this.state,e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const s of e){const[e,a,i]=s;if(t[e]&&t[e]===t[a]&&t[e]===t[i])return{winner:t[e],pattern:s}}return t.every(t=>null!==t)?{isDraw:!0}:null}reset(){this.state.board=Array(9).fill(null),this.state.currentTurn="X",this.state.winner=null,this.state.winningLine=null,this.state.isDraw=!1,this.state.gameOver=!1,this.state.lastMoveIndex=null,this.state.gamePhase="waiting"}updatePlayers(t){this.state.players.X=t[0],t[1]?this.state.players.O=t[1]:this.state.players.O?.isBot||(this.state.players.O=null)}requestReset(){this.makeAction({type:"RESET_GAME"})}handleSwitchTurn(){this.state.gameOver||this.state.board.some(t=>null!==t)||(this.state.currentTurn="X"===this.state.currentTurn?"O":"X",this.checkBotTurn())}switchTurn(){this.makeAction({type:"SWITCH_TURN"})}addBot(){this.isHost&&"waiting"===this.state.gamePhase&&(this.state.players.O={id:"BOT",username:"Bot",isHost:!1,isBot:!0})}removeBot(){this.isHost&&"waiting"===this.state.gamePhase&&this.state.players.O?.isBot&&(this.state.players.O=null)}handleStartGame(){"waiting"===this.state.gamePhase&&this.state.players.X&&this.state.players.O&&(this.state.gamePhase="playing",this.checkBotTurn())}startGame(){this.makeAction({type:"START_GAME"})}canStartGame(){return!!this.state.players.X&&!!this.state.players.O&&"waiting"===this.state.gamePhase}checkBotTurn(){if(!this.isHost)return;const t="X"===this.state.currentTurn?this.state.players.X:this.state.players.O;t?.isBot&&!this.state.gameOver&&setTimeout(()=>this.makeBotMove(),600)}makeBotMove(){if(this.state.gameOver)return;const t=this.getBestMove();-1!==t&&this.makeMove({type:"MAKE_MOVE",cellIndex:t,playerId:"BOT"})}getBestMove(){const t=JSON.parse(JSON.stringify(this.state.board));let e=-1/0,s=-1;for(let a=0;a<9;a++)if(null===t[a]){t[a]="O";const i=this.minimax(t,0,!1,"O","X");t[a]=null,i>e&&(e=i,s=a)}return s}minimax(t,e,s,a,i){const r=this.checkWinInternal(t);if(r===a)return 10-e;if(r===i)return e-10;if("draw"===r)return 0;if(s){let s=-1/0;for(let r=0;r<9;r++)if(null===t[r]){t[r]=a;const n=this.minimax(t,e+1,!1,a,i);t[r]=null,s=Math.max(n,s)}return s}{let s=1/0;for(let r=0;r<9;r++)if(null===t[r]){t[r]=i;const n=this.minimax(t,e+1,!0,a,i);t[r]=null,s=Math.min(n,s)}return s}}checkWinInternal(t){const e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const s of e){const[e,a,i]=s;if(t[e]&&t[e]===t[a]&&t[e]===t[i])return t[e]}return t.every(t=>null!==t)?"draw":null}getPlayerSymbolInternal(t){return this.state.players.X?.id===t?"X":this.state.players.O?.id===t?"O":null}getPlayerSymbol(){return this.getPlayerSymbolInternal(this.userId)}}export{e as default};
