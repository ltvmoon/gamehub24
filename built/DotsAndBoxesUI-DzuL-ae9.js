import{a as e,j as s}from"./index-Dgl20RHv.js";import{l as t,a4 as a,p as l}from"./react-vendor-DqvDgvkG.js";import"./socket-DRbsQkF5.js";import"./zustand-DHxpPrWm.js";const r={red:"bg-red-500/60",blue:"bg-blue-500/60"},n={red:"text-red-500",blue:"text-blue-500"};function i({game:i,currentUserId:o}){const d=i,[c,x]=t.useState(d.getState()),{ti:m}=e();t.useEffect(()=>{d.onUpdate(x),x(d.getState()),d.requestSync()},[d]);const h=c.players[c.currentPlayerIndex],u=h?.id===o,g=c.isGameEnded,p=100/(c.gridSize-1);return s.jsxs("div",{className:"flex flex-col items-center gap-6 p-4 w-full max-w-2xl mx-auto",children:[s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("h2",{className:"text-3xl font-bold text-white",children:"Dots & Boxes"}),g||"playing"!==c.gamePhase?g?s.jsxs("div",{className:"text-2xl font-bold text-white mb-2",children:["Game Over!"," ","draw"===c.winner?m({en:"It's a Draw!",vi:"Hòa!"}):`${c.players.find(e=>e.id===c.winner)?.username} ${m({en:"Wins!",vi:"Thắng!"})}`]}):null:s.jsx("div",{className:"text-lg",children:u?s.jsx("span",{className:"text-green-400 font-bold animate-pulse",children:m({en:"Your Turn!",vi:"Lượt của bạn!"})}):s.jsxs("span",{className:"text-gray-300",children:[m({en:"Waiting for",vi:"Đang chờ"})," ",s.jsx("span",{className:`${n[h.color]} font-bold`,children:h.username}),"..."]})}),s.jsx("div",{className:"flex gap-4 md:gap-8 bg-slate-800 p-4 rounded-xl shadow-lg border border-slate-700 w-full justify-center",children:c.players.map((e,t)=>s.jsxs("div",{className:`flex flex-col items-center gap-2 p-2 rounded-lg transition-all ${c.currentPlayerIndex!==t||g?"border-2 border-transparent":"bg-slate-700 scale-105 shadow-md border-2 "+("red"===e.color?"border-red-500":"border-blue-500")} ${e.id?"":"opacity-60"}`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-3 rounded-full "+("red"===e.color?"bg-red-500":"bg-blue-500")}),s.jsx("div",{className:"text-sm font-bold "+("red"===e.color?"text-red-500":"text-blue-500"),children:e.id?e.username:m({en:"Empty",vi:"Trống"})})]}),e.id?s.jsx("div",{className:"flex flex-col items-center",children:s.jsx("div",{className:"text-3xl font-black "+("red"===e.color?"text-red-500":"text-blue-500"),children:e.score})}):s.jsx("div",{className:"h-9 flex items-center",children:s.jsx("span",{className:"text-gray-500 text-xs italic",children:m({en:"Waiting...",vi:"Đang chờ..."})})}),d.isHostUser&&!g&&c.boxes.every(e=>e.every(e=>null===e))&&s.jsx("div",{className:"mt-1",children:e.isBot?s.jsx("button",{onClick:()=>d.requestRemoveBot(t),className:"text-xs bg-red-900 hover:bg-red-800 text-red-100 px-2 py-1 rounded",children:m({en:"Remove Bot",vi:"Xóa Bot"})}):!e.id&&s.jsx("button",{onClick:()=>d.requestAddBot(t),className:"text-xs bg-cyan-900 hover:bg-cyan-800 text-cyan-100 px-2 py-1 rounded",children:m({en:"+ Add Bot",vi:"+ Thêm Bot"})})})]},`player-${t}`))})]}),s.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[!g&&"waiting"===c.gamePhase&&d.isHostUser&&s.jsxs("button",{onClick:()=>d.requestStartGame(),disabled:!d.canStartGame(),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(a,{className:"w-4 h-4"})," ",m({en:"Start Game",vi:"Bắt đầu"})]}),d.isHostUser&&"waiting"!==c.gamePhase&&s.jsxs("button",{onClick:()=>d.requestNewGame(),className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[s.jsx(l,{className:"w-4 h-4"})," ",m(g?{en:"Play Again",vi:"Chơi lại"}:{en:"New Game",vi:"Ván mới"})]}),"playing"===c.gamePhase&&!g&&s.jsx("button",{onClick:()=>d.requestUndo(),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg",children:m({en:"Undo",vi:"Hoàn tác"})})]}),c.undoRequest&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg shadow-xl border border-slate-600 flex flex-col gap-3",children:[s.jsxs("p",{className:"text-white",children:[c.players.find(e=>e.id===c.undoRequest?.requesterId)?.username," ",m({en:"requested to undo the last move.",vi:"muốn hoàn tác nước đi vừa rồi."})]}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx("button",{onClick:()=>d.rejectUndo(),className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded",children:m({en:"Reject",vi:"Từ chối"})}),s.jsx("button",{onClick:()=>d.approveUndo(),className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white rounded",children:m({en:"Approve",vi:"Đồng ý"})})]})]})}),s.jsx("div",{className:"relative aspect-square w-full max-w-[400px] bg-slate-900 p-6 rounded-lg shadow-2xl select-none touch-none border-2 border-slate-700",children:s.jsxs("div",{className:"relative w-full h-full",children:[c.boxes.map((e,t)=>e.map((e,a)=>{const l=c.players.find(s=>s.id===e);return l?s.jsx("div",{className:`absolute flex items-center justify-center rounded-sm transition-all duration-500 scale-90 ${r[l.color]}`,style:{top:t*p+"%",left:a*p+"%",width:`${p}%`,height:`${p}%`},children:s.jsx("div",{className:`text-2xl font-bold ${n[l.color]}`,children:l.username[0].toUpperCase()})},`box-${t}-${a}`):null})),["horizontal","vertical"].map(e=>("horizontal"===e?c.horizontalLines:c.verticalLines).map((t,a)=>t.map((t,l)=>{const r=c.lastLine?.type===e&&c.lastLine.row===a&&c.lastLine.col===l,n="horizontal"===e;return s.jsx("div",{onClick:()=>{return s=e,t=a,r=l,void(u&&!g&&"playing"===c.gamePhase&&("horizontal"===s&&c.horizontalLines[t][r]||"vertical"===s&&c.verticalLines[t][r]||d.requestPlaceLine(s,t,r)));var s,t,r},className:`absolute cursor-pointer transition-all duration-200 rounded-full z-10\n                      ${n?"h-2 -translate-y-1/2":"w-2 -translate-x-1/2"}\n                      ${t?r?"bg-yellow-400 shadow-[0_0_12px_4px_rgba(250,204,21,0.7)] animate-pulse":"bg-white shadow-[0_0_8px_2px_rgba(255,255,255,0.4)]":"playing"===c.gamePhase?"bg-slate-700 hover:bg-slate-400":"bg-slate-800 cursor-default"}`,style:{top:a*p+"%",left:l*p+"%",...n?{width:`${p}%`}:{height:`${p}%`}},children:!t&&"playing"===c.gamePhase&&s.jsx("div",{className:"absolute inset-0 "+(n?"-top-2 -bottom-2":"-left-2 -right-2")})},`${e[0]}-${a}-${l}`)})))]})})]})}export{i as default};
