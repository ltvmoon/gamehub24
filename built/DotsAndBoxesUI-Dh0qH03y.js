import{u as e,S as t,j as s}from"./index-7ewwbQld.js";import{b as l,c as a,ab as n,u as i,aM as r,X as o}from"./react-vendor-BLBa7-IT.js";import"./BaseGame-D8z93T-B.js";import{u as d}from"./useGameState-DJPJV8mx.js";import{u as c}from"./usePrevious-O36GIYFB.js";import"./socket-DRbsQkF5.js";import"./zustand-BEg5S8SY.js";const h={red:"bg-red-500/60",blue:"bg-blue-500/60"},x={red:"text-red-500",blue:"text-blue-500"};function m({game:m,currentUserId:u}){const g=m,[p]=d(g),[b,v]=l.useState(!1),{ti:j,ts:f}=e(),y=p.players[p.currentPlayerIndex],w=y?.id===u,N=p.isGameEnded;c(p.currentPlayerIndex,(e,s)=>{"playing"!==p.gamePhase||N||null!==e&&t.playTurnSwitch(w)});const k=100/(p.gridSize-1);return s.jsxs("div",{className:"flex flex-col items-center gap-6 p-4 w-full max-w-2xl mx-auto pb-16!",children:[s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("h2",{className:"text-3xl font-bold text-white",children:"Dots & Boxes"}),s.jsx("div",{className:"flex gap-4 @md:gap-8 bg-slate-800 p-4 rounded-xl shadow-lg border border-slate-700 w-full justify-center",children:p.players.map((e,t)=>s.jsxs("div",{className:`flex flex-col items-center gap-2 p-2 rounded-lg transition-all ${p.currentPlayerIndex!==t||N?"border-2 border-transparent":"bg-slate-700 scale-105 shadow-md border-2 "+("red"===e?.color?"border-red-500":"border-blue-500")} ${e?.id?"":"opacity-60"}`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-3 rounded-full "+("red"===e?.color?"bg-red-500":"bg-blue-500")}),s.jsx("div",{className:"text-sm font-bold "+("red"===e?.color?"text-red-500":"text-blue-500"),children:e?.id?e.username:j({en:"Empty",vi:"Trống"})})]}),e?.id?s.jsx("div",{className:"flex flex-col items-center",children:s.jsx("div",{className:"text-3xl font-black "+("red"===e?.color?"text-red-500":"text-blue-500"),children:e.score})}):s.jsx("div",{className:"h-9 flex items-center",children:s.jsx("span",{className:"text-gray-500 text-xs italic",children:j({en:"Waiting...",vi:"Đang chờ..."})})}),g.isHost&&!N&&p.boxes.every(e=>e.every(e=>null===e))&&s.jsx("div",{className:"mt-1",children:e?.isBot?s.jsx("button",{onClick:()=>g.requestRemoveBot(t),className:"text-xs bg-red-900 hover:bg-red-800 text-red-100 px-2 py-1 rounded",children:j({en:"Remove Bot",vi:"Xóa Bot"})}):!e?.id&&s.jsx("button",{onClick:()=>g.requestAddBot(t),className:"text-xs bg-cyan-900 hover:bg-cyan-800 text-cyan-100 px-2 py-1 rounded",children:j({en:"+ Add Bot",vi:"+ Thêm Bot"})})})]},`player-${t}`))}),N||"playing"!==p.gamePhase?N?s.jsxs("div",{className:"text-2xl font-bold text-white mb-2",children:["Game Over!"," ","draw"===p.winner?j({en:"It's a Draw!",vi:"Hòa!"}):`${p.players.find(e=>e?.id===p.winner)?.username} ${j({en:"Wins!",vi:"Thắng!"})}`]}):null:s.jsx("div",{className:"text-lg",children:w?s.jsx("span",{className:"text-green-400 font-bold animate-pulse",children:j({en:"Your Turn!",vi:"Lượt của bạn!"})}):s.jsxs("span",{className:"text-gray-300",children:[j({en:"Waiting for",vi:"Đang chờ"})," ",s.jsx("span",{className:`${x[y?.color||"red"]} font-bold`,children:y?.username}),"..."]})})]}),s.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[!N&&"waiting"===p.gamePhase&&g.isHost&&s.jsxs("button",{onClick:()=>g.requestStartGame(),disabled:!g.canStartGame(),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(n,{className:"w-4 h-4"})," ",j({en:"Start Game",vi:"Bắt đầu"})]}),g.isHost&&"waiting"!==p.gamePhase&&s.jsxs("button",{onClick:()=>g.requestNewGame(),className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[s.jsx(i,{className:"w-4 h-4"})," ",j(N?{en:"Play Again",vi:"Chơi lại"}:{en:"New Game",vi:"Ván mới"})]}),"playing"===p.gamePhase&&!N&&s.jsx("button",{onClick:()=>g.requestUndo(),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg",children:j({en:"Undo",vi:"Hoàn tác"})})]}),p.undoRequest&&(()=>{const e=p.players.find(e=>e?.id===p.undoRequest?.requesterId);return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg shadow-xl border border-slate-600 flex flex-col gap-3",children:[s.jsxs("p",{className:"text-white",children:[e?.username," ",j({en:"requested to undo the last move.",vi:"muốn hoàn tác nước đi vừa rồi."})]}),e?.id!=g.userId?s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx("button",{onClick:()=>g.rejectUndo(),className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded",children:j({en:"Reject",vi:"Từ chối"})}),s.jsx("button",{onClick:()=>g.approveUndo(),className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white rounded",children:j({en:"Approve",vi:"Đồng ý"})})]}):s.jsxs("div",{className:"text-white",children:[j({en:"Waiting for approval...",vi:"Đang chờ phê duyệt..."}),s.jsx("button",{onClick:()=>g.rejectUndo(),className:"px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded",children:j({en:"Cancel",vi:"Hủy"})})]})]})})})(),s.jsx("div",{className:"relative aspect-square w-full max-w-[400px] bg-slate-900 p-6 rounded-lg shadow-2xl select-none touch-none border-2 border-slate-700",children:s.jsxs("div",{className:"relative w-full h-full",children:[p.boxes.map((e,t)=>e.map((e,l)=>{const a=p.players.find(t=>t?.id===e);return a?s.jsx("div",{className:`absolute flex items-center justify-center rounded-sm transition-all duration-500 scale-90 ${h[a.color]}`,style:{top:t*k+"%",left:l*k+"%",width:`${k}%`,height:`${k}%`},children:s.jsx("div",{className:`text-2xl font-bold ${x[a.color]}`,children:a.username[0].toUpperCase()})},`box-${t}-${l}`):null})),["horizontal","vertical"].map(e=>("horizontal"===e?p.horizontalLines:p.verticalLines).map((t,l)=>t.map((t,a)=>{const n=p.lastLine?.type===e&&p.lastLine.row===l&&p.lastLine.col===a,i="horizontal"===e;return s.jsx("div",{onClick:()=>{return t=e,s=l,n=a,void(w&&!N&&"playing"===p.gamePhase&&("horizontal"===t&&p.horizontalLines[s][n]||"vertical"===t&&p.verticalLines[s][n]||g.requestPlaceLine(t,s,n)));var t,s,n},className:`absolute cursor-pointer transition-all duration-200 rounded-full z-10\n                      ${i?"h-2 -translate-y-1/2":"w-2 -translate-x-1/2"}\n                      ${t?n?"bg-yellow-400 shadow-[0_0_12px_4px_rgba(250,204,21,0.7)] animate-pulse":"bg-white shadow-[0_0_8px_2px_rgba(255,255,255,0.4)]":"playing"===p.gamePhase?"bg-slate-800 hover:bg-slate-400":"bg-slate-800 cursor-default"}`,style:{top:l*k+"%",left:a*k+"%",...i?{width:`${k}%`}:{height:`${k}%`}},children:!t&&"playing"===p.gamePhase&&s.jsx("div",{className:"absolute inset-0 "+(i?"-top-2 -bottom-2":"-left-2 -right-2")})},`${e[0]}-${l}-${a}`)})))]})}),s.jsx("button",{onClick:()=>v(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-500 transition-colors z-40 shadow-lg border border-slate-500",title:f({en:"Rules",vi:"Luật chơi"}),children:s.jsx(r,{size:24})}),b&&a.createPortal(s.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-4",children:s.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full shadow-2xl relative",children:[s.jsxs("div",{className:"flex justify-between p-4 pr-2",children:[s.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[s.jsx(r,{className:"w-6 h-6 text-yellow-500"}),j({en:"Game Rules: Dots And Boxes",vi:"Luật Chơi: Nối Điểm"})]}),s.jsx("button",{onClick:()=>v(!1),className:"p-2 hover:bg-white/10 rounded-full transition-colors text-slate-400 hover:text-white",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"p-4 pt-0 space-y-4 text-slate-300 leading-relaxed max-h-[80vh] overflow-y-auto",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{children:j({en:"Dots and Boxes is a pencil-and-paper game for two players. The game starts with an empty grid of dots.",vi:"Dots and Boxes (Nối điểm) là trò chơi dành cho 2 người. Trò chơi bắt đầu với một lưới các điểm."})}),s.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:j({en:"Objective",vi:"Mục tiêu"})}),s.jsx("ul",{className:"list-disc pl-5 space-y-1",children:s.jsx("li",{children:j({en:"Complete more boxes (squares) than your opponent.",vi:"Hoàn thành (đóng) được nhiều ô vuông hơn đối thủ."})})}),s.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:j({en:"Gameplay",vi:"Luật chơi"})}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[s.jsx("li",{children:j({en:"Players take turns adding a single horizontal or vertical line between two unjoined adjacent dots.",vi:"Người chơi lần lượt thêm một đoạn thẳng ngang hoặc dọc giữa 2 điểm chưa được nối."})}),s.jsx("li",{children:j({en:"A player who completes the fourth side of a 1x1 box earns one point and MUST take another turn.",vi:"Người vẽ cạnh thứ 4 của một ô vuông 1x1 sẽ được điểm và PHẢI đi thêm lượt nữa."})}),s.jsx("li",{children:j({en:"If you complete multiple boxes in one move, you keep playing until you fail to complete a box.",vi:"Nếu bạn đóng được nhiều ô trong một lượt, bạn tiếp tục đi cho đến khi không đóng được ô nào nữa."})})]}),s.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:j({en:"Winning",vi:"Chiến thắng"})}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[s.jsx("li",{children:j({en:"The game ends when no more lines can be placed.",vi:"Trò chơi kết thúc khi không còn đường nào để vẽ."})}),s.jsx("li",{children:j({en:"The player with the most boxes wins.",vi:"Người có nhiều ô nhất sẽ thắng."})})]})]})})]})}),document.body)]})}export{m as default};
