import{B as t}from"./BaseGame-gcDpxcTe.js";import"./socket-DRbsQkF5.js";import"./index--Q6lzWr_.js";import"./react-vendor-RjW9glnC.js";import"./zustand-CR18f17S.js";class e extends t{isGameOver(t){return"ended"===t.gamePhase}getInitState(){const t=Array(12).fill(5);t[0]=10,t[6]=10;const e={board:t,playerScores:{},currentTurn:"",winner:null,gamePhase:"waiting",players:this.players.map(t=>({...t,isBot:!1}))};return this.players.length>0&&this.players.forEach(t=>e.playerScores[t.id]=0),e}updatePlayers(t){this.state.players=t.map(t=>({...t,isBot:!1}))}getMyPlayerIndex(){return this.state.players.findIndex(t=>t.id===this.userId)}onSocketGameAction(t){const e=t.action;if(this.isHost)switch(e.type){case"START_GAME":this.startGame();break;case"RESET":this.resetGame();break;case"ADD_BOT":this.addBot();break;case"REMOVE_BOT":this.removeBot(e.botIndex);break;case"MOVE":this.processMove(e)}}startGame(){if(this.state.players.length<2)return;const t=Array(12).fill(5);t[0]=10,t[6]=10;const e={...this.state.playerScores};this.state.players.forEach(t=>{e[t.id]=0}),this.state.gamePhase="playing",this.state.currentTurn=this.state.players[0].id,this.state.board=t,this.state.playerScores=e,this.state.winner=null,this.state.lastMove=void 0,this.checkPopulationIfNeeded(),this.checkBotTurn()}resetGame(){this.state.gamePhase="waiting",this.state.winner=null,this.state.lastMove=void 0}addBot(){if(this.state.players.length>=2)return;const t=`bot-${Date.now()}`,e={id:t,username:"Bot Player",isHost:!1,isBot:!0};this.state.players.push(e),this.state.playerScores[t]=0}removeBot(t){if(void 0===t)return;const e=this.state.players[t];if(e&&e.isBot){const s=[...this.state.players];s.splice(t,1);const a={...this.state.playerScores};delete a[e.id],this.state.players=s,this.state.playerScores=a}}processMove(t){if("playing"!==this.state.gamePhase||this.state.winner)return;if("MOVE"!==t.type)return;if(!t.squareId||!t.direction)return;const e=this.state.players.findIndex(t=>t.id===this.state.currentTurn);if(-1===e)return;const s=0===e?[7,11]:[1,5];if(t.squareId<s[0]||t.squareId>s[1])return;if(0===this.state.board[t.squareId])return;let a;a=0===e?"left"===t.direction?"cw":"ccw":"left"===t.direction?"ccw":"cw",this.executeMoveLogic(e,t.squareId,a),this.state.lastMove={player:this.state.players[e].id,squareId:t.squareId,direction:a};const r=this.checkGameEnd();let i=this.state.winner,o=this.state.gamePhase,n=this.state.currentTurn;if(r)i=r.winner||null,o="ended";else{const t=1-e;this.state.players[t]&&(n=this.state.players[t].id,this.state.currentTurn=n,this.checkPopulationIfNeeded())}this.state.winner=i,this.state.gamePhase=o,this.state.currentTurn=n,this.state.winner||this.checkBotTurn()}executeMoveLogic(t,e,a){const r=s(this.state.board,e,a);this.state.board=r.finalBoard;const i={...this.state.playerScores};i[this.state.players[t].id]+=r.score,this.state.playerScores=i}checkPopulationIfNeeded(){const t=this.state.currentTurn,e=this.state.players.findIndex(e=>e.id===t);if(-1===e)return;const s=0===e?[7,11]:[1,5];let a=!1;for(let r=s[0];r<=s[1];r++)if(this.state.board[r]>0){a=!0;break}if(!a){const e={...this.state.playerScores};e[t]-=5,this.state.playerScores=e;const a=[...this.state.board];for(let t=s[0];t<=s[1];t++)a[t]=1;this.state.board=a}}checkGameEnd(){if(0===this.state.board[0]&&0===this.state.board[6]){let t=0;for(let i=7;i<=11;i++)t+=this.state.board[i];let e=0;for(let i=1;i<=5;i++)e+=this.state.board[i];const s={...this.state.playerScores};s[this.state.players[0].id]+=t,this.state.players[1]&&(s[this.state.players[1].id]+=e),this.state.playerScores=s,this.state.board=Array(12).fill(0);const a=this.state.playerScores[this.state.players[0].id],r=this.state.players[1]?this.state.playerScores[this.state.players[1].id]:-9999;return a===r?{isDraw:!0}:{winner:a>r?this.state.players[0].id:this.state.players[1].id}}return null}checkBotTurn(){const t=this.state.players.find(t=>t.id===this.state.currentTurn);t&&t.isBot&&setTimeout(()=>{this.makeBotMove()},1e3)}makeBotMove(){const t=0===this.state.players.findIndex(t=>t.id===this.state.currentTurn)?[7,11]:[1,5],e=[];for(let s=t[0];s<=t[1];s++)this.state.board[s]>0&&(e.push({id:s,dir:"left"}),e.push({id:s,dir:"right"}));if(e.length>0){const t=e[Math.floor(Math.random()*e.length)];this.processMove({type:"MOVE",squareId:t.id,direction:t.dir})}}requestStartGame(){this.makeAction({type:"START_GAME"})}requestResetGame(){this.makeAction({type:"RESET"})}requestAddBot(t){this.makeAction({type:"ADD_BOT",botIndex:t})}requestRemoveBot(t){this.makeAction({type:"REMOVE_BOT",botIndex:t})}requestMove(t,e){this.makeAction({type:"MOVE",squareId:t,direction:e})}}const s=(t,e,s)=>{const a=[...t];let r=0;const i=[];let o=a[e];a[e]=0,i.push({type:"pickup",squareId:e,amount:o});let n=e;const h="cw"===s?1:-1;for(;o>0;)if(n=(n+h+12)%12,a[n]++,o--,i.push({type:"sow",squareId:n}),0===o){const t=(n+h+12)%12;if(0===t||6===t)break;if(!(a[t]>0)){let e=!0,s=t;for(;e;){const t=(s+h+12)%12;if(a[t]>0){const o=a[t];a[t]=0,r+=o,i.push({type:"capture",squareId:t,amount:o});const n=(t+h+12)%12;0===a[n]?s=n:e=!1}else e=!1;if(0===a[t]&&!e)break}break}o=a[t],a[t]=0,n=t,i.push({type:"pickup",squareId:n,amount:o})}return{finalBoard:a,score:r,steps:i}};export{e as default,s as simulateOAnQuanMove};
