import{u as e,j as t}from"./index-kyu8B1WK.js";import{k as s,Q as n,V as a,Y as l,_ as r}from"./react-vendor-DL9bQ042.js";import"./socket-DRbsQkF5.js";import{e as i,B as o,T as c,a as u,P as d,b as m}from"./types-DJ2IAAiI.js";import"./zustand-twGbzGPV.js";function h({game:h}){const x=h,[g,f]=s.useState(x.getState()),{username:p}=e(),b=s.useRef(null),y=s.useRef(null),v=s.useRef(x.getState().balls),[w,j]=s.useState(!1),[N,P]=s.useState(0),[S,M]=s.useState(0),[k,C]=s.useState(null),[E,R]=s.useState(1),T=x.isMyTurn(),B=s.useRef(()=>{}),A=s.useRef(!1);A.current=w;const L=s.useRef(0);L.current=N;const I=s.useRef(0);I.current=S,s.useEffect(()=>{const e=()=>{if(y.current){const e=y.current.clientWidth-16,t=Math.min(1,e/c);R(t)}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const Y=s.useRef({isAiming:w,aimAngle:N,aimPower:S,mousePos:k});Y.current={isAiming:w,aimAngle:N,aimPower:S,mousePos:k};const W=s.useRef(E);W.current=E;const D=s.useCallback((e,t,s)=>{const n=i[t.id]||"#FFF";s&&(e.save(),e.shadowColor=s,e.shadowBlur=15,e.fillStyle=s,e.globalAlpha=.6,e.beginPath(),e.arc(t.x,t.y,o+4,0,2*Math.PI),e.fill(),e.restore()),e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.arc(t.x+2,t.y+2,o,0,2*Math.PI),e.fill(),e.fillStyle=n,e.beginPath(),e.arc(t.x,t.y,o,0,2*Math.PI),e.fill(),t.id>=9&&t.id<=15&&(e.fillStyle="white",e.beginPath(),e.arc(t.x,t.y,.7*o,0,2*Math.PI),e.fill(),e.fillStyle=n,e.beginPath(),e.arc(t.x,t.y,.5*o,0,2*Math.PI),e.fill()),0!==t.id&&(e.fillStyle=8===t.id?"white":"black",e.font=`bold ${.9*o}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.id.toString(),t.x,t.y)),e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.arc(t.x-.3*o,t.y-.3*o,.3*o,0,2*Math.PI),e.fill()},[]),U=s.useCallback(()=>{const e=b.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const s=W.current,{isAiming:n,aimAngle:a,aimPower:l}=Y.current;e.width=c*s,e.height=u*s,t.save(),t.scale(s,s),t.fillStyle="#1a472a",t.fillRect(0,0,c,u),t.strokeStyle="#5d3a1a",t.lineWidth=20,t.strokeRect(10,10,c-20,u-20),t.fillStyle="#111";for(const o of d)t.beginPath(),t.arc(o.x,o.y,m,0,2*Math.PI),t.fill();const r=x.getState(),i=x.getMySlot(),h=i===r.currentTurn&&"playing"===r.gamePhase&&!r.isSimulating,g=i?r.players[i].ballType:null,f=g&&0===v.current.filter(e=>!e.pocketed&&e.type===g).length;for(const o of v.current){if(o.pocketed)continue;let e;h&&(0===o.id?e="#00ff88":g&&(f&&8===o.id?e="#ffcc00":o.type===g&&(e="#00aaff"))),D(t,o,e)}const p=v.current.find(e=>0===e.id&&!e.pocketed);if(n&&p&&l>0){const e=p.x+Math.cos(a)*l*150,s=p.y+Math.sin(a)*l*150,n=t.createLinearGradient(p.x,p.y,e,s);n.addColorStop(0,"rgba(255, 255, 255, 0.8)"),n.addColorStop(1,"rgba(255, 100, 100, 0.8)"),t.strokeStyle=n,t.lineWidth=3,t.setLineDash([10,5]),t.beginPath(),t.moveTo(p.x,p.y),t.lineTo(e,s),t.stroke(),t.setLineDash([]);const r=200,i=o+5+50*l,c=p.x-Math.cos(a)*i,u=p.y-Math.sin(a)*i,d=c-Math.cos(a)*r,m=u-Math.sin(a)*r;t.strokeStyle="#8B4513",t.lineWidth=6,t.lineCap="round",t.beginPath(),t.moveTo(c,u),t.lineTo(d,m),t.stroke(),t.fillStyle="#E6D5B8",t.beginPath(),t.arc(c,u,4,0,2*Math.PI),t.fill()}t.restore()},[D]);B.current=U,s.useEffect(()=>{U()},[U,g,w,N,S,E]),s.useEffect(()=>{x.onUpdate(e=>{f(e),v.current=e.balls,B.current()}),x.onFrame(e=>{v.current=e,B.current()})},[x]);const X=s.useCallback((e,t)=>{const s=b.current;if(!s)return null;const n=s.getBoundingClientRect();return{x:(e-n.left)/E,y:(t-n.top)/E}},[E]),G=e=>{if(!T||g.isSimulating)return;const t=v.current.find(e=>0===e.id&&!e.pocketed);if(!t)return;const s="touches"in e?e.touches[0].clientX:e.clientX,n="touches"in e?e.touches[0].clientY:e.clientY,a=X(s,n);if(!a)return;const l=a.x-t.x,r=a.y-t.y;Math.sqrt(l*l+r*r)<5*o&&(e.preventDefault(),j(!0),C(a))},H=s.useCallback((e,t)=>{const s=v.current.find(e=>0===e.id&&!e.pocketed);if(!s)return;const n=X(e,t);if(!n)return;C(n);const a=Math.atan2(n.y-s.y,n.x-s.x)+Math.PI;P(a);const l=n.x-s.x,r=n.y-s.y,i=Math.sqrt(l*l+r*r),o=Math.min(1,i/200);M(o)},[X]),q=e=>{if(!w)return;e.preventDefault();const t="touches"in e?e.touches[0].clientX:e.clientX,s="touches"in e?e.touches[0].clientY:e.clientY;H(t,s)},F=s.useCallback(()=>{I.current>.05&&x.shoot(L.current,I.current),j(!1),M(0),C(null)},[x]);s.useEffect(()=>{const e=e=>{A.current&&H(e.clientX,e.clientY)},t=()=>{A.current&&F()},s=e=>{A.current&&e.touches.length>0&&H(e.touches[0].clientX,e.touches[0].clientY)},n=()=>{A.current&&F()};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("touchend",n),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",n)}},[H,F]);const z=e=>{const t=g.players[e];return t.id?"BOT"===t.id?"Bot ðŸ¤–":t.id===x.userId?p||"You":t.username||"Player "+e:"(waiting...)"},O=e=>{const t=g.players[e].ballType;return t?"solid"===t?"(Solids 1-7)":"(Stripes 9-15)":""};return t.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-4xl mx-auto",ref:y,children:[t.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-slate-800 rounded-lg w-full max-w-[500px]",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-1",children:"Players"}),[1,2].map(e=>{const s=g.players[e],a=g.currentTurn===e&&"playing"===g.gamePhase,l=s.id===x.userId,r="BOT"===s.id;return t.jsxs("div",{className:`\n                flex items-center justify-between p-3 rounded-lg\n                ${a?"bg-slate-600 ring-2 ring-blue-400":"bg-slate-700"}\n              `,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-6 h-6 rounded-full "+(1===e?"bg-blue-500":"bg-red-500")}),t.jsxs("div",{children:[t.jsxs("span",{className:"text-white font-medium",children:[z(e),l&&s.id&&" (You)"]}),t.jsx("span",{className:"text-gray-400 text-sm ml-2",children:O(e)})]})]}),r&&x.isHostUser&&"waiting"===g.gamePhase&&t.jsx("button",{onClick:()=>x.removeBot(),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:"Remove"}),!s.id&&x.isHostUser&&2===e&&"waiting"===g.gamePhase&&t.jsxs("button",{onClick:()=>x.addBot(),className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors flex items-center gap-1",children:[t.jsx(n,{className:"w-3 h-3"})," Add Bot"]})]},e)})]}),"waiting"===g.gamePhase&&x.isHostUser&&t.jsx("div",{className:"flex flex-col items-center gap-2",children:x.canStartGame()?t.jsxs("button",{onClick:()=>x.startGame(),className:"px-6 py-3 bg-green-600 hover:bg-green-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(a,{className:"w-5 h-5"}),"Start Game"]}):t.jsx("span",{className:"text-sm text-slate-400",children:"Waiting for opponent to join..."})}),"playing"===g.gamePhase&&x.isHostUser&&!g.isSimulating&&t.jsxs("button",{onClick:()=>x.requestReset(),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-slate-300 text-sm font-medium transition-colors flex items-center gap-2",children:[t.jsx(l,{className:"w-4 h-4"}),"New Game"]}),"waiting"===g.gamePhase&&!x.isHostUser&&t.jsx("div",{className:"text-sm text-slate-400",children:"Waiting for host to start the game..."}),"playing"===g.gamePhase&&!g.winner&&t.jsx("div",{className:"text-lg text-gray-400",children:g.isSimulating?t.jsx("span",{className:"text-yellow-400",children:"Balls in motion..."}):T?t.jsxs("span",{className:"text-green-400 flex items-center gap-2",children:[t.jsx(r,{className:"w-5 h-5"}),"Your turn! Click near the cue ball and drag to aim."]}):t.jsx("span",{children:"Waiting for opponent..."})}),g.turnMessage&&t.jsx("div",{className:"text-yellow-400 text-sm",children:g.turnMessage}),t.jsx("div",{className:"relative bg-slate-900 p-2 rounded-xl shadow-2xl overflow-hidden",children:t.jsx("canvas",{ref:b,width:c*E,height:u*E,className:"rounded-lg cursor-crosshair block",style:{touchAction:"none"},onMouseDown:G,onMouseMove:q,onTouchStart:G,onTouchMove:q})}),w&&t.jsxs("div",{className:"w-full max-w-xs",children:[t.jsxs("div",{className:"text-sm text-gray-400 mb-1",children:["Power: ",Math.round(100*S),"%"]}),t.jsx("div",{className:"h-3 bg-slate-700 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-75",style:{width:100*S+"%",background:"linear-gradient(90deg, #22c55e, #eab308, #ef4444)"}})})]}),g.winner&&t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-2xl font-bold text-green-400 mb-4",children:["ðŸ† ",z(g.winner)," wins!"]}),t.jsxs("button",{onClick:()=>x.requestReset(),className:"px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors flex items-center gap-2 mx-auto",children:[t.jsx(l,{className:"w-5 h-5"}),"Play Again"]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 justify-center text-xs text-gray-400",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-3 h-3 rounded-full bg-yellow-500"})," Solids (1-7)"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-3 h-3 rounded-full border-2 border-yellow-500 bg-white"})," ","Stripes (9-15)"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-3 h-3 rounded-full bg-black border border-gray-600"})," ","8-Ball"]})]})]})}export{h as default};
