import{a as e,u as s,j as t}from"./index-BLcGWsmB.js";import{c as n,Y as i,ah as a,a7 as l,al as r,X as c}from"./react-vendor-DeJ0i39y.js";import"./Chess-tCYQm9gR.js";import{C as o}from"./chess-DTd62Tay.js";import{C as d}from"./chessground-CpDKPGt0.js";import{u as h}from"./useGameState-D1GsuIT1.js";import"./socket-DRbsQkF5.js";import"./zustand-ie0NTbcC.js";import"./BaseGame-BoHpQUK3.js";function x({game:x}){const m=x,[u]=h(m),{userId:g}=e(),{ti:v,ts:p}=s(),[b,w]=n.useState(!1),f=n.useRef(null),j=n.useRef(null),N=m.getPlayerColor(),y=!!N&&u.turn===N,k=u.check;n.useEffect(()=>{if(!f.current)return;const e="w"===N?"white":"black",s={fen:u.fen,orientation:e,turnColor:"w"===u.turn?"white":"black",movable:{free:!1,color:y?N:void 0,dests:C(u.fen)},events:{move:(e,s)=>{const t=new o(u.fen).get(e),n="p"===t?.type&&("w"===t.color&&"8"===s[1]||"b"===t.color&&"1"===s[1]);m.requestMove(e,s,n?"q":void 0)}},draggable:{enabled:!0,showGhost:!0},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200}};j.current?j.current.set({fen:u.fen,turnColor:"w"===u.turn?"white":"black",movable:{free:!1,color:y&&!u.gameOver?e:void 0,dests:y?C(u.fen):new Map},check:k?"w"===u.turn?"white":"black":void 0,lastMove:u.lastMove?[u.lastMove.from,u.lastMove.to]:void 0}):j.current=d(f.current,s);const t=new ResizeObserver(()=>{j.current&&j.current.redrawAll()});return f.current&&t.observe(f.current),()=>{t.disconnect()}},[u.fen,y,u.gameOver,N]);const C=e=>{const s=new Map;if(!y||u.gameOver)return s;const t=new o(e).moves({verbose:!0});for(const n of t){const e=n.from,t=n.to;s.has(e)||s.set(e,[]),s.get(e)?.push(t)}return s};return t.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-2xl mx-auto pb-16!",children:[t.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-slate-800 rounded-lg w-full max-w-[400px] mx-auto",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-1",children:v({en:"Players",vi:"Ng∆∞·ªùi ch∆°i"})}),["white","black"].map(e=>{const s=u.players[e],n=s?.isBot,i=u.turn===("white"===e?"w":"b")&&!u.gameOver,l=s?.id===g;return t.jsxs("div",{className:`\n                flex items-center justify-between p-2 rounded-lg\n                ${i?"bg-slate-600 ring-2 ring-yellow-400":"bg-slate-700"}\n              `,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center "+("white"===e?"bg-white":"bg-black")}),t.jsxs("span",{className:"text-white",children:[n?"Bot":s?s.username:v({en:"(waiting...)",vi:"(ƒëang ch·ªù...)"}),n&&" ü§ñ",l&&s&&v({en:" (You)",vi:" (B·∫°n)"})]})]}),n&&m.isHost&&!u.gameOver&&t.jsx("button",{onClick:()=>m.removeBot(),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:v({en:"Remove",vi:"X√≥a"})}),!s&&m.isHost&&!u.gameOver&&t.jsxs("button",{onClick:()=>m.addBot(),disabled:u.isBotLoading,className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors flex items-center gap-1",children:[u.isBotLoading?t.jsx("span",{className:"w-3 h-3 border-2 border-white/20 border-t-white rounded-full animate-spin"}):t.jsx(a,{className:"w-3 h-3"}),v({en:"Add Bot",vi:"Th√™m Bot"})]})]},e)})]}),u.gameOver?t.jsx("div",{className:"text-lg font-bold text-center my-2",children:u.winner?t.jsx("span",{className:u.winner===("w"===N?"white":"black")?"text-green-400":"text-red-400",children:u.winner===(g===u.players.white?.id?"white":"black")?v({en:"You Won!",vi:"B·∫°n th·∫Øng!"}):v({en:"Opponent Won!",vi:"ƒê·ªëi th·ªß th·∫Øng!"})}):t.jsx("span",{className:"text-yellow-400",children:v({en:"Draw!",vi:"H√≤a!"})})}):k&&u.turn===N&&t.jsx("div",{className:"text-center my-2",children:t.jsx("div",{className:"text-red-400 font-bold animate-pulse",children:v({en:"Check!",vi:"Chi·∫øu!"})})}),t.jsxs("div",{className:"flex flex-col gap-2 justify-center items-center w-full",children:[t.jsx("div",{className:"text-lg text-gray-400",children:y?t.jsx("span",{className:"text-green-400",children:v({en:"Your turn!",vi:"L∆∞·ª£t c·ªßa b·∫°n!"})}):t.jsxs("span",{children:[v({en:"Waiting for",vi:"ƒêang ch·ªù"})," ",u.players["w"===N?"black":"white"]?.username," ",v({en:"...",vi:"..."})]})}),!u.gameOver&&!u.pendingNewGameRequest&&t.jsxs("button",{onClick:()=>m.requestReset(),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(l,{className:"w-4 h-4"}),v({en:"New Game",vi:"V√°n m·ªõi"})]}),u.gameOver&&t.jsxs("button",{onClick:()=>m.requestReset(),className:"px-6 py-2 bg-primary-600 hover:bg-primary-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(l,{className:"w-4 h-4"}),v({en:"Play Again",vi:"Ch∆°i l·∫°i"})]})]}),u.pendingNewGameRequest&&u.pendingNewGameRequest!==g&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-xl flex flex-col gap-4 max-w-sm w-full",children:[t.jsx("div",{className:"text-lg text-white font-medium text-center",children:v({en:"Opponent wants to start a new game",vi:"ƒê·ªëi th·ªß mu·ªën ch∆°i v√°n m·ªõi"})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>m.onSocketGameAction({action:{type:"NEW_GAME_RESPONSE",accepted:!0}}),className:"flex-1 bg-green-600 hover:bg-green-500 py-2 rounded-lg text-white font-medium",children:v({en:"Accept",vi:"ƒê·ªìng √Ω"})}),t.jsx("button",{onClick:()=>m.onSocketGameAction({action:{type:"NEW_GAME_RESPONSE",accepted:!1}}),className:"flex-1 bg-red-600 hover:bg-red-500 py-2 rounded-lg text-white font-medium",children:v({en:"Decline",vi:"T·ª´ ch·ªëi"})})]})]})}),u.pendingNewGameRequest&&u.pendingNewGameRequest===g&&t.jsx("div",{className:"text-sm text-yellow-400 animate-pulse flex items-center justify-center",children:v({en:"Requesting New Game...",vi:"ƒêang y√™u c·∫ßu v√°n m·ªõi..."})}),t.jsx("div",{className:"w-full max-w-xl",children:t.jsx("div",{ref:f,className:"w-full aspect-square rounded-lg overflow-hidden",style:{maxHeight:"min(80vh, 600px)"}})}),t.jsxs("div",{className:"w-full flex justify-between gap-4 text-sm",children:[t.jsxs("div",{className:"rounded-lg p-2 flex-1 bg-slate-400",children:[t.jsxs("div",{className:"text-xs text-slate-100 mb-1",children:[v({en:"White captured:",vi:"Tr·∫Øng b·∫Øt:"})," "]}),t.jsx("div",{className:"flex flex-wrap gap-1",children:u.capturedPieces.white.map((e,s)=>t.jsx("img",{src:`https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/cburnett/b${e.toUpperCase()}.svg`,alt:e,className:"w-5 h-5 object-contain"},s))})]}),t.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[t.jsx("div",{className:"text-xs text-slate-400 mb-1",children:v({en:"Black captured:",vi:"ƒêen b·∫Øt:"})}),t.jsx("div",{className:"flex flex-wrap gap-1",children:u.capturedPieces.black.map((e,s)=>t.jsx("img",{src:`https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/cburnett/w${e.toUpperCase()}.svg`,alt:e,className:"w-5 h-5 object-contain"},s))})]})]}),t.jsx("button",{onClick:()=>w(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-500 transition-colors z-40 shadow-lg border border-slate-500",title:p({en:"Rules",vi:"Lu·∫≠t ch∆°i"}),children:t.jsx(r,{size:24})}),b&&i.createPortal(t.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-100 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full max-h-[85vh] overflow-y-auto shadow-2xl relative",children:[t.jsxs("div",{className:"flex justify-between sticky top-0 p-4 pr-2 bg-slate-900",children:[t.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[t.jsx(r,{className:"w-6 h-6 text-yellow-500"}),v({en:"Game Rules: Chess",vi:"Lu·∫≠t Ch∆°i: C·ªù Vua"})]}),t.jsx("button",{onClick:()=>w(!1),className:"p-2 hover:bg-white/10 rounded-full transition-colors text-slate-400 hover:text-white",children:t.jsx(c,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"p-4 pt-0 space-y-4 text-slate-300 leading-relaxed",children:t.jsxs("div",{className:"space-y-4 text-slate-300 leading-relaxed",children:[t.jsxs("section",{children:[t.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:v({en:"Objective",vi:"M·ª•c ti√™u"})}),t.jsx("p",{children:v({en:"Checkmate the opponent's king. White moves first.",vi:"Chi·∫øu b√≠ vua c·ªßa ƒë·ªëi ph∆∞∆°ng. Tr·∫Øng ƒëi tr∆∞·ªõc."})})]}),t.jsxs("section",{children:[t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:v({en:"Basic Rules",vi:"Quy T·∫Øc C∆° B·∫£n"})}),t.jsxs("ul",{className:"list-disc pl-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:v({en:"King",vi:"Vua"})}),":"," ",v({en:"Moves one square in any direction.",vi:"Di chuy·ªÉn 1 √¥ theo m·ªçi h∆∞·ªõng."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:v({en:"Queen",vi:"H·∫≠u"})}),":"," ",v({en:"Moves diagonally, horizontally, or vertically any number of squares.",vi:"Di chuy·ªÉn ngang, d·ªçc, ch√©o bao nhi√™u √¥ t√πy √Ω."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:v({en:"Rook",vi:"Xe"})}),":"," ",v({en:"Moves horizontally or vertically any number of squares.",vi:"Di chuy·ªÉn ngang ho·∫∑c d·ªçc bao nhi√™u √¥ t√πy √Ω."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:v({en:"Bishop",vi:"T∆∞·ª£ng"})}),":"," ",v({en:"Moves diagonally any number of squares.",vi:"Di chuy·ªÉn ch√©o bao nhi√™u √¥ t√πy √Ω."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:v({en:"Knight",vi:"M√£"})}),":"," ",v({en:"Moves in an 'L' shape: two squares in one direction and then one square perpendicular to that direction.",vi:"Di chuy·ªÉn theo h√¨nh ch·ªØ L."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:v({en:"Pawn",vi:"T·ªët"})}),":"," ",v({en:"Moves forward one square (or two on the first move). Captures diagonally.",vi:"Di chuy·ªÉn th·∫≥ng 1 √¥ (ho·∫∑c 2 ·ªü n∆∞·ªõc ƒë·∫ßu). ƒÇn ch√©o."})]})]})]}),t.jsxs("section",{children:[t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:v({en:"Special Moves",vi:"N∆∞·ªõc ƒêi ƒê·∫∑c Bi·ªát"})}),t.jsxs("ul",{className:"list-disc pl-4",children:[t.jsx("li",{children:v({en:"Castling: Move the King two squares towards a Rook.",vi:"Nh·∫≠p th√†nh: Di chuy·ªÉn Vua 2 √¥ v·ªÅ ph√≠a Xe."})}),t.jsx("li",{children:v({en:"En Passant: Special pawn capture.",vi:"B·∫Øt t·ªët qua ƒë∆∞·ªùng."})}),t.jsx("li",{children:v({en:"Promotion: Pawn reaching the other side becomes a Queen, Rook, Bishop, or Knight.",vi:"Phong c·∫•p: T·ªët ƒëi ƒë·∫øn cu·ªëi b√†n c·ªù ƒë∆∞·ª£c phong l√†m H·∫≠u, Xe, T∆∞·ª£ng ho·∫∑c M√£."})})]})]})]})})]})}),document.body)]})}export{x as default};
