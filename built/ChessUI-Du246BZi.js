import{b as e,j as t}from"./index-BrrJSH2n.js";import{j as s,Q as a,M as l}from"./react-vendor-BZRLljed.js";import"./socket-DRbsQkF5.js";import{C as n}from"./chess-DTd62Tay.js";import{C as i}from"./chessground-CpDKPGt0.js";import"./zustand-B3oBTGP0.js";function r({game:r}){const o=r,[c,d]=s.useState(o.getState()),{userId:x}=e(),m=s.useRef(null),h=s.useRef(null);s.useEffect(()=>{o.onUpdate(e=>d(e))},[o]);const u="w"===o.getPlayerColor()?"white":"black",p=c.turn===("white"===u?"w":"b"),g=c.check;s.useEffect(()=>{if(!m.current)return;const e={fen:c.fen,orientation:u,turnColor:"w"===c.turn?"white":"black",movable:{free:!1,color:p?u:void 0,dests:w(c.fen)},events:{move:(e,t)=>{o.requestMove(e,t)}},draggable:{enabled:!0,showGhost:!0},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200}};return h.current?h.current.set({fen:c.fen,turnColor:"w"===c.turn?"white":"black",movable:{free:!1,color:p&&!c.gameOver?u:void 0,dests:p?w(c.fen):new Map},check:g?"w"===c.turn?"white":"black":void 0,lastMove:c.lastMove?[c.lastMove.from,c.lastMove.to]:void 0}):h.current=i(m.current,e),()=>{}},[c.fen,p,c.gameOver,u]);const w=e=>{const t=new Map;if(!p||c.gameOver)return t;const s=new n(e).moves({verbose:!0});for(const a of s){const e=a.from,s=a.to;t.has(e)||t.set(e,[]),t.get(e)?.push(s)}return t},f={p:"pawn",n:"knight",b:"bishop",r:"rook",q:"queen",k:"king"};return t.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-2xl mx-auto",children:[t.jsxs("div",{className:"w-full flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[c.gameOver?t.jsx("div",{className:"text-lg font-bold",children:c.winner?t.jsx("span",{className:c.winner===("white"===u?"white":"black")?"text-green-400":"text-red-400",children:c.winner===(x===c.players.white?"white":"black")?"You Won!":"Opponent Won!"}):t.jsx("span",{className:"text-yellow-400",children:"Draw!"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-lg font-bold "+(p?"text-primary-400":"text-slate-400"),children:p?"Your Turn":"Opponent's Turn"}),g&&c.turn===("white"===u?"w":"b")&&t.jsx("div",{className:"text-sm text-red-400 font-semibold",children:"You are in check!"})]}),t.jsxs("div",{className:"text-xs text-slate-500",children:["Playing as ","white"===u?"White":"Black"]})]}),t.jsxs("div",{className:"flex gap-2",children:[!c.gameOver&&!c.pendingNewGameRequest&&t.jsxs("button",{onClick:()=>o.requestReset(),className:"px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(a,{className:"w-4 h-4"}),"New Game"]}),c.gameOver&&t.jsxs("button",{onClick:()=>o.requestReset(),className:"px-3 py-2 bg-primary-600 hover:bg-primary-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:[t.jsx(a,{className:"w-4 h-4"}),"Play Again"]}),!c.gameOver&&!c.players.black&&o.isHostUser&&t.jsxs("button",{onClick:()=>o.addBot(),disabled:c.isBotLoading,className:"px-3 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-white font-medium transition-colors flex items-center gap-2 "+(c.isBotLoading?"opacity-50 cursor-not-allowed":""),children:[c.isBotLoading?t.jsx("span",{className:"w-4 h-4 border-2 border-white/20 border-t-white rounded-full animate-spin"}):t.jsx(l,{className:"w-4 h-4"}),c.isBotLoading?"Loading Bot...":"Play vs Bot"]})]}),c.pendingNewGameRequest&&c.pendingNewGameRequest!==x&&t.jsxs("div",{className:"flex flex-col gap-2 bg-slate-800 p-2 rounded-lg border border-slate-700 absolute top-20 left-1/2 -translate-x-1/2 z-10 shadow-xl",children:[t.jsx("div",{className:"text-sm text-white font-medium whitespace-nowrap",children:"Opponent wants New Game"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>o.handleAction({action:{type:"NEW_GAME_RESPONSE",accepted:!0}}),className:"flex-1 bg-green-600 hover:bg-green-500 text-xs py-1 px-2 rounded text-white",children:"Accept"}),t.jsx("button",{onClick:()=>o.handleAction({action:{type:"NEW_GAME_RESPONSE",accepted:!1}}),className:"flex-1 bg-red-600 hover:bg-red-500 text-xs py-1 px-2 rounded text-white",children:"Decline"})]})]}),c.pendingNewGameRequest&&c.pendingNewGameRequest===x&&t.jsx("div",{className:"text-sm text-yellow-400 animate-pulse flex items-center",children:"Requesting New Game..."})]}),t.jsx("div",{className:"w-full max-w-xl",children:t.jsx("div",{ref:m,className:"w-full aspect-square rounded-lg overflow-hidden",style:{maxHeight:"min(80vh, 600px)"}})}),t.jsxs("div",{className:"w-full flex justify-between gap-4 text-sm",children:[t.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[t.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"White captured:"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:c.capturedPieces.white.map((e,s)=>t.jsx("div",{className:`cg-icon ${f[e.toLowerCase()]} black`,style:{width:20,height:20,display:"inline-block",backgroundSize:"contain"}},s))})]}),t.jsxs("div",{className:"bg-slate-800 rounded-lg p-2 flex-1",children:[t.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Black captured:"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:c.capturedPieces.black.map((e,s)=>t.jsx("div",{className:`cg-icon ${f[e.toLowerCase()]} white`,style:{width:20,height:20,display:"inline-block",backgroundSize:"contain"}},s))})]})]})]})}export{r as default};
