import{a as e,u as s,b as t,c as a,j as n}from"./index-Di-nc6fj.js";import{c as l,V as i,z as r,at as d,ag as c,X as o,$ as m,aj as x,au as h,af as u,U as g,a1 as p}from"./react-vendor-CVGOeHNa.js";import"./BaseGame-bOx6xEpu.js";import{S as f,b as j,c as b}from"./types-C7xosaAt.js";import"./socket-DRbsQkF5.js";import"./zustand-D55yBrsf.js";function v({game:u}){const g=u,[p,f]=l.useState(g.getState()),[j,b]=l.useState([]),[v,k]=l.useState(!1),[C,T]=l.useState(!1),{username:P}=e(),{ti:S,ts:$}=s(),{confirm:G}=t(),I=a(e=>e.currentRoom),R=g.isHost,q=g.getMyPlayerIndex(),B=q>=0?p.players[q]:null,A=p.currentTurnIndex===q,J=g.canStartGame(),L=l.useMemo(()=>I?.players.some(e=>e.id===g.getUserId())??!1,[I,g]),M=l.useMemo(()=>{if(0===j.length||!B)return null;const e=j.map(e=>B.hand[e]);return g.validateSelectedCards(e)},[j,B,g]);l.useEffect(()=>g.onUpdate(e=>{f(e),b([])}),[g]);const H=l.useMemo(()=>{const e=[],s=q>=0?q:0;for(let t=0;t<4;t++){const a=(s+t)%4;e.push({slot:p.players[a],actualIndex:a})}return e},[p.players,q]),z=e=>{const s="desktop"===e,t=s?"min-h-[80px]":"min-h-[60px]",a=s?"text-sm":"text-xs",l=s?"mt-6":"mt-4";return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`relative ${t} flex items-center justify-center`,children:0===p.currentTrick.length?n.jsx("span",{className:"text-slate-500 "+(s?"":"text-sm"),children:"New Round"}):n.jsx("div",{className:"flex cursor-pointer items-center justify-center max-w-[200px]",onClick:()=>k(!v),children:p.currentTrick.map((e,t)=>{const a=e.cards.length>1,l=p.currentTrick.length,i=(v?-30:-90)*t+-(v?-30*(l-1):-90*(l-1))/2,r=t*(s?4:3);return n.jsx("div",{style:{transform:`translateX(${i}%) translateY(${r}px)`},className:`\n                      flex rounded-lg transition-all duration-300 ease-out\n                      ${a?"bg-slate-700/30 ring-1 ring-slate-600":""}\n                    `,children:e.cards.map((e,s)=>n.jsx(y,{index:s,card:e,delay:50*s},s))},t)})})}),"playing"===p.gamePhase&&n.jsx("div",{className:`${a} border-t ${l} pt-2`,children:A?n.jsx("span",{className:"text-primary-400 font-medium",children:$({en:"Your Turn",vi:"Lượt của bạn"})}):n.jsxs("span",{className:"text-slate-400",children:[$({en:"Turn of",vi:"Lượt của"}),p.players[p.currentTurnIndex]?.username]})})]})},D=e=>{const s="desktop"===e,t=s?"w-12 h-12":"w-8 h-8",a=s?"text-xl":"text-base",l=s?"gap-4":"gap-2";return n.jsxs("div",{className:`flex flex-col items-center ${l}`,children:[n.jsx(h,{className:`${t} text-yellow-400`}),n.jsxs("span",{className:`${a} font-bold text-yellow-400`,children:[p.players.find(e=>e.id===p.winner)?.username," Won!"]})]})},F=(e,s=!1)=>{const t=H[e],a=q>=0;return n.jsx(w,{slot:t.slot,index:t.actualIndex,isCurrentTurn:p.currentTurnIndex===t.actualIndex,isHost:R,gamePhase:p.gamePhase,onAddBot:()=>g.requestAddBot(t.actualIndex),onJoinSlot:()=>g.requestJoinSlot(t.actualIndex,P),onRemove:()=>g.requestRemovePlayer(t.actualIndex),compact:s,isInGame:a,canJoin:!R&&"waiting"===p.gamePhase&&!a&&L},t.actualIndex)};return n.jsxs("div",{className:"flex flex-col h-full p-2 @md:p-4 gap-2 @md:gap-4 overflow-hidden @md:min-h-[500px] pb-10",children:[n.jsxs("div",{className:"flex @md:hidden justify-center gap-2",children:[F(1,!0),F(2,!0),F(3,!0)]}),n.jsx("div",{className:"hidden @md:flex justify-center",children:F(2)}),n.jsxs("div",{className:"hidden @md:flex flex-1 items-center justify-between gap-4",children:[F(1),n.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-4 min-h-[200px] bg-slate-800/30 rounded-2xl p-4",children:["waiting"===p.gamePhase&&n.jsxs("div",{className:"flex flex-col items-center gap-4",children:[n.jsx("span",{className:"text-slate-400",children:$({en:"Waiting for players...",vi:"Đang chờ người chơi..."})}),R&&J&&n.jsxs("button",{onClick:()=>g.requestStartGame(),className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2",children:[n.jsx(r,{className:"w-5 h-5"}),$({en:"Start Game",vi:"Bắt đầu"})]}),R&&!J&&n.jsx("span",{className:"text-sm text-slate-500",children:$({en:"Need at least 2 players",vi:"Cần ít nhất 2 người chơi"})})]}),("playing"===p.gamePhase||"ended"===p.gamePhase)&&n.jsx(n.Fragment,{children:z("desktop")}),"ended"===p.gamePhase&&D("desktop")]}),F(3)]}),n.jsxs("div",{className:"flex @md:hidden flex-1 flex-col items-center justify-center gap-2 bg-slate-800/30 rounded-xl p-2 min-h-[120px]",children:["waiting"===p.gamePhase&&n.jsxs("div",{className:"flex flex-col items-center gap-2",children:[n.jsx("span",{className:"text-slate-400 text-sm",children:$({en:"Waiting for players...",vi:"Đang chờ người chơi..."})}),R&&J&&n.jsxs("button",{onClick:()=>g.requestStartGame(),className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2 text-sm",children:[n.jsx(r,{className:"w-4 h-4"}),$({en:"Start",vi:"Bắt đầu"})]}),R&&!J&&n.jsx("span",{className:"text-xs text-slate-500",children:$({en:"Need at least 2 players",vi:"Cần ít nhất 2 người chơi"})})]}),"playing"===p.gamePhase&&n.jsx(n.Fragment,{children:z("mobile")}),"ended"===p.gamePhase&&D("mobile")]}),n.jsxs("div",{className:"flex flex-col items-center gap-2 @md:gap-4",children:[n.jsx("div",{className:"hidden @md:block",children:F(0)}),n.jsx("div",{className:"flex @md:hidden",children:F(0,!0)}),B&&"playing"===p.gamePhase&&n.jsx("div",{className:"flex justify-center max-w-full overflow-x-auto overflow-y-visible pt-4 p-0 @md:p-4 pb-1",children:B.hand.map((e,s)=>n.jsx(N,{card:e,selected:j.includes(s),onClick:()=>(e=>{A&&"playing"===p.gamePhase&&b(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(s),disabled:!A,index:s},`${e.rank}-${e.suit}`))}),"playing"===p.gamePhase&&A&&n.jsxs("div",{className:"flex flex-col items-center gap-2",children:[M?.valid&&n.jsxs("span",{className:"text-green-400 text-xs @md:text-sm font-medium",children:["✓ ",S({en:"Valid play",vi:"Bài hợp lệ"})]}),!1===M?.valid&&n.jsxs("span",{className:"text-red-400 text-xs @md:text-sm font-medium",children:["⚠️ ",S(M.error)]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>{if(0===j.length||!B)return;const e=j.map(e=>B.hand[e]).sort((e,s)=>e.rank-s.rank);g.requestPlayCards(e),b([])},disabled:0===j.length||!M?.valid,className:"px-4 py-1.5 @md:px-6 @md:py-2 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-900 disabled:cursor-not-allowed rounded-lg font-medium flex items-center gap-1 @md:gap-2 text-sm",children:[n.jsx(r,{className:"w-4 h-4"}),$({en:"Play",vi:"Đánh"})]}),p.lastCombination&&n.jsxs("button",{onClick:async()=>{await t.getState().confirm($({en:"You will not be able to play cards until the next round.",vi:"Bạn sẽ không thể chơi bài cho đến vòng sau."}),$({en:"Pass this round?",vi:"Bỏ lượt này?"}))&&g.requestPass()},className:"px-4 py-1.5 @md:px-6 @md:py-2 bg-red-700 hover:bg-red-600 rounded-lg font-medium flex items-center gap-1 @md:gap-2 text-sm",children:[n.jsx(d,{className:"w-4 h-4"}),$({en:"Pass",vi:"Bỏ lượt"})]})]})]}),"waiting"!==p.gamePhase&&n.jsx("div",{className:"flex gap-2",children:B&&n.jsxs("button",{onClick:async()=>{if(R&&"playing"===p.gamePhase){await G($({en:"This will reset the current game and start fresh.",vi:"Việc này sẽ xoá game hiện tại và bắt đầu lại."}),$({en:"Start New Game?",vi:"Chơi lại?"}))&&g.requestNewGame()}else g.requestNewGame()},className:"px-3 py-1.5 @md:px-4 @md:py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs @md:text-sm flex items-center gap-1 @md:gap-2",children:[n.jsx(c,{className:"w-3 h-3 @md:w-4 @md:h-4"}),$({en:"New game",vi:"Chơi lại"})]})})]}),R&&p.newGameRequest&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 @md:p-6 max-w-sm w-full shadow-xl",children:[n.jsx("h3",{className:"text-base @md:text-lg font-bold mb-3 @md:mb-4",children:$({en:"New Game Request",vi:"Yêu cầu chơi lại"})}),n.jsxs("p",{className:"text-slate-300 mb-4 @md:mb-6 text-sm @md:text-base",children:[n.jsx("span",{className:"font-medium text-white",children:p.newGameRequest.fromName})," ",$({en:"wants to start a new game.",vi:"muốn chơi lại game."})]}),n.jsxs("div",{className:"flex gap-2 @md:gap-3",children:[n.jsxs("button",{onClick:()=>g.declineNewGame(),className:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[n.jsx(o,{className:"w-4 h-4"}),$({en:"Decline",vi:"Từ chối"})]}),n.jsxs("button",{onClick:()=>g.acceptNewGame(),className:"flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[n.jsx(m,{className:"w-4 h-4"}),$({en:"Accept",vi:"Chấp nhận"})]})]})]})}),n.jsx("button",{onClick:()=>T(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-500 transition-colors z-40 shadow-lg border border-slate-500",title:$({en:"Rules",vi:"Luật chơi"}),children:n.jsx(x,{size:24})}),C&&i.createPortal(C?n.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-4",children:n.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full max-h-[85vh] overflow-y-auto shadow-2xl relative",children:[n.jsxs("div",{className:"flex justify-between sticky top-0 p-4 pr-2 bg-slate-900",children:[n.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[n.jsx(x,{className:"w-6 h-6 text-yellow-500"}),S({en:"Game Rules: Thirteen",vi:"Luật Chơi: Tiến Lên Miền Nam"})]}),n.jsx("button",{onClick:()=>T(!1),className:"p-2 hover:bg-white/10 rounded-full transition-colors text-slate-400 hover:text-white",children:n.jsx(o,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"p-4 pt-0 space-y-4 text-slate-300 leading-relaxed",children:n.jsxs("div",{className:"space-y-4",children:[n.jsx("p",{children:S({en:"Thirteen (Tien Len) is a popular climbing card game using a standard 52-card deck. The goal is to be the first to empty your hand.",vi:"Tiến Lên Miền Nam là trò chơi bài phổ biến sử dụng bộ bài 52 lá. Mục tiêu là người đầu tiên đánh hết bài."})}),n.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:S({en:"Card Ranking",vi:"Thứ tự bài"})}),n.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[n.jsx("li",{children:S({en:"Ranks (Low to High): 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K, A, 2.",vi:"Giá trị (Thấp đến Cao): 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K, A, 2."})}),n.jsx("li",{children:S({en:"Suits (Low to High): Spades ♠ < Clubs ♣ < Diamonds ♦ < Hearts ♥.",vi:"Chất (Thấp đến Cao): Bích ♠ < Chuồn ♣ < Rô ♦ < Cơ ♥."})})]}),n.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:S({en:"Combinations",vi:"Kết hợp bài"})}),n.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[n.jsxs("li",{children:[n.jsx("strong",{children:S({en:"Single",vi:"Cóc"})}),":"," ",S({en:"A single card.",vi:"Một lá bài lẻ."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:S({en:"Pair",vi:"Đôi"})}),":"," ",S({en:"Two cards of the same rank.",vi:"2 lá cùng giá trị."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:S({en:"Triple",vi:"3 (Sám cô)"})}),":"," ",S({en:"Three cards of the same rank.",vi:"3 lá cùng giá trị."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:S({en:"Straight",vi:"Sảnh"})}),":"," ",S({en:"3+ consecutive rank cards (e.g., 3-4-5). 2 cannot be in a straight.",vi:"3+ lá liên tiếp (VD: 3-4-5). 2 không được nằm trong sảnh."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:S({en:"Four of a Kind",vi:"Tứ quý"})}),":"," ",S({en:"Four cards of the same rank.",vi:"4 lá cùng giá trị."})]}),n.jsxs("li",{children:[n.jsx("strong",{children:S({en:"Three consecutive pairs",vi:"3 đôi thông"})}),":"," ",S({en:"Three consecutive pairs of cards.",vi:"3 đôi liên tiếp."})]})]}),n.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:S({en:"Gameplay",vi:"Luật chơi"})}),n.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[n.jsx("li",{children:S({en:"Play a combination that is higher (better rank/suit) than the previous one to beat it.",vi:"Đánh bộ bài cao hơn (về giá trị/chất) để chặn bài trước đó."})}),n.jsx("li",{children:S({en:"If everyone passes, the last player to play starts a new round with any combination.",vi:"Nếu tất cả bỏ lượt, người đánh cuối cùng sẽ được đi tiếp với bất kỳ bộ nào."})}),n.jsx("li",{children:S({en:"Special: Four of a Kind cuts a 2. Three consecutive pairs cuts a single 2 or three consecutive pairs.",vi:"Đặc biệt: Tứ quý chặt 2. 3 đôi thông chặt 2 hoặc 3 đôi thông nhỏ hơn."})})]})]})})]})}):null,document.body)]})}function N({card:e,selected:s,onClick:t,disabled:a=!1,index:l=0}){const i=e.suit===f.HEART||e.suit===f.DIAMOND?"text-red-500":"text-slate-800",r=0===l?"ml-0":"-ml-5 @md:-ml-9";return n.jsx("button",{onClick:t,disabled:a,style:{zIndex:l},className:`\n        ${r}\n        w-10 h-16 @md:w-16 @md:h-20\n        bg-white rounded-md @md:rounded-lg shadow-lg\n        border-2 transition-all duration-150 font-bold shrink-0 relative\n        ${s?"border-primary-500 -translate-y-3 ring-2 ring-primary-400 shadow-primary-500/30 shadow-xl z-50":"border-slate-300 hover:border-slate-400"}\n        ${!a&&t?(s?"":"md:hover:-translate-y-1")+" cursor-pointer":"cursor-default"}\n      `,children:n.jsxs("div",{className:`absolute top-0.5 left-1 flex flex-col items-center leading-none ${i}`,children:[n.jsx("span",{className:"text-sm @md:text-lg font-bold",children:j[e.rank]}),n.jsx("span",{className:"text-sm @md:text-sm",children:b[e.suit]})]})})}function y({card:e,delay:s=0,index:t=0}){const a=e.suit===f.HEART||e.suit===f.DIAMOND?"text-red-500":"text-slate-800",l=0===t?"ml-0":"-ml-6 @md:-ml-9";return n.jsx("div",{style:{animationDelay:`${s}ms`},className:`\n        ${l}\n        w-10 h-14 @md:w-16 @md:h-20\n        bg-white rounded-md @md:rounded-lg shadow-lg\n        border-2 border-slate-200 font-bold shrink-0 relative\n        animate-[cardPlay_0.3s_ease-out_forwards]\n      `,children:n.jsxs("div",{className:`absolute top-0.5 left-1 flex flex-col items-center leading-none ${a}`,children:[n.jsx("span",{className:"text-xs @md:text-lg font-bold",children:j[e.rank]}),n.jsx("span",{className:"text-[10px] @md:text-sm",children:b[e.suit]})]})})}function w({slot:e,index:t,isCurrentTurn:a,isHost:l,gamePhase:i,onAddBot:r,onJoinSlot:d,onRemove:c,compact:m=!1,canJoin:x=!1}){const{ts:h}=s(),f=null===e.id,j=l&&"waiting"===i;return n.jsx("div",{className:`\n        ${m?"p-2 min-w-[90px]":"p-2 @md:p-3 min-w-[100px] @md:min-w-[120px]"}\n        rounded-lg @md:rounded-xl transition-all border-2\n        ${e.passed&&"playing"===i?"border-slate-600 bg-slate-900/70 opacity-50":a&&"playing"===i?"border-primary-600 bg-primary-500/10 animate-bounce":"border-slate-700 bg-slate-800/50"}\n        ${f?"border-dashed":""}\n      `,children:f?n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsxs("span",{className:"text-slate-500 text-xs text-center",children:["Slot ",t+1]}),n.jsxs("div",{className:"flex gap-1",children:[j&&n.jsx("button",{onClick:r,className:"flex-1 p-1 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center",title:"Add Bot",children:n.jsx(u,{className:"w-5 h-5"})}),x&&n.jsxs("button",{onClick:d,className:"flex-1 p-1.5 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center gap-1",title:"Join this slot",children:[n.jsx(g,{className:"w-4 h-4"}),h({en:"Join",vi:"Tham gia"})]})]})]}):n.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[e.isBot&&n.jsx(u,{className:"w-5 h-5 text-blue-400"}),e.isGuest&&n.jsx(g,{className:"w-5 h-5 text-green-400"}),e.isHost&&n.jsx(p,{className:"w-5 h-5 text-yellow-400"}),n.jsx("span",{className:"text-xs font-medium",children:e.username}),j&&(e.isBot||e.isGuest)&&n.jsx("button",{onClick:c,className:"p-0.5 hover:bg-slate-700 rounded",title:"Remove",children:n.jsx(o,{className:"w-5 h-5 text-red-400"})})]}),"playing"===i||"ended"===i&&n.jsxs("span",{className:"text-[10px] text-slate-400",children:[e.hand.length," ",h({en:"cards",vi:"lá"})]}),e.passed&&n.jsx("span",{className:"text-[10px] text-yellow-400",children:h({en:"Passed",vi:"Đã bỏ"})})]})})}export{v as default};
