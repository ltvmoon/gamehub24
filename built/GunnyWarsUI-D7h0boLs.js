import{u as e,b as t,j as r,f as n}from"./index-BLcGWsmB.js";import{c as a,ah as s,U as o,aY as l,aZ as c,z as i,a_ as u,a$ as d,ay as f,aA as h,aB as g,aU as m,aV as x,b0 as p,a9 as y,aE as b}from"./react-vendor-DeJ0i39y.js";import"./BaseGame-BoHpQUK3.js";import{G as v,i as w,P as j,g as M,c as N,W as k,a as T,d as L,e as R}from"./constants-Dc6HpWt9.js";import{u as A}from"./useGameState-D1GsuIT1.js";import"./socket-DRbsQkF5.js";import"./zustand-ie0NTbcC.js";let E=performance.now(),C=0;function I({game:I}){const Y=I,{ts:S,ti:P}=e(),{confirm:z}=t(),[X]=A(Y),[O,G]=a.useState({width:800,height:600}),[D,W]=a.useState(!1),[F,B]=a.useState(!0),_=X.tanks[X.currentTurnIndex],U=_?Y.getVisualTank(_):void 0,q=Y.isMyTurn(),[V,H]=a.useState(45),[K,Z]=a.useState(50),$=a.useRef(null),J=a.useRef(null);a.useEffect(()=>{$.current=V},[V]),a.useEffect(()=>{J.current=K},[K]);const Q=a.useRef(null),ee=a.useRef(null),te=a.useRef(null),re=a.useRef([]),ne=a.useRef(null),ae=a.useRef(!0),se=a.useRef(!0),oe=a.useRef({width:0,height:0});a.useEffect(()=>{se.current=F},[F]);const le=a.useRef({x:0,y:0,vx:0,vy:0,zoom:.8,targetZoom:.8,mode:"FOLLOW_PLAYER"}),ce=a.useRef({isDragging:!1,startX:0,startY:0,startCamX:0,startCamY:0,lastX:0,lastY:0,lastTime:0,startPinchDist:0,startZoom:1}),ie=a.useRef({left:!1,right:!1}),ue=a.useRef(new Map),de=a.useRef(null),fe=a.useRef(O);a.useEffect(()=>{fe.current=O},[O]),a.useEffect(()=>{if(0===re.current.length)for(let e=0;e<50;e++)re.current.push({x:2e3*Math.random(),y:1200*Math.random(),size:2*Math.random()+.5,alpha:.6*Math.random()+.2})},[]),a.useEffect(()=>()=>{ne.current&&cancelAnimationFrame(ne.current)},[]);const he=a.useRef(!1);a.useEffect(()=>{if("WAITING"===X.phase)return void(he.current=!1);if(he.current)return;he.current=!0;const e=te.current;if(!e)return;const t=Y.initShaderRenderer(e);ae.current=t,t?console.log("GPU terrain rendering enabled"):console.warn("GPU rendering unavailable, using CPU fallback")},[Y,X.phase]),a.useEffect(()=>{const e=()=>{if(Q.current){const e=D?Q.current.clientHeight:.7*window.innerHeight;G({width:Q.current.clientWidth,height:e})}},t=new ResizeObserver(e);Q.current&&t.observe(Q.current),window.addEventListener("resize",e),e();const r=()=>{W(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",r),()=>{t.disconnect(),window.removeEventListener("resize",e),document.removeEventListener("fullscreenchange",r)}},[X.phase,D]),a.useEffect(()=>{console.warn("useEffect loop");const e=()=>{const e=ee.current;if(!e)return;const n=e.getContext("2d",{alpha:!0});if(!n)return;(()=>{const e=fe.current.width,t=fe.current.height,r=le.current.zoom,n=le.current.targetZoom;let a=r;Math.abs(n-r)>1e-4&&(a=r+.1*(n-r),le.current.zoom=a);const s=e/a,o=t/a,l=s/2,c=o/2;if(ce.current.isDragging)le.current.mode="MANUAL";else if("MANUAL"===le.current.mode){if(le.current.x+=le.current.vx,le.current.y+=le.current.vy,le.current.vx*=.95,le.current.vy*=.95,Math.abs(a-r)>1e-4){const n=le.current.x+e/2/r,a=le.current.y+t/2/r;le.current.x=n-l,le.current.y=a-c}}else{let e=le.current.x,t=le.current.y;if(Y.state.phase===v.IMPACT);else if("FOLLOW_PROJECTILE"===le.current.mode&&Y.projectiles.length>0){const r=Y.projectiles;if(r.length>0)e=r.reduce((e,t)=>e+t.x,0)/r.length-l,t=r.reduce((e,t)=>e+t.y,0)/r.length-c;else{const r=Y.state.tanks[Y.state.currentTurnIndex];r&&(e=r.x-l,t=r.y-c)}}else if("FOLLOW_PLAYER"===le.current.mode){const r=Y.state.tanks[Y.state.currentTurnIndex];if(r){const n=Y.getVisualTank(r);e=n.x-l,t=n.y-c}}else if("FOLLOW_TANK"===le.current.mode&&de.current){const r=Y.state.tanks.find(e=>e.id===de.current);if(r&&r.health>0){const n=Y.getVisualTank(r);e=n.x-l,t=n.y-c;const a=50;n.x>=le.current.x+a&&n.x<=le.current.x+s-a&&n.y>=le.current.y+a&&n.y<=le.current.y+o-a&&(de.current=null,le.current.mode="MANUAL")}else de.current=null,le.current.mode="FOLLOW_PLAYER"}le.current.x+=.08*(e-le.current.x),le.current.y+=.08*(t-le.current.y)}const i=Math.max(0,k-s);le.current.x=Math.max(0,Math.min(le.current.x,i));const u=T-o,d=-T;le.current.y=Math.max(d,Math.min(le.current.y,u))})();const{width:o,height:l}=fe.current,c=le.current.zoom,i=le.current.x,u=le.current.y,d=Y.getTerrainShaderRenderer(),f=se.current&&ae.current&&d?.isReady();if(n.clearRect(0,0,o,l),!f){const e=n.createLinearGradient(0,0,0,l);e.addColorStop(0,"#020617"),e.addColorStop(1,"#172554"),n.fillStyle=e,n.fillRect(0,0,o,l),n.fillStyle="#ffffff";for(const t of re.current){const e=((t.x-.05*i)%o+o)%o,r=((t.y-.05*u)%l+l)%l;n.globalAlpha=t.alpha,n.beginPath(),n.arc(e,r,t.size,0,2*Math.PI),n.fill()}n.globalAlpha=1}if(n.save(),n.scale(c,c),n.translate(-i,-u),f&&d){const e=te.current;e&&(oe.current.width===o&&oe.current.height===l&&e.width===o&&e.height===l||(e.width=o,e.height=l,oe.current={width:o,height:l},d.resize(o,l)),d.render(Y.state.terrainSeed,i,u,o,l,c))}else{const e=Y.getTerrainRenderer(),t=Y.getTerrainMap();e&&t&&e.renderVisibleChunks(n,i,u,o,l,c,t)}const h=o/c,g=l/c,m=Y.getParticleShaderRenderer();if(m&&m.isReady())m.render(Y.particleData,Y.particleCount,i,u,o,l,c);else{const e=50,t=Y.particleData,r=Y.particleCount;for(let a=0;a<r;a++){const r=a*j,s=t[r+0],o=t[r+1];if(s<i-e||s>i+h+e||o<u-e||o>u+g+e)continue;const l=t[r+4],c=t[r+6],d=t[r+11],f=Math.round(255*t[r+8]),m=Math.round(255*t[r+9]),x=Math.round(255*t[r+10]);n.save(),n.globalAlpha=l,d>.5&&(n.globalCompositeOperation="lighter"),n.fillStyle=`rgb(${f},${m},${x})`,n.beginPath(),n.arc(s,o,c,0,2*Math.PI),n.fill(),n.restore()}}const x=100;for(const r of Y.state.tanks){if(r.health<=0)continue;const e=Y.getVisualTank(r);if(e.x<i-x||e.x>i+h+x||e.y<u-x||e.y>u+g+x)continue;const a=e.playerId===Y.userId;t(n,e,a?$.current??e.angle:e.angle,c)}for(const t of Y.projectiles){if(!t.active)continue;if(t.x<i-50||t.x>i+h+50||t.y<u-50||t.y>u+g+50)continue;n.save();const e=w.find(e=>e.type===t.weapon)?.color||"#38bdf8";n.beginPath(),n.arc(t.x,t.y,5,0,2*Math.PI),n.fillStyle=e,n.fill(),n.fillStyle="#fff",n.beginPath(),n.arc(t.x,t.y,2,0,2*Math.PI),n.fill(),n.restore()}const p=Y.state.tanks[Y.state.currentTurnIndex];if(p&&Y.state.phase===v.AIMING){const e=Y.getVisualTank(p),t=Y.isMyTurn();r(n,e,t?$.current??p.angle:p.angle,t?J.current??p.power:p.power)}n.restore(),a(n,i,u,c,o,l),s(n)},t=(e,t,r,n)=>{e.save(),e.translate(t.x,t.y),e.fillStyle=t.color,e.beginPath(),e.arc(0,-10,15,0,Math.PI,!0),e.fillRect(-15,-10,30,10),e.fill(),e.fillStyle="#1e293b",e.fillRect(-18,-5,36,8),e.fillStyle="#475569";for(let s=-15;s<15;s+=6)e.beginPath(),e.arc(s+3,-1,2,0,2*Math.PI),e.fill();e.save(),e.translate(0,-10);const a=r*Math.PI/180;if(e.rotate(-a),e.fillStyle="#e2e8f0",e.fillRect(0,-3,25,6),e.restore(),e.save(),e.scale(1/n,1/n),e.translate(0,-40*n),e.fillStyle="#ffffff",e.font="bold 12px Arial",e.textAlign="center",e.fillText(t.name,0,-10),e.fillStyle="#334155",e.fillRect(-20,0,40,6),e.fillStyle=t.health>30?"#4ade80":"#ef4444",e.fillRect(-19,1,t.health/t.maxHealth*38,4),e.translate(0,8),e.fillStyle="#334155",e.fillRect(-20,0,40,4),e.fillStyle=Y.state.isExploration?"#60a5fa":"#f59e0b",e.fillRect(-19,1,38*(Y.state.isExploration?1:t.fuel/M),2),Y.state.tanks[Y.state.currentTurnIndex]?.id===t.id){e.beginPath(),e.moveTo(0,-15),e.lineTo(-6,-23),e.lineTo(6,-23),e.fillStyle="#facc15",e.fill();const r=N[t.weapon];r&&(e.fillStyle=r.color,e.font="bold 12px Arial",e.textAlign="center",e.fillText(r.name,0,-35))}e.restore(),e.restore()},r=(e,t,r,n)=>{e.beginPath(),e.moveTo(t.x,t.y-10);const a=r*Math.PI/180,s=n/100*L;let o=Math.cos(a)*s,l=-Math.sin(a)*s,c=t.x,i=t.y-10;for(let u=0;u<25;u++)c+=3*o,i+=3*l,l+=3*R,o+=3*Y.state.wind,e.lineTo(c,i);e.strokeStyle="rgba(255, 255, 255, 0.4)",e.lineWidth=2,e.setLineDash([8,6]),e.stroke(),e.setLineDash([])},a=(e,t,r,a,s,o)=>{ue.current.clear();const l=s/a,c=o/a,i=t+20,u=t+l-20,d=r+20,f=r+c-20;for(const h of Y.state.tanks){if(h.health<=0)continue;const g=Y.getVisualTank(h);if(g.x>=i&&g.x<=u&&g.y>=d&&g.y<=f)continue;let m=0,x=0;g.x<i?m=i-g.x:g.x>u&&(m=g.x-u),g.y<d?x=d-g.y:g.y>f&&(x=g.y-f);const p=Math.sqrt(m*m+x*x),y=t+l/2,b=r+c/2,v=g.x-y,w=g.y-b,j=Math.atan2(w,v),M=Math.max(25,Math.min(s-25,(g.x-t)*a)),N=Math.max(25,Math.min(o-25,(g.y-r)*a));e.save(),e.translate(M,N),e.save(),e.rotate(j),e.fillStyle=g.color||"#ef4444",e.beginPath(),e.moveTo(10,0),e.lineTo(-10,7),e.lineTo(-10,-7),e.fill(),e.restore(),e.fillStyle="#fff",e.font="bold 12px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText(`${n(Math.round(p))}m`,0,20),e.restore(),ue.current.set(g.id,{x:M,y:N,radius:25})}},s=e=>{e.fillStyle="#fff",e.font="bold 12px monospace",e.textAlign="left",e.textBaseline="top",e.fillText(`${C.toFixed(0)} FPS`,0,0)};return ne.current=requestAnimationFrame(function t(){const r=performance.now();let n=r-E;E=r,Y.update(),C+=.1*(1e3/n-C),e(),ne.current=requestAnimationFrame(t)}),()=>{ne.current&&cancelAnimationFrame(ne.current)}},[]),a.useEffect(()=>{const e=e=>{"ArrowLeft"===e.key&&(ie.current.left=!0),"ArrowRight"===e.key&&(ie.current.right=!0)," "===e.key&&Y.isMyTurn()&&Y.state.phase===v.AIMING&&(e.preventDefault(),Y.fire())},t=e=>{"ArrowLeft"===e.key&&(ie.current.left=!1),"ArrowRight"===e.key&&(ie.current.right=!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[Y]);const ge=a.useCallback(e=>{if(console.log("move start"),Y.state.phase!==v.AIMING||!Y.isMyTurn())return;const t=Y.getMyTank();t&&(t.isMoving&&t.moveDir===e||(console.log("inside move start"),t.isMoving=!0,t.moveDir=e,Y.moveStart(e),le.current.mode="FOLLOW_PLAYER"))},[Y]),me=a.useCallback(e=>{const t=Y.getMyTank();t&&t.isMoving&&t.moveDir===e&&Y.moveStop()},[Y]);a.useEffect(()=>{const e=e=>{e.repeat||("ArrowLeft"===e.key&&ge(-1),"ArrowRight"===e.key&&ge(1))},t=e=>{"ArrowLeft"===e.key&&me(-1),"ArrowRight"===e.key&&me(1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[Y,ge,me]),a.useEffect(()=>{X.phase===v.PROJECTILE_MOVING||X.phase===v.FIRING||X.phase===v.IMPACT?le.current.mode="FOLLOW_PROJECTILE":X.phase===v.AIMING&&(le.current.mode="FOLLOW_PLAYER")},[X.phase]);const xe=()=>{ce.current.isDragging=!1},pe=e=>{const t=le.current.targetZoom,r="in"===e?Math.min(t+.25,2.5):Math.max(t-.25,.4);le.current.targetZoom=r};return X.phase===v.WAITING?r.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gray-950 text-white p-4",children:[r.jsx("h1",{className:"text-4xl font-black mb-8 bg-gradient-to-r from-blue-400 to-purple-500 text-transparent bg-clip-text",children:"GunnyWars"}),r.jsxs("div",{className:"bg-gray-900 rounded-xl p-6 border border-gray-800 w-full max-w-md",children:[r.jsx("h2",{className:"text-lg font-bold mb-4",children:S({en:"Players",vi:"Người chơi"})}),r.jsxs("div",{className:"space-y-3",children:[X.players.map((e,t)=>r.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800 rounded-lg",children:[e.isBot?r.jsx(s,{size:18,className:"text-red-400"}):r.jsx(o,{size:18,className:0===t?"text-blue-400":"text-emerald-400"}),r.jsx("span",{className:"font-medium",children:e.username||S({en:"Waiting...",vi:"Đang đợi..."})}),0===t&&r.jsx("span",{className:"ml-auto text-xs text-gray-500",children:S({en:"Host",vi:"Chủ phòng"})}),e.isBot&&Y.isHost&&r.jsx("button",{onClick:()=>Y.requestRemoveBot(),className:"ml-auto text-red-400 hover:text-red-300 transition-colors p-2 bg-red-400/20 rounded-lg",children:r.jsx(l,{size:16})})]},(e.id||"bot")+t)),Y.isHost&&r.jsxs("button",{onClick:()=>Y.requestAddBot(),className:"w-full p-3 border border-dashed border-gray-700 rounded-lg text-gray-400 hover:text-white hover:border-gray-500 transition-all flex items-center justify-center gap-2",children:[r.jsx(c,{size:18}),S({en:"Add Bot",vi:"Thêm Bot"})]})]}),Y.isHost&&r.jsxs("div",{className:"flex flex-col gap-2 mt-6",children:[r.jsxs("button",{onClick:()=>Y.startGame(),disabled:!Y.canStartGame(),className:"w-full py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg font-bold flex items-center justify-center gap-2 transition-all active:scale-95",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(i,{size:20}),S({en:"Start Game",vi:"Bắt đầu"})]}),r.jsx("span",{className:"text-[10px] opacity-70 font-normal",children:S({en:"(2+ players)",vi:"(2+ người chơi)"})})]}),r.jsxs("button",{onClick:()=>Y.requestStartExploration(),disabled:X.players.length>1,className:"w-full py-3 bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-400 hover:to-cyan-500 disabled:opacity-50 disabled:grayscale disabled:cursor-not-allowed rounded-lg font-bold flex items-center justify-center gap-2 transition-all active:scale-95",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(u,{size:20}),S({en:"Exploration Mode",vi:"Chế độ khám phá"})]}),r.jsx("span",{className:"text-[10px] opacity-70 font-normal",children:S({en:"(1 player)",vi:"(1 người chơi)"})})]})]})]})]}):r.jsxs("div",{className:"w-full h-full flex flex-col font-sans bg-gray-950 text-gray-100 select-none overflow-hidden",children:[r.jsxs("div",{ref:Q,className:"flex-1 min-h-0 relative cursor-grab active:cursor-grabbing overflow-hidden touch-none "+(D?"":"h-[60vh]!"),onMouseDown:e=>{ce.current.isDragging=!0,ce.current.startX=e.clientX,ce.current.startY=e.clientY,ce.current.startCamX=le.current.x,ce.current.startCamY=le.current.y,ce.current.lastX=e.clientX,ce.current.lastY=e.clientY,ce.current.lastTime=performance.now(),le.current.vx=0,le.current.vy=0},onMouseMove:e=>{if(ce.current.isDragging){const t=performance.now(),r=Math.max(1,t-ce.current.lastTime),n=le.current.zoom,a=(e.clientX-ce.current.startX)/n,s=(e.clientY-ce.current.startY)/n,o=(ce.current.lastX-e.clientX)/n*(16/r),l=(ce.current.lastY-e.clientY)/n*(16/r);le.current.vx=.4*le.current.vx+.6*o,le.current.vy=.4*le.current.vy+.6*l,le.current.x=ce.current.startCamX-a,le.current.y=ce.current.startCamY-s,ce.current.lastX=e.clientX,ce.current.lastY=e.clientY,ce.current.lastTime=t}},onMouseUp:xe,onMouseLeave:xe,onTouchStart:e=>{const t=e.touches[0];ce.current.isDragging=!0,ce.current.startX=t.clientX,ce.current.startY=t.clientY,ce.current.startCamX=le.current.x,ce.current.startCamY=le.current.y,ce.current.lastX=t.clientX,ce.current.lastY=t.clientY,ce.current.lastTime=performance.now(),le.current.vx=0,le.current.vy=0},onTouchMove:e=>{if(ce.current.isDragging){const t=performance.now(),r=Math.max(1,t-ce.current.lastTime),n=e.touches[0],a=le.current.zoom,s=(n.clientX-ce.current.startX)/a,o=(n.clientY-ce.current.startY)/a,l=(ce.current.lastX-n.clientX)/a*(16/r),c=(ce.current.lastY-n.clientY)/a*(16/r);le.current.vx=.4*le.current.vx+.6*l,le.current.vy=.4*le.current.vy+.6*c,le.current.x=ce.current.startCamX-s,le.current.y=ce.current.startCamY-o,ce.current.lastX=n.clientX,ce.current.lastY=n.clientY,ce.current.lastTime=t}},onTouchEnd:e=>{if(0===e.touches.length)ce.current.isDragging=!1;else{const t=e.touches[0];ce.current.isDragging=!0,ce.current.startX=t.clientX,ce.current.startY=t.clientY,ce.current.startCamX=le.current.x,ce.current.startCamY=le.current.y}},children:[r.jsx("canvas",{ref:te,width:O.width,height:O.height,className:"absolute inset-0 block",style:{zIndex:0}}),r.jsx("canvas",{ref:ee,width:O.width,height:O.height,className:"absolute inset-0 block",onClick:e=>{if(Math.sqrt(Math.pow(e.clientX-ce.current.startX,2)+Math.pow(e.clientY-ce.current.startY,2))>5)return;const t=ee.current;if(!t)return;const r=t.getBoundingClientRect(),n=e.clientX-r.left,a=e.clientY-r.top;for(const[s,o]of ue.current){const e=n-o.x,t=a-o.y;if(Math.sqrt(e*e+t*t)<=o.radius)return de.current=s,void(le.current.mode="FOLLOW_TANK")}},onTouchEnd:e=>{if(Math.sqrt(Math.pow((e.changedTouches[0]?.clientX||0)-ce.current.startX,2)+Math.pow((e.changedTouches[0]?.clientY||0)-ce.current.startY,2))>10)return;const t=ee.current;if(!t||!e.changedTouches[0])return;const r=e.changedTouches[0],n=t.getBoundingClientRect(),a=r.clientX-n.left,s=r.clientY-n.top;for(const[o,l]of ue.current){const e=a-l.x,t=s-l.y;if(Math.sqrt(e*e+t*t)<=l.radius)return de.current=o,void(le.current.mode="FOLLOW_TANK")}},style:{zIndex:1}}),r.jsx("div",{style:{width:O.width,height:O.height}}),r.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-black/50 backdrop-blur-md px-6 py-2 rounded-full border border-gray-700 flex items-center gap-3 shadow-lg pointer-events-none",children:[r.jsx("span",{className:"text-xs font-bold text-gray-400 tracking-wider",children:P({en:"WIND",vi:"GIÓ"})}),r.jsxs("span",{className:"font-mono font-bold text-lg "+(X.wind>0?"text-green-400":"text-red-400"),children:[Math.abs(Math.round(100*X.wind))," ",X.wind>0?"→":"←"]})]}),r.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-row gap-1 z-20 opacity-30 hover:opacity-100 transition-all duration-300",children:[r.jsx("button",{onClick:async()=>{await z(S({en:"Return to main menu?",vi:"Quay lại màn hình menu?"}),S({en:"Back to Menu",vi:"Quay lại Menu"}))&&Y.requestReset()},className:"bg-red-800/80 hover:bg-red-700 p-2 rounded-full border border-red-600 text-red-200 shadow-lg backdrop-blur-sm transition-transform active:scale-95",title:"Exit to Menu",children:r.jsx(d,{size:18})}),Y.isHost&&r.jsx("button",{onClick:async()=>{await z(S({en:"Map will be randomly regenerated",vi:"Bản đồ sẽ được tạo mới ngẫu nhiên"}),S({en:"Regenerate map?",vi:"Tạo map mới?"}))&&Y.requestRegenerateMap()},className:"bg-purple-800/80 hover:bg-purple-700 p-2 rounded-full border border-purple-600 text-purple-200 shadow-lg backdrop-blur-sm transition-transform active:scale-95",title:"Regenerate Map",children:r.jsx(f,{size:18})}),r.jsx("button",{onClick:()=>B(!F),className:"px-3 py-2 rounded-full border text-xs font-bold shadow-lg backdrop-blur-sm transition-all active:scale-95 "+(F?"bg-green-800/80 hover:bg-green-700 border-green-600 text-green-200":"bg-amber-800/80 hover:bg-amber-700 border-amber-600 text-amber-200"),children:F?"GPU":"CPU"}),r.jsx("button",{onClick:()=>pe("in"),className:"bg-gray-800/80 hover:bg-gray-700 p-2 rounded-full border border-gray-600 text-white shadow-lg backdrop-blur-sm transition-transform active:scale-95",children:r.jsx(h,{size:18})}),r.jsx("button",{onClick:()=>pe("out"),className:"bg-gray-800/80 hover:bg-gray-700 p-2 rounded-full border border-gray-600 text-white shadow-lg backdrop-blur-sm transition-transform active:scale-95",children:r.jsx(g,{size:18})}),r.jsx("button",{onClick:async()=>{document.fullscreenElement?(await document.exitFullscreen(),W(!1)):(await(Q.current?.parentElement?.requestFullscreen()),W(!0))},className:"bg-gray-800/80 hover:bg-gray-700 p-2 rounded-full border border-gray-600 text-white shadow-lg backdrop-blur-sm transition-transform active:scale-95",children:D?r.jsx(m,{size:18}):r.jsx(x,{size:18})})]}),r.jsxs("div",{className:"absolute top-4 right-4 text-gray-500 text-xs flex items-center gap-2 pointer-events-none opacity-50",children:[r.jsx(p,{size:14})," ",S({en:"Drag to pan camera",vi:"Kéo để di chuyển camera"})]}),X.phase===v.GAME_OVER&&r.jsxs("div",{className:"absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-50",children:[r.jsxs("h1",{className:"text-5xl @md:text-7xl font-black mb-6 bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-600 text-transparent bg-clip-text",children:[X.winner," ",S({en:"WINS",vi:"THẮNG"})]}),r.jsxs("button",{onClick:()=>Y.requestReset(),className:"px-10 py-4 bg-white text-black font-black text-xl tracking-widest hover:scale-105 transition-transform flex items-center gap-2",children:[r.jsx(f,{size:24}),S({en:"PLAY AGAIN",vi:"CHƠI LẠI"})]})]})]}),r.jsx("div",{className:"bg-gray-900 border-t border-gray-800 p-2 @md:p-4 shadow-[0_-10px_40px_rgba(0,0,0,0.5)] z-10 shrink-0",children:r.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col gap-3",children:[r.jsxs("div",{className:"grid grid-cols-12 gap-2 @md:gap-4 items-stretch",children:[!X.isExploration&&r.jsx("div",{className:"col-span-12 @md:col-span-3 bg-gray-800/50 rounded-lg p-2 border border-gray-700 flex items-center justify-center gap-2 cursor-pointer hover:bg-gray-700/50 transition-colors",onClick:()=>{U&&(de.current=U.id,le.current.mode="FOLLOW_TANK")},children:r.jsxs("div",{className:"flex items-center gap-2",children:[U?.isBot?r.jsx(s,{size:18,style:{color:U?.color||"#f87171"}}):r.jsx(o,{size:18,style:{color:U?.color||(q?"#60a5fa":"#f87171")}}),r.jsx("span",{className:"font-bold uppercase tracking-wider text-xs @md:text-sm",style:{color:U?.color||(q?"#60a5fa":"#f87171")},children:X.isExploration?S({en:"Exploration",vi:"Khám phá"}):X.players.find(e=>e.tankId===U?.id)?.username||(U?.isBot?"Bot":S({en:"Turn",vi:"Lượt"}))})]})}),r.jsxs("div",{className:"col-span-6 @md:col-span-3 flex gap-1 "+(q&&X.phase===v.AIMING?"":"opacity-40 pointer-events-none grayscale"),children:[r.jsx("button",{className:"flex-1 bg-gray-800 hover:bg-gray-700 active:bg-blue-600 active:text-white rounded border border-gray-700 flex items-center justify-center transition-colors",onMouseDown:()=>ge(-1),onMouseUp:()=>me(-1),onMouseLeave:()=>me(-1),onTouchStart:e=>{e.preventDefault(),ge(-1)},onTouchEnd:e=>{e.preventDefault(),me(-1)},children:r.jsx(y,{size:20})}),r.jsx("button",{className:"flex-1 bg-gray-800 hover:bg-gray-700 active:bg-blue-600 active:text-white rounded border border-gray-700 flex items-center justify-center transition-colors",onMouseDown:()=>ge(1),onMouseUp:()=>me(1),onMouseLeave:()=>me(1),onTouchStart:e=>{e.preventDefault(),ge(1)},onTouchEnd:e=>{e.preventDefault(),me(1)},children:r.jsx(b,{size:20})})]}),r.jsx("div",{className:"col-span-6 @md:col-span-6 "+(q&&X.phase===v.AIMING?"":"opacity-40 pointer-events-none grayscale"),children:r.jsx("button",{onClick:()=>Y.fire(),className:"w-full h-full min-h-[44px] bg-gradient-to-b from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white font-black text-lg tracking-widest rounded-lg shadow-lg active:scale-95 transition-transform border-t border-red-400 flex items-center justify-center",children:S({en:"FIRE",vi:"BẮN"})})})]}),r.jsxs("div",{className:"grid grid-cols-12 gap-2 @md:gap-4 items-center "+(q&&X.phase===v.AIMING?"":"opacity-40 pointer-events-none grayscale"),children:[r.jsxs("div",{className:"col-span-12 @md:col-span-7 grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"flex-1 space-y-1",children:[r.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-gray-400",children:[r.jsx("span",{children:S({en:"ANG",vi:"GÓC"})}),r.jsxs("span",{className:"text-blue-400",children:[Math.round(V??U?.angle??0),"°"]})]}),r.jsx("input",{type:"range",min:"0",max:"180",value:180-(V??U?.angle??0),onChange:e=>{const t=180-parseInt(e.target.value);H(t)},onMouseUp:()=>{null!==V&&(Y.commitAngle(V),H(null))},onTouchEnd:()=>{null!==V&&(Y.commitAngle(V),H(null))},className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"})]}),r.jsxs("div",{className:"flex-1 space-y-1",children:[r.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-gray-400",children:[r.jsx("span",{children:S({en:"PWR",vi:"LỰC"})}),r.jsx("span",{className:"text-red-400",children:Math.round(K??U?.power??0)})]}),r.jsx("input",{type:"range",min:"0",max:"100",value:K??U?.power??0,onChange:e=>{const t=parseInt(e.target.value);Z(t)},onMouseUp:()=>{null!==K&&(Y.commitPower(K),Z(null))},onTouchEnd:()=>{null!==K&&(Y.commitPower(K),Z(null))},className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-red-500"})]})]}),r.jsx("div",{className:"col-span-12 @md:col-span-5 flex gap-1 overflow-x-auto pb-1 no-scrollbar",children:w.map(e=>r.jsx("button",{onClick:()=>Y.selectWeapon(e.type),className:"flex-1 min-w-[60px] py-1.5 text-[10px] font-bold border rounded transition-all whitespace-nowrap cursor-pointer hover:bg-slate-600",style:{backgroundColor:U?.weapon===e.type?e.color:void 0,borderColor:U?.weapon===e.type?e.color:void 0,color:U?.weapon===e.type?"white":"#9ca3af"},children:e.name},e.type))})]})]})})]})}export{I as default};
