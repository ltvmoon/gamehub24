import{B as t}from"./BaseGame-DNUNIW8N.js";import{I as e,H as s,S as a}from"./types-C-uNVF7e.js";import{d as n,R as r,S as i,e as l}from"./types-qIwhz3td.js";import"./socket-DRbsQkF5.js";import"./index-DeW22Zn2.js";import"./react-vendor-BeKtp5AY.js";import"./zustand-C88HNARu.js";class o extends t{deck=[];timer=null;isGameOver(t){return"ended"===t.gamePhase}getMyPlayerIndex(){return this.state.players.findIndex(t=>t.id===this.userId)}getUserId(){return this.userId}getInitState(){const t=Array(4).fill(null).map((t,e)=>this.createEmptyPlayer(e));return this.players&&this.players.length>0&&this.players.forEach(e=>{const s=t.findIndex(t=>null===t.id);-1!==s&&(t[s]={...t[s],id:e.id,username:e.username||`Player ${e.id.substr(0,4)}`})}),{players:t,gamePhase:"waiting",timerEndsAt:0,roundResults:[],roundNumber:0}}createEmptyPlayer(t){return{id:null,username:`Seat ${t+1}`,hand:[],front:[],middle:[],back:[],isBot:!1,isReady:!1,score:0,isFouled:!1,instantWin:e.NONE,usedAuto:!1}}onSocketGameAction(t){if(!this.isHost)return;const e=t.action;switch(e.type){case"START_GAME":this.startGame();break;case"ARRANGE_CARDS":this.handleArrangeCards(e.playerId,e.front,e.middle,e.back,e.isAuto);break;case"AUTO_ARRANGE":this.handleAutoArrange(e.playerId);break;case"DECLARE_INSTANT_WIN":this.handleDeclareInstantWin(e.playerId);break;case"ADD_BOT":this.addBot(e.slotIndex);break;case"RESET_GAME":this.resetGame();break;case"JOIN_SLOT":this.joinSlot(e.slotIndex,e.playerId,e.playerName);break;case"REMOVE_PLAYER":this.removePlayer(e.slotIndex)}}updatePlayers(t){if(console.log("updatePlayers",t),!this.isHost)return;const e="waiting"===this.state.gamePhase;for(const s of t){const t=this.state.players.findIndex(t=>t.id===s.id);if(-1!==t)this.state.players[t].username=s.username||this.state.players[t].username;else if(e){const t=this.state.players.findIndex(t=>null===t.id);-1!==t&&(this.state.players[t].id=s.id,this.state.players[t].username=s.username||`Player ${s.id.substr(0,4)}`)}}if(e){const e=new Set(t.map(t=>t.id));this.state.players.forEach((t,s)=>{!t.id||t.isBot||e.has(t.id)||this.removePlayer(s)})}}startGame(){this.state.players.filter(t=>null!==t.id).length<2||(this.state.roundNumber++,this.deck=this.createDeck(),this.shuffleDeck(this.deck),this.state.gamePhase="arranging",this.state.timerEndsAt=Date.now()+9e4,this.state.roundResults=[],this.state.players.forEach(t=>{if(null!==t.id){t.hand=[],t.front=[],t.middle=[],t.back=[],t.isReady=!1,t.isFouled=!1,t.instantWin=e.NONE,t.usedAuto=!1;for(let e=0;e<13;e++)t.hand.push(this.deck.pop());t.hand.sort((t,e)=>n(e).rank-n(t).rank)}}),this.state.players.forEach(t=>{if(t.id&&t.isBot){const s=this.generateSuggestions(t.hand);let a=s[0],n=-1/0;for(const t of s){const e=3*this.evaluate5CardHand(t.back).value+2*this.evaluate5CardHand(t.middle).value+this.evaluate3CardHand(t.front).value;e>n&&(n=e,a=t)}t.front=a.front,t.middle=a.middle,t.back=a.back,t.instantWin=this.checkInstantWin(t.hand,t.front,t.middle,t.back),t.isFouled=t.instantWin===e.NONE&&!this.isValidArrangement(t.front,t.middle,t.back),t.isReady=!0}}),this.startTimer())}startTimer(){this.clearTimer(),this.timer=setInterval(()=>{"arranging"===this.state.gamePhase?Date.now()>=this.state.timerEndsAt&&(this.clearTimer(),this.forceSubmitAll()):this.clearTimer()},500)}clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}forceSubmitAll(){this.state.players.forEach(t=>{if(t.id&&!t.isReady){const s=this.autoArrange(t.hand);t.front=s.front,t.middle=s.middle,t.back=s.back,t.instantWin=this.checkInstantWin(t.hand,t.front,t.middle,t.back),t.isFouled=t.instantWin===e.NONE&&!this.isValidArrangement(t.front,t.middle,t.back),t.usedAuto=!0,t.isReady=!0}}),this.compareHands()}handleArrangeCards(t,s,a,n,r){if("arranging"!==this.state.gamePhase)return;const i=this.state.players.findIndex(e=>e.id===t);if(-1===i)return;const l=this.state.players[i];if(l.isReady)return;const o=[...s,...a,...n];if(13!==o.length||3!==s.length||5!==a.length||5!==n.length)return;const d=new Set(l.hand);o.every(t=>d.has(t))&&(l.front=s,l.middle=a,l.back=n,l.usedAuto=r,l.instantWin=this.checkInstantWin(l.hand,s,a,n),l.isFouled=l.instantWin===e.NONE&&!this.isValidArrangement(s,a,n),l.isReady=!0,this.checkAllReady())}handleAutoArrange(t){if("arranging"!==this.state.gamePhase)return;const e=this.state.players.findIndex(e=>e.id===t);if(-1===e)return;const s=this.state.players[e];if(s.isReady)return;const a=this.autoArrange(s.hand);s.front=a.front,s.middle=a.middle,s.back=a.back,s.instantWin=this.checkInstantWin(s.hand,s.front,s.middle,s.back),s.isFouled=!1,s.usedAuto=!0,s.isReady=!0,this.checkAllReady()}handleDeclareInstantWin(t){if("arranging"!==this.state.gamePhase)return;const s=this.state.players.findIndex(e=>e.id===t);if(-1===s)return;const a=this.state.players[s];if(a.isReady)return;const n=this.checkInstantWinRaw(a.hand);if(n===e.NONE)return;const r=this.autoArrange(a.hand);a.front=r.front,a.middle=r.middle,a.back=r.back,a.instantWin=n,a.isFouled=!1,a.isReady=!0,this.checkAllReady()}checkAllReady(){this.state.players.filter(t=>null!==t.id).every(t=>t.isReady)&&(this.clearTimer(),this.compareHands())}checkInstantWinRaw(t){return 13!==t.length?e.NONE:this.isDragon(t)?e.DRAGON:this.isSameColor(t,13)?e.SAME_COLOR_13:this.isSameColor(t,12)?e.SAME_COLOR_12:this.isSixPairs(t)?e.SIX_PAIRS:e.NONE}checkInstantWin(t,s,a,n){const r=this.checkInstantWinRaw(t);return r!==e.NONE?r:this.isThreeFlushes(s,a,n)?e.THREE_FLUSHES:this.isThreeStraights(s,a,n)?e.THREE_STRAIGHTS:e.NONE}isDragon(t){const e=t.map(t=>n(t).rank).sort((t,e)=>t-e);for(let s=0;s<13;s++)if(e[s]!==s+2)return!1;return new Set(t.map(t=>n(t).suit)).size>1}isSameColor(t,e){let s=0,a=0;return t.forEach(t=>{const{suit:e}=n(t);e===i.DIAMOND||e===i.HEART?s++:a++}),s>=e||a>=e}isSixPairs(t){const e={};t.forEach(t=>{const{rank:s}=n(t);e[s]=(e[s]||0)+1});const s=Object.values(e),a=s.filter(t=>t>=2),r=s.filter(t=>t>=3);return a.length>=6||a.length>=5&&r.length>=1}isThreeFlushes(t,e,s){const a=t=>{if(t.length<3)return!1;return 1===new Set(t.map(t=>n(t).suit)).size};return a(t)&&a(e)&&a(s)}isThreeStraights(t,e,s){const a=t=>{const e=t.map(t=>n(t).rank).sort((t,e)=>t-e);return 3===t.length?e[2]-e[0]===2&&3===new Set(e).size:e[4]-e[0]===4&&5===new Set(e).size||e[0]===r.TWO&&e[1]===r.THREE&&e[2]===r.FOUR&&e[3]===r.FIVE&&e[4]===r.ACE};return a(t)&&a(e)&&a(s)}isValidArrangement(t,e,s){if(3!==t.length||5!==e.length||5!==s.length)return!1;const a=this.evaluate3CardHand(t).value,n=this.evaluate5CardHand(e).value;return this.evaluate5CardHand(s).value>=n&&n>=a}evaluate3CardHand(t){const e=[...t].sort((t,e)=>n(e).rank-n(t).rank),a=e.map(t=>n(t).rank);return a[0]===a[1]&&a[1]===a[2]?{rank:s.THREE_OF_A_KIND,value:1e8*s.THREE_OF_A_KIND+1e4*a[0],cards:e}:a[0]===a[1]?{rank:s.PAIR,value:1e8*s.PAIR+1e4*a[0]+a[2],cards:e}:a[1]===a[2]?{rank:s.PAIR,value:1e8*s.PAIR+1e4*a[1]+a[0],cards:[e[1],e[2],e[0]]}:{rank:s.HIGH_CARD,value:1e8*s.HIGH_CARD+1e4*a[0]+15*a[1]+a[2],cards:e}}evaluate5CardHand(t){const e=[...t].sort((t,e)=>n(e).rank-n(t).rank),a=e.map(t=>n(t).rank),i=e.map(t=>n(t).suit),l=1===new Set(i).size,o=[...new Set(a)].sort((t,e)=>e-t);let d=!1,u=0;if(5===o.length&&(o[0]-o[4]===4&&(d=!0,u=o[0]),d||o[0]!==r.ACE||o[1]!==r.FIVE||o[4]!==r.TWO||(d=!0,u=5)),l&&d)return{rank:s.STRAIGHT_FLUSH,value:1e8*s.STRAIGHT_FLUSH+1e4*u,cards:e};const h={};a.forEach(t=>h[t]=(h[t]||0)+1);const c=Object.entries(h).map(([t,e])=>({rank:Number(t),count:e})).sort((t,e)=>e.count-t.count||e.rank-t.rank);if(4===c[0]?.count)return{rank:s.FOUR_OF_A_KIND,value:1e8*s.FOUR_OF_A_KIND+1e4*c[0].rank+c[1].rank,cards:e};if(3===c[0]?.count&&2===c[1]?.count)return{rank:s.FULL_HOUSE,value:1e8*s.FULL_HOUSE+1e4*c[0].rank+c[1].rank,cards:e};if(l){let t=1e8*s.FLUSH;return o.forEach((e,s)=>t+=e*Math.pow(15,4-s)),{rank:s.FLUSH,value:t,cards:e}}if(d)return{rank:s.STRAIGHT,value:1e8*s.STRAIGHT+1e4*u,cards:e};if(3===c[0].count){let t=1e8*s.THREE_OF_A_KIND+1e4*c[0].rank;return c.filter(t=>3!==t.count).sort((t,e)=>e.rank-t.rank).forEach((e,s)=>t+=e.rank*Math.pow(15,1-s)),{rank:s.THREE_OF_A_KIND,value:t,cards:e}}if(2===c[0]?.count&&2===c[1]?.count){const t=Math.max(c[0]?.rank,c[1]?.rank),a=Math.min(c[0]?.rank,c[1]?.rank),n=c.find(t=>1===t.count).rank;return{rank:s.TWO_PAIR,value:1e8*s.TWO_PAIR+1e4*t+15*a+n,cards:e}}if(2===c[0]?.count){let t=1e8*s.PAIR+1e4*c[0].rank;return c.filter(t=>1===t.count).sort((t,e)=>e.rank-t.rank).forEach((e,s)=>t+=e.rank*Math.pow(15,2-s)),{rank:s.PAIR,value:t,cards:e}}let f=1e8*s.HIGH_CARD;return o.forEach((t,e)=>f+=t*Math.pow(15,4-e)),{rank:s.HIGH_CARD,value:f,cards:e}}compareHands(){this.state.gamePhase="comparing";const t=this.state.players.map((t,e)=>({player:t,index:e})).filter(({player:t})=>null!==t.id),e=[];for(let s=0;s<t.length;s++)for(let a=s+1;a<t.length;a++){const n=t[s],r=t[a],i=this.compareTwoPlayers(n.player,n.index,r.player,r.index);e.push(i)}this.state.roundResults=e;for(const s of e)this.state.players[s.p1Index].score+=s.p1Total,this.state.players[s.p2Index].score+=s.p2Total;for(const s of t){const n=e.filter(t=>t.p1Index===s.index||t.p2Index===s.index);if(n.every(t=>t.p1Index===s.index?t.frontResult>0&&t.middleResult>0&&t.backResult>0:t.frontResult<0&&t.middleResult<0&&t.backResult<0)&&n.length>0&&t.length>2){const e=a.SCOOP_ALL;s.player.score+=e;for(const a of t)a.index!==s.index&&(this.state.players[a.index].score-=Math.floor(e/(t.length-1)))}}for(const s of t)if(!s.player.usedAuto&&!s.player.isBot&&!s.player.isFouled){e.filter(t=>t.p1Index===s.index||t.p2Index===s.index).reduce((t,e)=>t+(e.p1Index===s.index?e.p1Total:e.p2Total),0)>0&&(s.player.score+=1)}this.state.gamePhase="ended"}compareTwoPlayers(t,n,r,i){const l={p1Index:n,p2Index:i,frontResult:0,middleResult:0,backResult:0,p1Bonus:0,p2Bonus:0,p1Total:0,p2Total:0};if(t.instantWin!==e.NONE&&r.instantWin!==e.NONE)t.instantWin>r.instantWin?(l.frontResult=1,l.middleResult=1,l.backResult=1):t.instantWin<r.instantWin&&(l.frontResult=-1,l.middleResult=-1,l.backResult=-1);else if(t.instantWin!==e.NONE)l.frontResult=1,l.middleResult=1,l.backResult=1;else if(r.instantWin!==e.NONE)l.frontResult=-1,l.middleResult=-1,l.backResult=-1;else if(t.isFouled&&r.isFouled);else if(t.isFouled)l.frontResult=-1,l.middleResult=-1,l.backResult=-1;else if(r.isFouled)l.frontResult=1,l.middleResult=1,l.backResult=1;else{const e=this.evaluate3CardHand(t.front),n=this.evaluate3CardHand(r.front);l.frontResult=e.value>n.value?1:e.value<n.value?-1:0;const i=this.evaluate5CardHand(t.middle),o=this.evaluate5CardHand(r.middle);l.middleResult=i.value>o.value?1:i.value<o.value?-1:0;const d=this.evaluate5CardHand(t.back),u=this.evaluate5CardHand(r.back);l.backResult=d.value>u.value?1:d.value<u.value?-1:0,1===l.frontResult&&e.rank===s.THREE_OF_A_KIND&&(l.p1Bonus+=a.THREE_OF_KIND_FRONT),1===l.middleResult&&(i.rank===s.FULL_HOUSE&&(l.p1Bonus+=a.FULL_HOUSE_MIDDLE),i.rank===s.FOUR_OF_A_KIND&&(l.p1Bonus+=a.FOUR_KIND_MIDDLE),i.rank===s.STRAIGHT_FLUSH&&(l.p1Bonus+=a.STRAIGHT_FLUSH_MIDDLE)),1===l.backResult&&(d.rank===s.FOUR_OF_A_KIND&&(l.p1Bonus+=a.FOUR_KIND_BACK),d.rank===s.STRAIGHT_FLUSH&&(l.p1Bonus+=a.STRAIGHT_FLUSH_BACK)),-1===l.frontResult&&n.rank===s.THREE_OF_A_KIND&&(l.p2Bonus+=a.THREE_OF_KIND_FRONT),-1===l.middleResult&&(o.rank===s.FULL_HOUSE&&(l.p2Bonus+=a.FULL_HOUSE_MIDDLE),o.rank===s.FOUR_OF_A_KIND&&(l.p2Bonus+=a.FOUR_KIND_MIDDLE),o.rank===s.STRAIGHT_FLUSH&&(l.p2Bonus+=a.STRAIGHT_FLUSH_MIDDLE)),-1===l.backResult&&(u.rank===s.FOUR_OF_A_KIND&&(l.p2Bonus+=a.FOUR_KIND_BACK),u.rank===s.STRAIGHT_FLUSH&&(l.p2Bonus+=a.STRAIGHT_FLUSH_BACK))}const o=[l.frontResult,l.middleResult,l.backResult].filter(t=>t>0).length,d=[l.frontResult,l.middleResult,l.backResult].filter(t=>t<0).length,u=l.frontResult+l.middleResult+l.backResult;let h=0,c=0;return 3===o&&(h=a.SCOOP),3===d&&(c=a.SCOOP),l.p1Total=u+l.p1Bonus+h-l.p2Bonus-c,l.p2Total=-u+l.p2Bonus+c-l.p1Bonus-h,l}autoArrange(t){const e=this.generateSuggestions(t);return{front:e[0].front,middle:e[0].middle,back:e[0].back}}generateSuggestions(t){const e=[],s=this.arrangeBalanced(t);s&&e.push(this.makeSuggestion(s,{en:"âš–ï¸ Balanced",vi:"âš–ï¸ CÃ¢n báº±ng"}));const a=this.arrangeBackHeavy(t);a&&e.push(this.makeSuggestion(a,{en:"ðŸ’ª Strong Back",vi:"ðŸ’ª Máº¡nh chi Ä‘áº§u"}));const r=this.arrangeFrontHeavy(t);r&&e.push(this.makeSuggestion(r,{en:"ðŸŽ¯ Strong Front",vi:"ðŸŽ¯ Máº¡nh chi cuá»‘i"}));const i=[],l=new Set;for(const n of e){if(!this.isValidArrangement(n.front,n.middle,n.back))continue;const t=[...n.back,...n.middle,...n.front].join(",");l.has(t)||(l.add(t),i.push(n))}if(0===i.length){const e=[...t].sort((t,e)=>n(e).rank-n(t).rank);i.push(this.makeSuggestion({back:e.slice(0,5),middle:e.slice(5,10),front:e.slice(10,13)},{en:"ðŸ“‹ Default",vi:"ðŸ“‹ Máº·c Ä‘á»‹nh"}))}return i}makeSuggestion(t,e){const s=this.evaluate3CardHand(t.front),a=this.evaluate5CardHand(t.middle),n=this.evaluate5CardHand(t.back);return{label:e,front:t.front,middle:t.middle,back:t.back,frontRank:s.rank,middleRank:a.rank,backRank:n.rank}}arrangeBalanced(t){const e=[...t].sort((t,e)=>n(e).rank-n(t).rank),s=this.groupByRank(e),a=[],r=[],i=[],l=[];if(s.quads.length>0){a.push(...s.quads[0]);for(let t=1;t<s.quads.length;t++)l.push(...s.quads[t])}if(s.trips.length>0){0===a.length?a.push(...s.trips[0]):r.push(...s.trips[0]);for(let t=1;t<s.trips.length;t++)l.push(...s.trips[t])}for(let n=0;n<s.pairs.length;n++)a.length<5&&a.length>=3?a.push(...s.pairs[n]):r.length<5?r.push(...s.pairs[n]):i.length<3?i.push(...s.pairs[n]):l.push(...s.pairs[n]);for(l.push(...s.singles),l.sort((t,e)=>n(e).rank-n(t).rank),this.tryUpgrade5(a,l),this.tryUpgrade5(r,l);a.length<5&&l.length>0;)a.push(l.shift());for(;r.length<5&&l.length>0;)r.push(l.shift());for(;i.length<3&&l.length>0;)i.push(l.shift());return this.sortHand(a),this.sortHand(r),this.sortHand(i),this.isValidArrangement(i,r,a)?{front:i,middle:r,back:a}:this.fixArrangement(t)}arrangeBackHeavy(t){const e=[...t].sort((t,e)=>n(e).rank-n(t).rank),s=this.findFlush(e,5);if(s){const t=e.filter(t=>!s.includes(t)),a=t.slice(0,5),n=t.slice(5,8);if(this.sortHand(s),this.sortHand(a),this.sortHand(n),this.isValidArrangement(n,a,s))return{front:n,middle:a,back:s}}const a=this.findStraight(e,5);if(a){const t=e.filter(t=>!a.includes(t)),s=t.slice(0,5),n=t.slice(5,8);if(this.sortHand(a),this.sortHand(s),this.sortHand(n),this.isValidArrangement(n,s,a))return{front:n,middle:s,back:a}}const r=this.groupByRank(e),i=[],l=[];for(const n of r.quads)i.push(...n);for(const n of r.trips)i.length<5?i.push(...n):l.push(...n);for(const n of r.pairs)i.length<5?i.push(...n):l.push(...n);for(l.push(...r.singles),l.sort((t,e)=>n(e).rank-n(t).rank);i.length<5&&l.length>0;)i.push(l.shift());for(;i.length>5;)l.unshift(i.pop());const o=l.splice(0,5),d=l.splice(0,3);return this.sortHand(i),this.sortHand(o),this.sortHand(d),this.isValidArrangement(d,o,i)?{front:d,middle:o,back:i}:this.fixArrangement(t)}arrangeFrontHeavy(t){const e=[...t].sort((t,e)=>n(e).rank-n(t).rank),s=this.groupByRank(e),a=[],r=[];if(s.trips.length>=2){a.push(...s.trips[s.trips.length-1]);for(let t=0;t<s.trips.length-1;t++)r.push(...s.trips[t])}else{if(!(s.pairs.length>=3))return null;a.push(...s.pairs[s.pairs.length-1]);for(let t=0;t<s.pairs.length-1;t++)r.push(...s.pairs[t]);for(const t of s.trips)r.push(...t)}for(const n of s.quads)r.push(...n);for(r.push(...s.singles),r.sort((t,e)=>n(e).rank-n(t).rank);a.length<3&&r.length>0;)a.push(r.shift());const i=r.splice(0,5),l=r.splice(0,5);return this.sortHand(i),this.sortHand(l),this.sortHand(a),this.isValidArrangement(a,l,i)?{front:a,middle:l,back:i}:null}groupByRank(t){const e={};t.forEach(t=>{const{rank:s}=n(t);e[s]||(e[s]=[]),e[s].push(t)});const s=[],a=[],r=[],i=[];return Object.entries(e).sort(([t],[e])=>Number(e)-Number(t)).forEach(([,t])=>{4===t.length?s.push(t):3===t.length?a.push(t):2===t.length?r.push(t):i.push(...t)}),{quads:s,trips:a,pairs:r,singles:i}}findFlush(t,e){const s={};t.forEach(t=>{const{suit:e}=n(t);s[e]||(s[e]=[]),s[e].push(t)});for(const a of Object.values(s))if(a.length>=e)return a.slice(0,e);return null}findStraight(t,e){const s=new Map;t.forEach(t=>{const{rank:e}=n(t);s.has(e)||s.set(e,t)});const a=[...s.keys()].sort((t,e)=>e-t);for(let n=0;n<=a.length-e;n++)if(a[n]-a[n+e-1]===e-1)return a.slice(n,n+e).map(t=>s.get(t));return 5===e&&s.has(r.ACE)&&s.has(r.TWO)&&s.has(r.THREE)&&s.has(r.FOUR)&&s.has(r.FIVE)?[r.ACE,r.FIVE,r.FOUR,r.THREE,r.TWO].map(t=>s.get(t)):null}tryUpgrade5(t,e){if(5!==t.length)return;const s=[...t,...e],a=this.findFlush(s,5);if(a){const n=new Set(a),r=s.filter(t=>!n.has(t));return t.length=0,t.push(...a),e.length=0,void e.push(...r)}}fixArrangement(t){const e=[...t].sort((t,e)=>n(e).rank-n(t).rank);return{back:e.slice(0,5),middle:e.slice(5,10),front:e.slice(10,13)}}sortHand(t){t.sort((t,e)=>n(e).rank-n(t).rank)}calculateTotalPointsForArrangement(t,e){const s=JSON.parse(JSON.stringify(this.state.players)),n=s[t];n.front=e.front,n.middle=e.middle,n.back=e.back,n.instantWin=this.checkInstantWin(n.hand,n.front,n.middle,n.back);const r=this.isValidArrangement(n.front,n.middle,n.back);n.isFouled=!r;let i=0;const l=s.map((t,e)=>({pl:t,idx:e})).filter(({pl:t})=>null!==t.id).map(({idx:t})=>t);for(const a of l){if(a===t)continue;i+=this.compareTwoPlayers(n,t,s[a],a).p1Total}if(l.length>2&&!n.isFouled){let e=!0;for(const a of l){if(a===t)continue;const r=this.compareTwoPlayers(n,t,s[a],a);if(!(r.frontResult>0&&r.middleResult>0&&r.backResult>0)){e=!1;break}}e&&(i+=a.SCOOP_ALL)}return i}computePostGameAnalysis(t,s){const a=[];for(let n=0;n<t.length;n++){const r=t[n];if(r.isBot||!r.id||0===r.hand.length)continue;if(r.instantWin!==e.NONE)continue;const i=this.generateSuggestions(r.hand),l=this.calculateTotalPointsForArrangement(s[n],{front:r.front,middle:r.middle,back:r.back});let o=i[0],d=-1/0;for(const t of i){const e=this.calculateTotalPointsForArrangement(s[n],t);e>d&&(d=e,o=t)}d===-1/0&&(d=l,o=this.makeSuggestion({front:r.front,middle:r.middle,back:r.back},{en:"Current",vi:"Hiá»‡n táº¡i"}));const u=this.evaluate3CardHand(r.front),h=this.evaluate5CardHand(r.middle),c=this.evaluate5CardHand(r.back),f=u.value+h.value+c.value,p=this.evaluate3CardHand(o.front),k=this.evaluate5CardHand(o.middle),m=this.evaluate5CardHand(o.back),g=p.value+k.value+m.value;(d>l||g>1.05*f)&&a.push({playerIndex:s[n],actual:{front:r.front,middle:r.middle,back:r.back},optimal:{front:o.front,middle:o.middle,back:o.back},actualScore:Math.round(f/1e4),optimalScore:Math.round(g/1e4),actualPoints:l,optimalPoints:d,actualFrontRank:u.rank,actualMiddleRank:h.rank,actualBackRank:c.rank,optimalFrontRank:p.rank,optimalMiddleRank:k.rank,optimalBackRank:m.rank})}return a}createDeck(){const t=[];for(const e of[i.SPADE,i.CLUB,i.DIAMOND,i.HEART])for(let s=r.TWO;s<=r.ACE;s++)t.push(l(s,e));return t}shuffleDeck(t){for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}addBot(t){const e=this.state.players[t];null===e.id&&(e.id=`BOT_${Date.now()}_${t}`,e.username=`Bot ${t+1}`,e.isBot=!0)}resetGame(){this.clearTimer(),this.state.gamePhase="waiting",this.state.roundResults=[],this.state.timerEndsAt=0,this.state.players.forEach(t=>{t.hand=[],t.front=[],t.middle=[],t.back=[],t.isReady=!1,t.isFouled=!1,t.instantWin=e.NONE,t.usedAuto=!1,null!==t.id&&(t.score=0)})}joinSlot(t,e,s){if(null!==this.state.players[t].id)return;const a=this.state.players.findIndex(t=>t.id===e);-1!==a&&this.removePlayer(a);const n=this.state.players[t];n.id=e,n.username=s,n.isBot=!1}removePlayer(t){const e=this.state.players[t];Object.assign(e,this.createEmptyPlayer(t))}requestStartGame(){this.makeAction({type:"START_GAME"})}requestResetGame(){this.makeAction({type:"RESET_GAME"})}requestAddBot(t){this.makeAction({type:"ADD_BOT",slotIndex:t})}requestRemovePlayer(t){this.makeAction({type:"REMOVE_PLAYER",slotIndex:t})}requestJoinSlot(t,e){this.makeAction({type:"JOIN_SLOT",slotIndex:t,playerId:this.userId,playerName:e})}requestArrangeCards(t,e,s,a){this.makeAction({type:"ARRANGE_CARDS",playerId:this.userId,front:t,middle:e,back:s,isAuto:a})}requestAutoArrange(){this.makeAction({type:"AUTO_ARRANGE",playerId:this.userId})}requestDeclareInstantWin(){this.makeAction({type:"DECLARE_INSTANT_WIN",playerId:this.userId})}destroy(){this.clearTimer(),super.destroy()}}export{o as default};
