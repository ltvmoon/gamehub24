import{j as e,a as t}from"./index-B5e3DCQv.js";import{j as r,D as s,M as l,m as i}from"./react-vendor-BBF6bHIx.js";import"./socket-DRbsQkF5.js";import{a as o}from"./types-DkjE4TWX.js";import"./zustand-BazUDoMU.js";const n={red:{bg:"bg-red-500",light:"bg-red-200",ring:"ring-red-400",fill:"#ef4444",text:"text-red-500"},blue:{bg:"bg-blue-500",light:"bg-blue-200",ring:"ring-blue-400",fill:"#3b82f6",text:"text-blue-500"},green:{bg:"bg-green-500",light:"bg-green-200",ring:"ring-green-400",fill:"#22c55e",text:"text-green-500"},yellow:{bg:"bg-yellow-400",light:"bg-yellow-200",ring:"ring-yellow-400",fill:"#eab308",text:"text-yellow-500"}},a="#ef444444",x="#3b82f644",c="#22c55e44",d="#eab30844",h="#0002",y="#fff1",g="#4b5563";function u({game:u,currentUserId:f}){const m=u,[b,k]=r.useState(m.getState()),[j,w]=r.useState(!1),[v,N]=r.useState(1),[W,$]=r.useState(!1),[C,P]=r.useState(null),I=r.useRef(null),R=r.useRef(null);r.useEffect(()=>(m.onUpdate(e=>{if(null!==e.diceValue&&e.diceValue!==I.current&&!j){const t=e.diceValue;w(!0),$(!1),R.current&&clearInterval(R.current);let r=0;R.current=setInterval(()=>{N(Math.floor(6*Math.random())+1),r++,r>10&&(R.current&&(clearInterval(R.current),R.current=null),N(t),w(!1),$(!0),setTimeout(()=>$(!1),2e3))},80),I.current=t}else null===e.diceValue&&(I.current=null);k(e)}),k(m.getState()),m.requestSync(),()=>{R.current&&clearInterval(R.current)}),[m]);const S=m.getMyPlayerIndex(),M=b.players[b.currentPlayerIndex],q=M?.id===f,A=m.isHostUser,B=q&&(!b.hasRolled||b.canRollAgain)&&!j&&!W,G=null!==b.diceValue&&b.players[b.currentPlayerIndex]?.tokens.some(e=>"home"===e.position.type?6===b.diceValue:"finished"!==e.position.type),V=()=>{B&&(I.current=null,m.requestRollDice())},T=e=>[{x:1.5,y:6.5},{x:2.5,y:6.5},{x:3.5,y:6.5},{x:4.5,y:6.5},{x:5.5,y:6.5},{x:6.5,y:5.5},{x:6.5,y:4.5},{x:6.5,y:3.5},{x:6.5,y:2.5},{x:6.5,y:1.5},{x:6.5,y:.5},{x:7.5,y:.5},{x:8.5,y:.5},{x:8.5,y:1.5},{x:8.5,y:2.5},{x:8.5,y:3.5},{x:8.5,y:4.5},{x:8.5,y:5.5},{x:9.5,y:6.5},{x:10.5,y:6.5},{x:11.5,y:6.5},{x:12.5,y:6.5},{x:13.5,y:6.5},{x:14.5,y:6.5},{x:14.5,y:7.5},{x:14.5,y:8.5},{x:13.5,y:8.5},{x:12.5,y:8.5},{x:11.5,y:8.5},{x:10.5,y:8.5},{x:9.5,y:8.5},{x:8.5,y:9.5},{x:8.5,y:10.5},{x:8.5,y:11.5},{x:8.5,y:12.5},{x:8.5,y:13.5},{x:8.5,y:14.5},{x:7.5,y:14.5},{x:6.5,y:14.5},{x:6.5,y:13.5},{x:6.5,y:12.5},{x:6.5,y:11.5},{x:6.5,y:10.5},{x:6.5,y:9.5},{x:5.5,y:8.5},{x:4.5,y:8.5},{x:3.5,y:8.5},{x:2.5,y:8.5},{x:1.5,y:8.5},{x:.5,y:8.5},{x:.5,y:7.5},{x:.5,y:6.5}][e%52]||{x:7.5,y:7.5},Y=(t,r,s)=>{const l=((e,t,r)=>{if("home"===e.type){const e={red:{x:3,y:3},green:{x:12,y:3},yellow:{x:12,y:12},blue:{x:3,y:12}}[t],s=[{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}][r];return{x:e.x+s.dx,y:e.y+s.dy}}if("board"===e.type)return T(e.position);if("finish"===e.type)return{red:[{x:1.5,y:7.5},{x:2.5,y:7.5},{x:3.5,y:7.5},{x:4.5,y:7.5},{x:5.5,y:7.5}],green:[{x:7.5,y:1.5},{x:7.5,y:2.5},{x:7.5,y:3.5},{x:7.5,y:4.5},{x:7.5,y:5.5}],yellow:[{x:13.5,y:7.5},{x:12.5,y:7.5},{x:11.5,y:7.5},{x:10.5,y:7.5},{x:9.5,y:7.5}],blue:[{x:7.5,y:13.5},{x:7.5,y:12.5},{x:7.5,y:11.5},{x:7.5,y:10.5},{x:7.5,y:9.5}]}[t][e.position]||{x:7.5,y:7.5};return"finished"===e.type?{x:7.5,y:7.5}:null})(t.position,r,t.id);if(!l)return null;const i=b.currentPlayerIndex===s,o=!j&&q&&s===S&&b.hasRolled&&m.isTokenMovable(t.id),a=n[r];return e.jsx("div",{className:`\n          absolute w-6 h-6 rounded-full border-2 border-white shadow-lg z-10\n          ${a.bg}\n          ${o?"cursor-pointer":""}\n          ${i&&!o?"opacity-90":""}\n        `,style:{left:l.x/15*100+"%",top:l.y/15*100+"%",transform:o?"translate(-50%, -50%) scale(1.25)":"translate(-50%, -50%)",transition:"left 0.5s ease-in-out, top 0.5s ease-in-out, transform 0.2s ease-in-out",boxShadow:o?`0 0 0 4px ${a.fill}, 0 0 20px ${a.fill}, 0 0 30px ${a.fill}80`:void 0,zIndex:o?20:10,animation:o?"pulse 1s ease-in-out infinite":void 0},onClick:e=>o&&((e,t,r,s,l)=>{if(!q)return;if(!b.hasRolled)return;if(j)return;if(!m.isTokenMovable(e))return;const i=b.players[S];if(!i)return;const o=i.tokens.filter(e=>!!m.isTokenMovable(e.id)&&e.position.type===r.position.type&&("board"===e.position.type&&"board"===r.position.type||("home"!==e.position.type||"home"!==r.position.type)&&"finish"===e.position.type&&"finish"===r.position.type)&&e.position.position===r.position.position);if(o.length>1){const e=t.target.getBoundingClientRect();P({tokens:o.map(e=>({token:e,color:s,playerIndex:l})),x:e.left+e.width/2,y:e.top})}else P(null),m.requestMoveToken(e)})(t.id,e,t,r,s),children:e.jsx("span",{className:"flex items-center justify-center w-full h-full text-white text-xs font-bold drop-shadow-lg",children:t.id+1})},`${r}-${t.id}`)};return e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-2xl mx-auto",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"\n@keyframes bounce-dice {\n  0%, 100% { transform: translateY(0) rotate(0deg); }\n  25% { transform: translateY(-20px) rotate(90deg); }\n  50% { transform: translateY(-10px) rotate(180deg); }\n  75% { transform: translateY(-15px) rotate(270deg); }\n}\n\n@keyframes pulse {\n  0%, 100% { opacity: 1; box-shadow: 0 0 0 4px currentColor, 0 0 20px currentColor; }\n  50% { opacity: 0.8; box-shadow: 0 0 0 6px currentColor, 0 0 30px currentColor; }\n}\n\n@keyframes pulse-corner {\n  0%, 100% { opacity: 0.3; }\n  50% { opacity: 0.6; }\n}\n"}}),C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>P(null),children:e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 shadow-xl border border-slate-600",onClick:e=>e.stopPropagation(),children:[e.jsx("p",{className:"text-white text-sm mb-3 text-center",children:"Select which token to move:"}),e.jsx("div",{className:"flex gap-2 justify-center",children:C.tokens.map(({token:t,color:r})=>{const s=n[r];return e.jsx("button",{onClick:()=>{return e=t.id,P(null),void m.requestMoveToken(e);var e},className:`\n                      w-10 h-10 rounded-full border-2 border-white shadow-lg\n                      ${s.bg}\n                      hover:scale-110 transition-transform\n                      flex items-center justify-center\n                    `,children:e.jsx("span",{className:"text-white font-bold text-sm",children:t.id+1})},t.id)})}),e.jsx("p",{className:"text-gray-400 text-xs mt-2 text-center",children:"Click outside to cancel"})]})}),"playing"===b.gamePhase&&e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"text-lg text-gray-400",children:q?e.jsx("span",{className:"text-green-400 font-semibold",children:"Your turn!"}):e.jsxs("span",{children:["Waiting for"," ",e.jsx("span",{className:n[M?.color||"red"].text,children:M?.username}),"..."]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[(()=>{const t={"top-left":"top-1.5 left-1.5","top-right":"top-1.5 right-1.5","middle-left":"top-1/2 left-1.5 -translate-y-1/2","middle-right":"top-1/2 right-1.5 -translate-y-1/2",center:"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2","bottom-left":"bottom-1.5 left-1.5","bottom-right":"bottom-1.5 right-1.5"};return e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx("div",{className:`\n            relative w-16 h-16 bg-white rounded-xl shadow-lg border-2 border-gray-300\n            ${B?"cursor-pointer hover:shadow-xl hover:scale-105 transition-all":""}\n          `,style:{animation:j?"bounce-dice 0.3s ease-in-out infinite":void 0},onClick:V,children:({1:["center"],2:["top-right","bottom-left"],3:["top-right","center","bottom-left"],4:["top-left","top-right","bottom-left","bottom-right"],5:["top-left","top-right","center","bottom-left","bottom-right"],6:["top-left","top-right","middle-left","middle-right","bottom-left","bottom-right"]}[v]||[]).map((r,s)=>e.jsx("div",{className:`absolute w-3 h-3 bg-gray-800 rounded-full ${t[r]}`},s))}),null!==b.diceValue&&!j&&e.jsxs("div",{className:"text-2xl font-bold text-white bg-slate-700 px-3 py-1 rounded-lg",children:["ðŸŽ² ",b.diceValue]})]})})(),B&&e.jsxs("button",{onClick:V,disabled:j,className:"flex items-center gap-2 px-5 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-lg transition-colors disabled:opacity-50 font-semibold",children:[e.jsx(s,{className:"w-5 h-5"}),j?"Rolling...":b.canRollAgain?"Roll Again! ðŸŽ‰":"Roll Dice"]})]}),b.hasRolled&&!b.canRollAgain&&q&&!j&&G&&e.jsx("span",{className:"text-yellow-400 animate-pulse",children:"ðŸ‘† Click a highlighted token to move"})]}),"ended"===b.gamePhase&&e.jsxs("div",{className:"text-center p-4 bg-slate-800 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Game Over!"}),e.jsx("p",{className:"text-gray-300",children:b.winner===f?"ðŸŽ‰ You won!":`${b.players.find(e=>e.id===b.winner)?.username} wins!`})]}),"waiting"===b.gamePhase&&e.jsx("div",{className:"grid grid-cols-2 gap-2 w-full max-w-md",children:[0,1,3,2].map(t=>{const r=b.players[t];if(!r)return null;const s=n[r.color];return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${s.bg}`}),e.jsxs("span",{className:"text-sm text-white",children:[r.id?r.username:"(empty)",r.isBot&&" ðŸ¤–",r.id===f&&" (You)"]})]}),A&&(r.isBot?e.jsx("button",{onClick:()=>m.requestRemoveBot(t),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded",children:"âœ•"}):!r.id&&e.jsx("button",{onClick:()=>m.requestAddBot(t),className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded",children:"+Bot"}))]},t)})}),e.jsxs("div",{className:"flex gap-3",children:["waiting"===b.gamePhase&&A&&m.canStartGame()&&e.jsxs("button",{onClick:()=>m.requestStartGame(),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors",children:[e.jsx(l,{className:"w-4 h-4"})," Start Game"]}),"ended"===b.gamePhase&&e.jsxs("button",{onClick:()=>m.requestNewGame(),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors",children:[e.jsx(i,{className:"w-4 h-4"})," Play Again"]})]}),e.jsxs("div",{className:"relative w-full max-w-[450px] aspect-square bg-slate-900 rounded-xl overflow-hidden shadow-2xl border-4 border-black",children:[e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 15 15",children:[e.jsx("rect",{x:"0",y:"0",width:"6",height:"6",fill:a,stroke:h,strokeWidth:"0.05"}),e.jsx("rect",{x:"1",y:"1",width:"4",height:"4",fill:y}),e.jsx("circle",{cx:"2",cy:"2",r:"0.6",fill:a,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"4",cy:"2",r:"0.6",fill:a,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"2",cy:"4",r:"0.6",fill:a,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"4",cy:"4",r:"0.6",fill:a,stroke:h,strokeWidth:"0.03"}),e.jsx("rect",{x:"9",y:"0",width:"6",height:"6",fill:c,stroke:h,strokeWidth:"0.05"}),e.jsx("rect",{x:"10",y:"1",width:"4",height:"4",fill:y}),e.jsx("circle",{cx:"11",cy:"2",r:"0.6",fill:c,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"13",cy:"2",r:"0.6",fill:c,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"11",cy:"4",r:"0.6",fill:c,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"13",cy:"4",r:"0.6",fill:c,stroke:h,strokeWidth:"0.03"}),e.jsx("rect",{x:"9",y:"9",width:"6",height:"6",fill:d,stroke:h,strokeWidth:"0.05"}),e.jsx("rect",{x:"10",y:"10",width:"4",height:"4",fill:y}),e.jsx("circle",{cx:"11",cy:"11",r:"0.6",fill:d,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"13",cy:"11",r:"0.6",fill:d,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"11",cy:"13",r:"0.6",fill:d,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"13",cy:"13",r:"0.6",fill:d,stroke:h,strokeWidth:"0.03"}),e.jsx("rect",{x:"0",y:"9",width:"6",height:"6",fill:x,stroke:h,strokeWidth:"0.05"}),e.jsx("rect",{x:"1",y:"10",width:"4",height:"4",fill:y}),e.jsx("circle",{cx:"2",cy:"11",r:"0.6",fill:x,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"4",cy:"11",r:"0.6",fill:x,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"2",cy:"13",r:"0.6",fill:x,stroke:h,strokeWidth:"0.03"}),e.jsx("circle",{cx:"4",cy:"13",r:"0.6",fill:x,stroke:h,strokeWidth:"0.03"}),[0,1,2,3,4,5].map(t=>e.jsxs("g",{children:[e.jsx("rect",{x:t,y:6,width:"1",height:"1",fill:1===t?a:g,stroke:h,strokeWidth:"0.02"}),e.jsx("rect",{x:t,y:7,width:"1",height:"1",fill:0===t?g:a,stroke:h,strokeWidth:"0.02"}),e.jsx("rect",{x:t,y:8,width:"1",height:"1",fill:g,stroke:h,strokeWidth:"0.02"})]},`left-${t}`)),[0,1,2,3,4,5].map(t=>e.jsxs("g",{children:[e.jsx("rect",{x:9+t,y:6,width:"1",height:"1",fill:g,stroke:h,strokeWidth:"0.02"}),e.jsx("rect",{x:9+t,y:7,width:"1",height:"1",fill:t<5?d:g,stroke:h,strokeWidth:"0.02"}),e.jsx("rect",{x:9+t,y:8,width:"1",height:"1",fill:4===t?d:g,stroke:h,strokeWidth:"0.02"})]},`right-${t}`)),[0,1,2,3,4,5].map(t=>e.jsxs("g",{children:[e.jsx("rect",{x:6,y:t,width:"1",height:"1",fill:g,stroke:h,strokeWidth:"0.02"}),e.jsx("rect",{x:7,y:t,width:"1",height:"1",fill:t>0?c:g,stroke:h,strokeWidth:"0.02"}),e.jsx("rect",{x:8,y:t,width:"1",height:"1",fill:1===t?c:g,stroke:h,strokeWidth:"0.02"})]},`top-${t}`)),[0,1,2,3,4,5].map(t=>e.jsxs("g",{children:[e.jsx("rect",{x:6,y:9+t,width:"1",height:"1",fill:4===t?x:g,stroke:h,strokeWidth:"0.02"}),e.jsx("rect",{x:7,y:9+t,width:"1",height:"1",fill:t<5?x:g,stroke:h,strokeWidth:"0.02"}),e.jsx("rect",{x:8,y:9+t,width:"1",height:"1",fill:g,stroke:h,strokeWidth:"0.02"})]},`bottom-${t}`)),e.jsx("polygon",{points:"6,6 9,6 7.5,7.5",fill:c,stroke:h,strokeWidth:"0.03"}),e.jsx("polygon",{points:"9,6 9,9 7.5,7.5",fill:d,stroke:h,strokeWidth:"0.03"}),e.jsx("polygon",{points:"9,9 6,9 7.5,7.5",fill:x,stroke:h,strokeWidth:"0.03"}),e.jsx("polygon",{points:"6,9 6,6 7.5,7.5",fill:a,stroke:h,strokeWidth:"0.03"}),o.map((t,r)=>{const s=T(t);return e.jsx("polygon",{points:p(s.x,s.y,.35),fill:"#fbbf2455",strokeWidth:"0.03",opacity:"0.9"},r)}),"playing"===b.gamePhase&&(()=>{const t=b.players[b.currentPlayerIndex],r={red:{x:0,y:0},green:{x:9,y:0},yellow:{x:9,y:9},blue:{x:0,y:9}}[t.color];return e.jsx("rect",{x:r.x,y:r.y,width:"6",height:"6",fill:n[t.color].fill,strokeWidth:"0.15",style:{animation:"pulse-corner 1s ease-in-out infinite"}})})()]}),b.players.map((t,r)=>{const s=(e=>{switch(e){case"red":return{x:"20%",y:"3%"};case"green":return{x:"80%",y:"3%"};case"yellow":return{x:"80%",y:"97%"};case"blue":return{x:"20%",y:"97%"}}})(t.color),l=b.currentPlayerIndex===r&&"playing"===b.gamePhase,i=n[t.color];return e.jsxs("div",{className:`\n                absolute px-2 py-0.5 rounded text-xs font-bold\n                ${l?`${i.bg} text-white`:"bg-black/50 "+i.text}\n                ${l?"animate-pulse":""}\n              `,style:{left:s.x,top:s.y,transform:`translate(-50%, ${"97%"===s.y?"-100%":"0"})`},children:[t.id?t.username:"(empty)",t.isBot&&" ðŸ¤–"]},`name-${t.color}`)}),b.players.map((e,t)=>e.id&&e.tokens.map(r=>Y(r,e.color,t)))]}),"playing"===b.gamePhase&&A&&e.jsxs("button",{onClick:async()=>{await t.getState().confirm("Are you sure you want to reset the game? All progress will be lost.","New Game")&&m.requestNewGame()},className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg transition-colors",children:[e.jsx(i,{className:"w-4 h-4"})," New Game"]})]})}const p=(e,t,r)=>{const s=[];for(let l=0;l<10;l++){const i=l%2==0?r:.4*r,o=Math.PI/2+l*Math.PI/5,n=e+i*Math.cos(o),a=t-i*Math.sin(o);s.push(`${n},${a}`)}return s.join(" ")};export{u as default};
